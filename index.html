<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thruver — Infraestructura confiable de mantenimiento y mejoras</title>
  <meta name="description" content="Thruver conecta tu espacio con técnicos verificados, asignados por zona." />
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/tny-me/thruver.github.io/main/Favicon.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#111111" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Thruver" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:      #f3f3f3;
      --bg2:     #eaeaea;
      --bg3:     #e0e0e0;
      --white:   #ffffff;
      --black:   #111111;
      --text:    #111111;
      --muted:   #777777;
      --muted2:  #aaaaaa;
      --border:  rgba(0,0,0,0.08);
      --radius:  14px;
      --rsm:     8px;
      --font:    Arial, "Arial Unicode MS", sans-serif;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* ══ NAV ══ */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 300;
      height: 60px; display: flex; align-items: center;
      justify-content: space-between; padding: 0 2.5rem;
      background: var(--bg); border-bottom: 1px solid var(--border);
    }
    .nav-logo { font-weight: 900; font-size: 1.3rem; letter-spacing: -0.04em; color: var(--black); text-decoration: none; }
    .nav-center { display: flex; gap: 0.2rem; list-style: none; }
    .nav-center a { color: var(--muted); text-decoration: none; font-size: 0.85rem; padding: 0.4rem 0.85rem; border-radius: 6px; transition: color 0.15s, background 0.15s; }
    .nav-center a:hover { color: var(--black); background: var(--bg3); }
    .nav-right { display: flex; gap: 0.5rem; align-items: center; }

    .btn-ghost {
      background: transparent; color: var(--text); border: 1px solid var(--border);
      padding: 0.42rem 1rem; border-radius: var(--rsm); font-size: 0.83rem;
      cursor: pointer; font-family: var(--font); text-decoration: none;
      min-height: 44px; display: inline-flex; align-items: center;
      transition: border-color 0.15s, background 0.15s;
    }
    .btn-ghost:hover { border-color: rgba(0,0,0,0.18); background: var(--bg2); }

    .btn-solid {
      background: var(--black); color: var(--white) !important; border: none;
      padding: 0.48rem 1.1rem; border-radius: var(--rsm); font-size: 0.83rem;
      font-weight: 700; cursor: pointer; font-family: var(--font);
      text-decoration: none; min-height: 44px; display: inline-flex;
      align-items: center; transition: opacity 0.15s;
    }
    .btn-solid:hover { opacity: 0.78; }

    .nav-hamburger {
      display: none; flex-direction: column; justify-content: center;
      align-items: center; gap: 5px; width: 44px; height: 44px;
      background: transparent; border: 1px solid var(--border);
      border-radius: var(--rsm); cursor: pointer;
    }
    .nav-hamburger span { display: block; width: 20px; height: 2px; background: var(--black); border-radius: 2px; transition: all 0.25s ease; }
    .nav-hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .nav-hamburger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
    .nav-hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

    .mobile-menu {
      display: none; position: fixed; top: 60px; left: 0; right: 0; bottom: 0;
      z-index: 250; background: var(--white); padding: 1.2rem 1.5rem 2rem;
      flex-direction: column; gap: 0.2rem; overflow-y: auto;
      animation: slideDown 0.22s ease;
    }
    .mobile-menu.open { display: flex; }
    @keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }
    .mobile-menu a { display: flex; align-items: center; padding: 0.9rem 1rem; font-size: 0.97rem; font-weight: 600; color: var(--text); text-decoration: none; border-radius: var(--radius); min-height: 52px; transition: background 0.15s; }
    .mobile-menu a:active { background: var(--bg); }
    .mm-divider { height: 1px; background: var(--border); margin: 0.5rem 0; }
    .mm-cta { display: flex; flex-direction: column; gap: 0.6rem; margin-top: 0.4rem; }
    .mm-cta .btn-solid,
    .mm-cta .btn-ghost { width: 100%; justify-content: center; font-size: 0.95rem; padding: 0.85rem; border-radius: var(--radius); }
    /* FIX: Asegurar que el texto del botón solicitar servicio sea blanco en el menú móvil */
    .mm-cta .btn-solid { background: var(--black) !important; color: #ffffff !important; }

    /* ══ HERO ══ */
    .hero {
      margin-top: 60px; min-height: calc(100vh - 60px);
      display: grid; grid-template-columns: 1fr 1fr;
      align-items: center; position: relative; overflow: hidden; background: var(--bg);
    }
    .hero-grid-pattern {
      position: absolute; inset: 0;
      background-image: linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px);
      background-size: 48px 48px; pointer-events: none; z-index: 0;
      animation: gridBreathe 6s ease-in-out infinite;
    }
    @keyframes gridBreathe { 0%,100%{transform:scale(1);opacity:1} 50%{transform:scale(1.06);opacity:0.5} }
    @media(prefers-reduced-motion:reduce){ .hero-grid-pattern{animation:none} }
    .hero-left { position: relative; z-index: 1; padding: 5rem 3rem 5rem 4rem; display: flex; flex-direction: column; }
    .hero-badge { display: inline-flex; align-items: center; gap: 0.45rem; background: var(--white); border: 1px solid var(--border); color: var(--muted); font-size: 0.74rem; padding: 0.34rem 0.9rem; border-radius: 100px; margin-bottom: 2rem; width: fit-content; box-shadow: 0 1px 4px rgba(0,0,0,0.05); animation: fadeUp 0.5s ease both; }
    .badge-dot { width: 6px; height: 6px; border-radius: 50%; background: #22c55e; animation: pulse 2s infinite; flex-shrink: 0; }
    @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.8)} }
    .hero-h1 { font-weight: 900; font-size: clamp(1.9rem, 3.2vw, 2.65rem); letter-spacing: -0.04em; line-height: 1.08; color: var(--black); margin-bottom: 1.2rem; animation: fadeUp 0.5s ease 0.07s both; }
    .hero-sub { font-size: 0.95rem; color: var(--muted); line-height: 1.75; max-width: 400px; margin-bottom: 2.2rem; animation: fadeUp 0.5s ease 0.14s both; }
    .hero-actions { display: flex; gap: 0.6rem; flex-wrap: wrap; margin-bottom: 3rem; animation: fadeUp 0.5s ease 0.21s both; }
    .hero-actions .btn-solid { padding: 0.72rem 1.6rem; font-size: 0.88rem; }
    .hero-actions .btn-ghost { padding: 0.72rem 1.6rem; font-size: 0.88rem; background: var(--white); border-color: var(--white); }
    .hero-actions .btn-ghost:hover { background: var(--bg3); border-color: var(--bg3); }
    .hero-stats { display: flex; background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; width: fit-content; box-shadow: 0 2px 12px rgba(0,0,0,0.04); animation: fadeUp 0.5s ease 0.28s both; }
    .hero-stat { padding: 1.1rem 1.4rem; border-right: 1px solid var(--border); text-align: center; }
    .hero-stat:last-child { border-right: none; }
    .hero-stat strong { display: block; font-size: 1.3rem; font-weight: 900; color: var(--black); letter-spacing: -0.03em; }
    .hero-stat span   { font-size: 0.68rem; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.08em; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

    .hero-right { position: relative; z-index: 1; height: calc(100vh - 60px); display: flex; align-items: center; justify-content: center; padding: 3rem 3.5rem 3rem 1.5rem; }
    .carousel-wrap { width: 100%; max-width: 500px; }
    .carousel-frame { width: 100%; aspect-ratio: 4/3; border-radius: 20px; overflow: hidden; border: 1px solid rgba(0,0,0,0.09); box-shadow: 0 24px 64px rgba(0,0,0,0.13), 0 4px 16px rgba(0,0,0,0.06); background: var(--bg3); animation: fadeUp 0.6s ease 0.1s both; -webkit-transform: translateZ(0); transform: translateZ(0); -webkit-mask-image: -webkit-radial-gradient(white, black); }
    .carousel-slides { display: flex; width: 100%; height: 100%; transition: transform 0.9s cubic-bezier(0.4,0,0.2,1); will-change: transform; -webkit-backface-visibility: hidden; backface-visibility: hidden; }
    .carousel-slide { flex-shrink: 0; width: 100%; height: 100%; overflow: hidden; }
    .carousel-slide img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 6s ease; transform: scale(1.06); }
    .carousel-slide.active img { transform: scale(1); }
    .carousel-dots { display: flex; gap: 0.45rem; justify-content: center; margin-top: 1rem; }
    .carousel-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--bg3); transition: background 0.3s, transform 0.3s; cursor: pointer; position: relative; }
    .carousel-dot::after { content: ''; position: absolute; inset: -8px; }
    .carousel-dot.active { background: var(--black); transform: scale(1.4); }

    /* ══ SERVICES BAR ══ */
    .services-bar { background: #3c3c3c; }
    .services-bar-inner { max-width: 1140px; margin: 0 auto; padding: 2.5rem; }
    .services-bar-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.4rem; }
    .services-bar h2 { font-weight: 900; font-size: 1.05rem; letter-spacing: -0.03em; color: var(--white); }
    .link-muted { font-size: 0.8rem; color: rgba(255,255,255,0.45); text-decoration: none; transition: color 0.15s; }
    .link-muted:hover { color: var(--white); }
    .services-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.7rem; }
    .service-pill { background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.2rem 0.6rem; text-align: center; cursor: pointer; text-decoration: none; color: var(--text); display: flex; flex-direction: column; align-items: center; gap: 0.4rem; min-height: 80px; transition: all 0.18s; }
    .service-pill:hover { background: var(--bg3); transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,0,0,0.06); }
    .service-pill-icon  { font-size: 1.6rem; }
    .service-pill-label { font-size: 0.72rem; font-weight: 700; }

    /* ══ MAIN CONTENT ══ */
    .main-content { max-width: 1140px; margin: 0 auto; padding: 4rem 2.5rem; display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 2rem; align-items: start; }
    .main-left, .main-right { display: flex; flex-direction: column; gap: 1.2rem; }
    .eyebrow { font-size: 0.68rem; font-weight: 700; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.12em; margin-bottom: 0.3rem; }
    .block-title { font-size: 1.35rem; font-weight: 900; letter-spacing: -0.035em; line-height: 1.15; color: var(--black); margin-bottom: 0.8rem; }
    .problem-grid { display: flex; flex-direction: column; gap: 0.7rem; }
    .problem-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.3rem 1.5rem; display: flex; align-items: flex-start; gap: 1rem; transition: transform 0.18s, box-shadow 0.18s; }
    .problem-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
    .problem-icon { font-size: 1.3rem; flex-shrink: 0; width: 38px; height: 38px; background: var(--bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
    .problem-card h3 { font-size: 0.87rem; font-weight: 700; margin-bottom: 0.2rem; }
    .problem-card p  { font-size: 0.79rem; color: var(--muted); line-height: 1.65; }
    .how-block { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .block-tabs { display: flex; border-bottom: 1px solid var(--border); }
    .block-tab { flex: 1; padding: 0.8rem; font-size: 0.81rem; cursor: pointer; border: none; background: transparent; color: var(--muted); font-family: var(--font); transition: all 0.15s; border-bottom: 2px solid transparent; margin-bottom: -1px; min-height: 48px; }
    .block-tab.active { color: var(--black); font-weight: 700; border-bottom-color: var(--black); background: var(--bg); }
    .tab-panel { display: none; padding: 1.1rem; flex-direction: column; gap: 0.55rem; }
    .tab-panel.active { display: flex; }
    .how-step { display: flex; gap: 0.9rem; align-items: flex-start; padding: 0.85rem 0.9rem; background: var(--bg); border-radius: var(--rsm); border: 1px solid var(--border); transition: transform 0.15s; }
    .how-step:hover { transform: translateX(2px); }
    .step-num { font-size: 1rem; font-weight: 900; color: var(--bg3); width: 24px; flex-shrink: 0; padding-top: 1px; }
    .how-step h3 { font-size: 0.82rem; font-weight: 700; margin-bottom: 0.15rem; }
    .how-step p  { font-size: 0.77rem; color: var(--muted); line-height: 1.6; }
    .why-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.4rem 1.6rem; transition: transform 0.18s, box-shadow 0.18s; position: relative; overflow: hidden; }
    .why-card::after { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--black); }
    .why-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
    .why-card h3 { font-size: 0.87rem; font-weight: 700; margin-bottom: 0.3rem; }
    .why-card p  { font-size: 0.79rem; color: var(--muted); line-height: 1.65; }
    .why-card-dark { background: var(--black); border-color: transparent; }
    .why-card-dark::after { background: rgba(255,255,255,0.15); }
    .why-card-dark h3 { color: var(--white); }
    .why-card-dark p  { color: rgba(255,255,255,0.45); }
    .why-card-icon { font-size: 1.7rem; margin-bottom: 0.7rem; }
    .why-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 0.7rem; }
    .register-block { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.65rem; }
    .form-group { margin-bottom: 0.7rem; }
    .form-group label { display: block; font-size: 0.67rem; font-weight: 700; color: var(--muted); margin-bottom: 0.26rem; text-transform: uppercase; letter-spacing: 0.07em; }
    .form-group input, .form-group select { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: var(--rsm); padding: 0.7rem 0.85rem; color: var(--text); font-size: 1rem; font-family: var(--font); outline: none; min-height: 48px; -webkit-appearance: none; transition: border-color 0.15s, background 0.15s; }
    .form-group input::placeholder { color: var(--muted2); }
    .form-group input:focus, .form-group select:focus { border-color: var(--black); background: var(--white); }
    .register-form-panel { display: none; padding: 1.3rem 1.4rem; }
    .register-form-panel.active { display: block; }
    .btn-submit { width: 100%; background: var(--black); color: var(--white) !important; border: none; padding: 0.9rem; border-radius: var(--rsm); font-size: 0.9rem; font-weight: 700; cursor: pointer; font-family: var(--font); min-height: 52px; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.18s; margin-top: 0.2rem; }
    .btn-submit:hover { opacity: 0.78; transform: translateY(-1px); }
    .btn-submit:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }
    .spinner { display: none; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.7s linear infinite; }
    @keyframes spin { to{transform:rotate(360deg)} }
    .form-note { font-size: 0.67rem; color: var(--muted2); margin-top: 0.5rem; text-align: center; }
    .success-msg { display: none; text-align: center; padding: 2rem 1rem; }
    .success-msg .check { font-size: 1.8rem; margin-bottom: 0.6rem; }
    .success-msg h4 { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.3rem; }
    .success-msg p  { font-size: 0.79rem; color: var(--muted); }

    /* ══ WHY STRIP ══ */
    .why-strip { background: var(--white); border-bottom: 1px solid var(--border); }
    .why-strip-inner { max-width: 1140px; margin: 0 auto; padding: 5rem 2.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 5rem; align-items: center; }
    .why-strip-eyebrow { font-size: 0.68rem; font-weight: 700; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.13em; margin-bottom: 0.5rem; }
    .why-strip-title { font-size: clamp(1.5rem, 3vw, 2rem); font-weight: 900; letter-spacing: -0.04em; line-height: 1.1; color: var(--black); margin-bottom: 2.5rem; }
    .why-strip-list { display: flex; flex-direction: column; gap: 1.5rem; }
    .why-strip-item { display: flex; gap: 1rem; align-items: flex-start; }
    .why-strip-icon { width: 38px; height: 38px; border-radius: 9px; background: var(--bg); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
    .why-strip-item-text strong { display: block; font-size: 0.88rem; font-weight: 700; color: var(--black); margin-bottom: 0.2rem; }
    .why-strip-item-text p { font-size: 0.82rem; color: var(--muted); line-height: 1.7; }
    .why-strip-item-text p b { color: var(--black); font-weight: 700; }
    .why-strip-right { display: flex; align-items: center; justify-content: center; }
    .why-badge-card { background: #0098cf; border-radius: 24px; padding: 3.5rem 3rem; text-align: center; width: 100%; max-width: 340px; box-shadow: 0 8px 40px rgba(0,152,207,0.25); }
    .why-badge-icon { width: 96px; height: 96px; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; }
    .why-badge-card h3 { font-size: 1.15rem; font-weight: 900; color: #000; letter-spacing: -0.03em; margin-bottom: 0.5rem; white-space: nowrap; }
    .why-badge-card p { font-size: 0.82rem; color: rgba(255,255,255,0.75); line-height: 1.65; }

    /* ══ FOOTER ══ */
    footer { background: var(--white); border-top: 1px solid var(--border); padding: 2rem 2.5rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
    .footer-logo { font-weight: 900; font-size: 1.1rem; letter-spacing: -0.04em; color: var(--black); }
    .footer-links { display: flex; gap: 1.5rem; flex-wrap: wrap; }
    .footer-links a { font-size: 0.78rem; color: var(--muted); text-decoration: none; min-height: 44px; display: inline-flex; align-items: center; transition: color 0.15s; }
    .footer-links a:hover { color: var(--black); }
    .footer-copy { font-size: 0.7rem; color: var(--muted2); }

    /* ══ LOGIN MODAL ══ */
    .modal-overlay { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.45); backdrop-filter: blur(6px); align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal-box { background: var(--white); border-radius: 18px; padding: 2.5rem; width: 100%; max-width: 380px; margin: 1rem; box-shadow: 0 24px 80px rgba(0,0,0,0.18); animation: slideUp 0.25s ease; position: relative; }
    @keyframes slideUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .modal-box h2 { font-size: 1.3rem; font-weight: 900; letter-spacing: -0.03em; color: var(--black); margin-bottom: 0.3rem; }
    .modal-box .modal-sub { font-size: 0.8rem; color: var(--muted); margin-bottom: 1.8rem; }
    .modal-close { position: absolute; top: 1rem; right: 1rem; background: var(--bg); border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; color: var(--muted); transition: background 0.15s; }
    .modal-close:hover { background: var(--bg3); }
    .modal-error { display: none; background: #fff0f0; border: 1px solid #fcc; border-radius: 7px; padding: 0.6rem 0.9rem; font-size: 0.78rem; color: #cc3333; margin-bottom: 0.8rem; }
    .modal-success { display: none; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 7px; padding: 0.6rem 0.9rem; font-size: 0.78rem; color: #16a34a; margin-bottom: 0.8rem; }
    .modal-success.visible, .modal-error.visible { display: block; }
    .modal-footer-link { font-size: 0.78rem; color: var(--muted); text-align: center; margin-top: 1.1rem; }
    .modal-footer-link button { background: none; border: none; cursor: pointer; font-family: var(--font); font-size: 0.78rem; color: var(--black); font-weight: 700; text-decoration: underline; padding: 0; }
    .modal-forgot { font-size: 0.72rem; color: var(--muted); text-align: right; margin-top: -0.3rem; margin-bottom: 0.9rem; }
    .modal-forgot button { background: none; border: none; cursor: pointer; font-family: var(--font); font-size: 0.72rem; color: var(--muted); text-decoration: underline; padding: 0; }
    .modal-forgot button:hover { color: var(--black); }
    .modal-pass-wrap { position: relative; }
    .modal-pass-wrap input { padding-right: 2.8rem; }
    .modal-pass-eye { position: absolute; right: 0.7rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--muted); padding: 0.25rem; display: flex; align-items: center; }
    .modal-pass-eye:hover { color: var(--black); }
    .modal-panel { display: none; }
    .modal-panel.active { display: block; }
    .modal-addr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 0.8rem; }
    .modal-box { overflow-y: auto; max-height: 90vh; }

    .dash-nav-logo { font-weight: 900; font-size: 1.3rem; letter-spacing: -0.04em; color: var(--black); text-decoration: none; }
    .dash-nav-right { display: flex; align-items: center; gap: 1rem; }
    .dash-user { display: flex; align-items: center; gap: 0.6rem; font-size: 0.83rem; color: var(--text); }
    .dash-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--black); color: var(--white); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
    .dash-body { max-width: 1100px; margin: 0 auto; padding: 2.5rem; }
    .dash-greeting { margin-bottom: 2rem; }
    .dash-greeting h1 { font-size: 1.6rem; font-weight: 900; letter-spacing: -0.04em; color: var(--black); margin-bottom: 0.2rem; }
    .dash-greeting p  { font-size: 0.85rem; color: var(--muted); }
    .dash-stats { display: grid; grid-template-columns: repeat(4,1fr); gap: 1rem; margin-bottom: 2rem; }
    .dash-stat-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.3rem 1.5rem; }
    .dash-stat-label { font-size: 0.7rem; font-weight: 700; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 0.4rem; }
    .dash-stat-value { font-size: 1.7rem; font-weight: 900; color: var(--black); letter-spacing: -0.04em; line-height: 1; margin-bottom: 0.25rem; }
    .dash-stat-sub { font-size: 0.72rem; color: var(--muted); }
    .dash-grid { display: grid; grid-template-columns: 1.4fr 1fr; gap: 1.2rem; }
    .dash-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .dash-card-header { padding: 1.2rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .dash-card-header h3 { font-size: 0.9rem; font-weight: 700; }
    .dash-card-header a { font-size: 0.75rem; color: var(--muted); text-decoration: none; min-height: 44px; display: inline-flex; align-items: center; }
    .dash-card-header a:hover { color: var(--black); }
    .active-service { padding: 1.5rem; }
    .active-badge { display: inline-flex; align-items: center; gap: 0.4rem; background: #f0fdf4; border: 1px solid #bbf7d0; color: #16a34a; font-size: 0.7rem; font-weight: 700; padding: 0.28rem 0.75rem; border-radius: 100px; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.07em; }
    .active-dot { width: 5px; height: 5px; border-radius: 50%; background: #16a34a; animation: pulse 2s infinite; }
    .active-service h4 { font-size: 1.05rem; font-weight: 900; color: var(--black); margin-bottom: 0.3rem; }
    .active-service-meta { font-size: 0.8rem; color: var(--muted); margin-bottom: 1.3rem; }
    .active-tech { display: flex; align-items: center; gap: 0.8rem; padding: 1rem 1.2rem; background: var(--bg); border-radius: 10px; border: 1px solid var(--border); margin-bottom: 1.2rem; }
    .tech-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--black); color: var(--white); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
    .tech-info strong { display: block; font-size: 0.85rem; font-weight: 700; color: var(--black); }
    .tech-info span { font-size: 0.75rem; color: var(--muted); }
    .tech-verified { margin-left: auto; background: #0098cf; color: white; font-size: 0.65rem; font-weight: 700; padding: 0.25rem 0.6rem; border-radius: 100px; white-space: nowrap; }
    .progress-steps { display: flex; align-items: center; }
    .pstep { display: flex; flex-direction: column; align-items: center; flex: 1; }
    .pstep-dot { width: 20px; height: 20px; border-radius: 50%; background: var(--bg3); border: 2px solid var(--bg3); display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: var(--muted); margin-bottom: 0.4rem; transition: all 0.3s; position: relative; z-index: 1; }
    .pstep.done .pstep-dot   { background: var(--black); border-color: var(--black); color: white; }
    .pstep.active .pstep-dot { background: #0098cf; border-color: #0098cf; color: white; }
    .pstep-label { font-size: 0.62rem; color: var(--muted2); text-align: center; }
    .pstep.done .pstep-label  { color: var(--black); font-weight: 700; }
    .pstep.active .pstep-label { color: #0098cf; font-weight: 700; }
    .pstep-line { flex: 1; height: 2px; background: var(--bg3); margin-bottom: 1.1rem; }
    .pstep-line.done { background: var(--black); }
    .service-row { display: flex; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); gap: 1rem; transition: background 0.15s; min-height: 60px; }
    .service-row:last-child { border-bottom: none; }
    .service-row:hover { background: var(--bg); }
    .service-row-icon { width: 36px; height: 36px; border-radius: 9px; background: var(--bg); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0; }
    .service-row-info { flex: 1; min-width: 0; }
    .service-row-info strong { display: block; font-size: 0.83rem; font-weight: 700; color: var(--black); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .service-row-info span  { font-size: 0.72rem; color: var(--muted); }
    .service-row-right { text-align: right; flex-shrink: 0; }
    .service-row-price { font-size: 0.85rem; font-weight: 700; color: var(--black); }
    .service-row-status { display: inline-block; font-size: 0.65rem; font-weight: 700; padding: 0.18rem 0.55rem; border-radius: 100px; margin-top: 0.15rem; white-space: nowrap; }
    .status-done     { background: #f0fdf4; color: #16a34a; }
    .status-pending  { background: #fffbeb; color: #d97706; }
    .status-canceled { background: #fef2f2; color: #dc2626; }
    .upcoming-item { display: flex; align-items: center; gap: 1rem; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); min-height: 60px; transition: background 0.15s; }
    .upcoming-item:last-child { border-bottom: none; }
    .upcoming-item:hover { background: var(--bg); }
    .upcoming-date { width: 40px; text-align: center; flex-shrink: 0; }
    .upcoming-date strong { display: block; font-size: 1.1rem; font-weight: 900; color: var(--black); line-height: 1; }
    .upcoming-date span { font-size: 0.65rem; color: var(--muted2); text-transform: uppercase; }
    .upcoming-info strong { display: block; font-size: 0.83rem; font-weight: 700; color: var(--black); }
    .upcoming-info span   { font-size: 0.72rem; color: var(--muted); }
    .profile-section { padding: 1.5rem; }
    .profile-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
    .profile-avatar-lg { width: 52px; height: 52px; border-radius: 50%; background: var(--black); color: var(--white); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: 700; flex-shrink: 0; }
    .profile-name  { font-size: 0.95rem; font-weight: 700; color: var(--black); }
    .profile-email { font-size: 0.78rem; color: var(--muted); }
    .profile-field { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--border); font-size: 0.8rem; gap: 1rem; min-height: 48px; }
    .profile-field:last-child { border-bottom: none; }
    .profile-field span:first-child { color: var(--muted); }
    .profile-field span:last-child  { color: var(--black); font-weight: 700; text-align: right; }

    /* ═══════════════════════════════════════════════
       TÚNEL DE CONVERSIÓN — 3 Pasos
    ═══════════════════════════════════════════════ */

    .tnl-overlay {
      display: none;
      position: fixed; inset: 0; z-index: 800;
      background: #f5f5f5;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .tnl-overlay.tnl-open {
      display: block;
      animation: tnlIn 0.3s cubic-bezier(0.4,0,0.2,1) both;
    }
    @keyframes tnlIn { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

    .tnl-header {
      position: sticky; top: 0; z-index: 10;
      height: 64px; padding: 0 2rem;
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(245,245,245,0.94);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .tnl-logo { font-weight: 900; font-size: 1.25rem; letter-spacing: -0.04em; color: var(--black); }
    .tnl-close {
      display: flex; align-items: center; gap: 0.35rem;
      background: transparent; border: 1px solid var(--border);
      border-radius: var(--rsm); padding: 0.42rem 0.9rem;
      color: var(--muted); font-size: 0.8rem; font-family: var(--font);
      cursor: pointer; min-height: 40px;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
    }
    .tnl-close:hover { background: var(--bg3); color: var(--black); border-color: rgba(0,0,0,0.16); }

    .tnl-progress-bar {
      position: sticky; top: 64px; z-index: 9;
      height: 3px; background: var(--bg3);
    }
    .tnl-progress-fill {
      height: 100%; background: var(--black);
      border-radius: 0 2px 2px 0;
      transition: width 0.45s cubic-bezier(0.4,0,0.2,1);
    }

    .tnl-step-indicator {
      display: flex; justify-content: center; align-items: center;
      gap: 0.6rem; padding: 1.6rem 1rem 0;
    }
    .tnl-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--bg3);
      transition: background 0.3s, transform 0.3s, width 0.3s;
    }
    .tnl-dot.active  { background: var(--black); transform: scale(1.5); }
    .tnl-dot.done    { background: var(--black); opacity: 0.3; }

    .tnl-body { max-width: 780px; margin: 0 auto; padding: 2.2rem 1.5rem 6rem; }

    .tnl-view { display: none; }
    .tnl-view.tnl-active {
      display: block;
      animation: tnlStepIn 0.32s cubic-bezier(0.4,0,0.2,1) both;
    }
    .tnl-view.tnl-back {
      display: block;
      animation: tnlStepBack 0.32s cubic-bezier(0.4,0,0.2,1) both;
    }
    @keyframes tnlStepIn   { from{opacity:0;transform:translateX(28px)} to{opacity:1;transform:translateX(0)} }
    @keyframes tnlStepBack { from{opacity:0;transform:translateX(-28px)} to{opacity:1;transform:translateX(0)} }

    .tnl-eyebrow { font-size: 0.65rem; font-weight: 700; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.13em; margin-bottom: 0.5rem; }
    .tnl-title   { font-size: clamp(1.55rem, 4vw, 2.1rem); font-weight: 900; letter-spacing: -0.04em; line-height: 1.1; color: var(--black); margin-bottom: 0.45rem; }
    .tnl-sub     { font-size: 0.88rem; color: var(--muted); line-height: 1.65; margin-bottom: 2rem; }

    /* ── PASO 1: Grid de servicios ── */
    .tnl-svc-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }
    .tnl-svc-card {
      background: var(--white); border: 2px solid var(--border);
      border-radius: var(--radius); padding: 1.6rem 0.8rem;
      text-align: center; cursor: pointer;
      display: flex; flex-direction: column; align-items: center; gap: 0.55rem;
      transition: border-color 0.18s, transform 0.18s, box-shadow 0.18s;
      -webkit-tap-highlight-color: transparent; user-select: none;
    }
    .tnl-svc-card:hover {
      border-color: rgba(0,0,0,0.2);
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    .tnl-svc-card.tnl-svc-selected {
      border-color: var(--black); background: var(--black);
    }
    .tnl-svc-card.tnl-svc-selected .tnl-svc-icon { filter: grayscale(1) brightness(10); }
    .tnl-svc-card.tnl-svc-selected .tnl-svc-name { color: var(--white); }
    .tnl-svc-icon { font-size: 2.1rem; line-height: 1; }
    .tnl-svc-name { font-size: 0.83rem; font-weight: 700; color: var(--text); }

    /* ── PASO 2: Formulario de contexto ── */
    .tnl-back-btn {
      display: inline-flex; align-items: center; gap: 0.35rem;
      background: transparent; border: none; cursor: pointer;
      font-family: var(--font); font-size: 0.82rem; color: var(--muted);
      padding: 0.4rem 0; margin-bottom: 1.4rem;
      transition: color 0.15s;
    }
    .tnl-back-btn:hover { color: var(--black); }

    .tnl-field { margin-bottom: 1.1rem; }
    .tnl-field label { display: block; font-size: 0.66rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 0.38rem; }
    .tnl-field select,
    .tnl-field textarea,
    .tnl-field input[type="text"],
    .tnl-field input[type="email"],
    .tnl-field input[type="tel"],
    .tnl-field input[type="password"],
    .tnl-field input[type="date"],
    .tnl-field input[type="time"] {
      width: 100%; background: var(--white); border: 1.5px solid var(--border);
      border-radius: var(--radius); padding: 0.9rem 1.05rem;
      font-size: 1rem; font-family: var(--font); color: var(--text);
      outline: none; -webkit-appearance: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .tnl-field textarea { min-height: 96px; resize: none; line-height: 1.55; }
    .tnl-field select:focus,
    .tnl-field textarea:focus,
    .tnl-field input:focus { border-color: var(--black); box-shadow: 0 0 0 3px rgba(17,17,17,0.06); }
    .tnl-field input::placeholder,
    .tnl-field textarea::placeholder { color: var(--muted2); }
    .tnl-field input.tnl-error,
    .tnl-field select.tnl-error { border-color: #e53e3e; box-shadow: 0 0 0 3px rgba(229,62,62,0.08); }

    /* Urgencia */
    .tnl-urgency-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; margin-bottom: 0.8rem; }
    .tnl-urgency-btn {
      display: flex; align-items: center; justify-content: center; gap: 0.4rem;
      background: var(--white); border: 2px solid var(--border);
      border-radius: var(--radius); padding: 0.9rem 0.6rem;
      font-family: var(--font); font-size: 0.84rem; font-weight: 600;
      color: var(--muted); cursor: pointer; min-height: 52px;
      transition: all 0.18s; -webkit-tap-highlight-color: transparent;
    }
    .tnl-urgency-btn:hover { border-color: rgba(0,0,0,0.2); color: var(--black); }
    .tnl-urgency-btn.tnl-urg-sel { border-color: var(--black); background: var(--black); color: var(--white); }

    /* ── CALENDARIO DE FECHA Y HORA ── */
    .tnl-datetime-wrap {
      display: none;
      background: var(--white);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 1.1rem;
      animation: tnlIn 0.22s ease both;
    }
    .tnl-datetime-wrap.visible { display: block; }
    .tnl-datetime-header {
      padding: 0.85rem 1.1rem;
      background: var(--black);
      display: flex; align-items: center; gap: 0.5rem;
    }
    .tnl-datetime-header span { font-size: 0.75rem; font-weight: 700; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.1em; }
    .tnl-datetime-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }
    .tnl-datetime-col {
      padding: 1rem 1.1rem;
      border-right: 1px solid var(--border);
    }
    .tnl-datetime-col:last-child { border-right: none; }
    .tnl-datetime-col label {
      display: block;
      font-size: 0.62rem;
      font-weight: 700;
      color: var(--muted2);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }
    .tnl-datetime-col input[type="date"],
    .tnl-datetime-col input[type="time"] {
      width: 100%;
      border: none;
      background: transparent;
      font-size: 1rem;
      font-family: var(--font);
      color: var(--black);
      font-weight: 700;
      outline: none;
      padding: 0;
      cursor: pointer;
      min-height: 36px;
      -webkit-appearance: none;
    }
    .tnl-datetime-col input[type="date"]::-webkit-calendar-picker-indicator,
    .tnl-datetime-col input[type="time"]::-webkit-calendar-picker-indicator {
      opacity: 0.5;
      cursor: pointer;
    }
    .tnl-fecha-note {
      padding: 0.65rem 1.1rem;
      background: #fffbeb;
      border-top: 1px solid #fef3c7;
      font-size: 0.72rem;
      color: #92400e;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    /* Trust box */
    .tnl-trust {
      display: flex; gap: 0.9rem; align-items: flex-start;
      background: var(--white); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1rem 1.2rem; margin-bottom: 1.5rem;
    }
    .tnl-trust-icon { font-size: 1.25rem; flex-shrink: 0; margin-top: 1px; }
    .tnl-trust p { font-size: 0.8rem; color: var(--muted); line-height: 1.6; }
    .tnl-trust p b { color: var(--black); }

    /* ── PASO 3: Grid resumen + formulario ── */
    .tnl-step3-layout {
      display: grid;
      grid-template-columns: 1fr 1.15fr;
      gap: 1.4rem;
      align-items: start;
    }

    /* Recibo */
    .tnl-receipt {
      background: var(--black); border-radius: var(--radius);
      padding: 1.5rem; position: sticky; top: 84px;
    }
    .tnl-receipt-title { font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.13em; color: rgba(255,255,255,0.35); margin-bottom: 1.1rem; }
    .tnl-rrow { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.7rem 0; border-bottom: 1px solid rgba(255,255,255,0.07); }
    .tnl-rrow:last-of-type { border-bottom: none; margin-bottom: 1rem; }
    .tnl-rrow-ico { width: 30px; height: 30px; border-radius: 7px; background: rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; margin-top: 1px; }
    .tnl-rrow-info { flex: 1; min-width: 0; }
    .tnl-rrow-info small { display: block; font-size: 0.6rem; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 0.09em; margin-bottom: 0.1rem; }
    .tnl-rrow-info span  { display: block; font-size: 0.83rem; font-weight: 700; color: var(--white); word-break: break-word; }
    .tnl-receipt-badge { display: flex; align-items: center; gap: 0.6rem; background: rgba(255,255,255,0.06); border-radius: 9px; padding: 0.85rem 1rem; }
    .tnl-receipt-badge p { font-size: 0.73rem; color: rgba(255,255,255,0.5); line-height: 1.5; }
    .tnl-receipt-badge p b { color: var(--white); }

    /* Fila de fecha en recibo - oculta por defecto */
    .tnl-rrow-fecha { display: none; }
    .tnl-rrow-fecha.visible { display: flex; }

    /* Formulario paso 3 */
    .tnl-form-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.6rem; }
    .tnl-form-title { font-size: 1.05rem; font-weight: 900; letter-spacing: -0.03em; color: var(--black); margin-bottom: 0.25rem; }
    .tnl-form-sub   { font-size: 0.77rem; color: var(--muted); margin-bottom: 1.4rem; line-height: 1.55; }

    /* Nota de correo */
    .tnl-email-note {
      display: flex; align-items: flex-start; gap: 0.5rem;
      background: #f0f9ff; border: 1px solid #bae6fd;
      border-radius: var(--rsm); padding: 0.65rem 0.85rem;
      margin-top: -0.5rem; margin-bottom: 1rem;
    }
    .tnl-email-note span { font-size: 0.92rem; flex-shrink: 0; }
    .tnl-email-note p { font-size: 0.72rem; color: #0369a1; line-height: 1.5; }
    .tnl-email-note p b { color: #0c4a6e; }

    /* CTA principal */
    .tnl-cta {
      width: 100%; background: var(--black); color: var(--white) !important; border: none;
      border-radius: var(--radius); padding: 1.05rem; font-size: 0.96rem; font-weight: 700;
      font-family: var(--font); cursor: pointer; min-height: 54px;
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      transition: opacity 0.18s, transform 0.18s, box-shadow 0.18s;
      margin-top: 0.3rem;
    }
    .tnl-cta:hover:not(:disabled) { opacity: 0.83; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.18); }
    .tnl-cta:disabled { opacity: 0.42; cursor: not-allowed; transform: none; box-shadow: none; }
    .tnl-cta-note { font-size: 0.64rem; color: var(--muted2); margin-top: 0.55rem; text-align: center; }

    /* ── ÉXITO con palomita animada ── */
    .tnl-success { display: none; text-align: center; padding: 5rem 2rem 4rem; }
    .tnl-success.tnl-show { display: block; animation: fadeUp 0.5s ease both; }

    /* Círculo negro con SVG animado */
    .tnl-success-ring {
      width: 80px; height: 80px; border-radius: 50%;
      background: var(--black);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.6rem;
    }

    /* SVG del check interactivo */
    .check-svg {
      width: 44px; height: 44px;
      display: block;
    }
    .check-circle {
      stroke: rgba(255,255,255,0.15);
      stroke-width: 2;
      fill: none;
    }
    .check-mark {
      stroke: #ffffff;
      stroke-width: 3.5;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      stroke-dasharray: 36;
      stroke-dashoffset: 36;
      transition: stroke-dashoffset 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    /* Cuando el éxito es visible, animar el check */
    .tnl-success.tnl-show .check-mark {
      stroke-dashoffset: 0;
      transition-delay: 0.25s;
    }
    /* Pulso del círculo */
    .tnl-success.tnl-show .tnl-success-ring {
      animation: successPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
    }
    @keyframes successPop {
      0%   { transform: scale(0.7); opacity: 0; }
      60%  { transform: scale(1.1); }
      100% { transform: scale(1);   opacity: 1; }
    }

    .tnl-success h2 { font-size: 1.7rem; font-weight: 900; letter-spacing: -0.04em; color: var(--black); margin-bottom: 0.55rem; }
    .tnl-success p  { font-size: 0.9rem; color: var(--muted); line-height: 1.7; max-width: 380px; margin: 0 auto 2rem; }


    /* ══ FIREBASE AUTH — Paso 3 ══ */
    .tnl-google-btn {
      width: 100%; background: var(--white); color: #3c3c3c;
      border: 1.5px solid var(--border); border-radius: var(--radius);
      padding: 0.9rem 1rem; font-size: 0.9rem; font-weight: 700;
      font-family: var(--font); cursor: pointer; min-height: 52px;
      display: flex; align-items: center; justify-content: center; gap: 0.65rem;
      transition: border-color 0.18s, box-shadow 0.18s, background 0.18s;
      margin-bottom: 1.2rem;
    }
    .tnl-google-btn:hover { border-color: rgba(0,0,0,0.22); box-shadow: 0 2px 10px rgba(0,0,0,0.07); background: #fafafa; }
    .tnl-google-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .tnl-google-btn svg { flex-shrink: 0; }

    .tnl-auth-divider {
      display: flex; align-items: center; gap: 0.8rem;
      margin-bottom: 1.2rem; color: var(--muted2); font-size: 0.72rem;
    }
    .tnl-auth-divider::before,
    .tnl-auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    .tnl-auth-error {
      display: none; background: #fff0f0; border: 1px solid #fcc;
      border-radius: var(--rsm); padding: 0.65rem 0.9rem;
      font-size: 0.78rem; color: #cc3333; margin-bottom: 0.9rem;
      line-height: 1.5;
    }
    .tnl-auth-error.visible { display: block; animation: fadeUp 0.2s ease both; }

    .tnl-mode-toggle {
      font-size: 0.74rem; color: var(--muted); text-align: center;
      margin-top: 0.6rem; line-height: 1.6;
    }
    .tnl-mode-toggle button {
      background: none; border: none; color: var(--black); font-weight: 700;
      cursor: pointer; font-family: var(--font); font-size: 0.74rem;
      text-decoration: underline; padding: 0; min-height: 0;
    }

    /* Campo contraseña con ojo toggle */
    .tnl-pass-wrap { position: relative; }
    .tnl-pass-wrap input { padding-right: 3rem; }
    .tnl-pass-toggle {
      position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%);
      background: none; border: none; cursor: pointer; color: var(--muted);
      font-size: 1.1rem; padding: 0.3rem; line-height: 1; display: flex;
      align-items: center; justify-content: center; width: 28px; height: 28px;
    }
    .tnl-pass-toggle:hover { color: var(--black); }

    /* Reset contraseña */
    .tnl-forgot-wrap {
      text-align: right; margin-top: -0.3rem; margin-bottom: 0.2rem;
    }
    .tnl-forgot-btn {
      background: none; border: none; cursor: pointer; font-family: var(--font);
      font-size: 0.72rem; color: var(--muted); text-decoration: underline; padding: 0;
    }
    .tnl-forgot-btn:hover { color: var(--black); }
    .tnl-reset-msg {
      display: none; font-size: 0.74rem; border-radius: var(--rsm);
      padding: 0.6rem 0.85rem; margin-bottom: 0.6rem; line-height: 1.5;
    }
    .tnl-reset-msg.ok  { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; display: block; }
    .tnl-reset-msg.err { background: #fff0f0; color: #cc3333; border: 1px solid #fcc;    display: block; }

    /* Indicador de sesion activa en paso 3 */
    .tnl-session-banner {
      display: none; align-items: center; gap: 0.7rem;
      background: #f0fdf4; border: 1px solid #bbf7d0;
      border-radius: var(--radius); padding: 0.85rem 1rem; margin-bottom: 1.2rem;
    }
    .tnl-session-banner.visible { display: flex; }
    .tnl-session-avatar {
      width: 32px; height: 32px; border-radius: 50%;
      background: var(--black); color: var(--white);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700; flex-shrink: 0;
    }
    .tnl-session-info { flex: 1; }
    .tnl-session-info strong { display: block; font-size: 0.82rem; font-weight: 700; color: #16a34a; }
    .tnl-session-info span   { font-size: 0.72rem; color: var(--muted); }
    .tnl-session-out {
      background: none; border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;
      font-size: 0.7rem; color: var(--muted); cursor: pointer; padding: 0.3rem 0.6rem;
      font-family: var(--font); white-space: nowrap; flex-shrink: 0;
    }
    .tnl-session-out:hover { color: var(--black); border-color: rgba(0,0,0,0.2); }

    /* Auth fields se ocultan si ya hay sesion */
    .tnl-auth-fields { }
    .tnl-auth-fields.hidden { display: none; }

    /* ══ DASHBOARD PLATFORM ══ */
    #dashboard { display:none; position:fixed; inset:0; z-index:500; flex-direction:column; background:#f8f9fc; }
    #dashboard.dash-open { display:flex; }
    /* Layout */
    .dash-layout { display:flex; flex:1; overflow:hidden; }
    /* Sidebar */
    .dash-sidebar { width:240px; background:#fff; border-right:1px solid #e5e7eb; display:flex; flex-direction:column; flex-shrink:0; overflow-y:auto; }
    .dash-sidebar-user { padding:1.75rem 1.25rem 1.25rem; border-bottom:1px solid #e5e7eb; display:flex; flex-direction:column; align-items:center; gap:0.45rem; text-align:center; }
    .dash-sidebar-avatar { width:50px; height:50px; border-radius:50%; background:#111; color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.2rem; font-weight:700; flex-shrink:0; }
    .dash-sidebar-uwelcome { font-size:0.69rem; color:#9ca3af; font-weight:600; text-transform:uppercase; letter-spacing:0.06em; }
    .dash-sidebar-uname { font-size:0.9rem; font-weight:800; color:#111; }
    .dash-sidebar-nav { flex:1; padding:0.75rem; display:flex; flex-direction:column; gap:0.1rem; }
    .dash-nav-link { display:flex; align-items:center; gap:0.7rem; padding:0.68rem 0.85rem; font-size:0.83rem; font-weight:600; color:#6b7280; cursor:pointer; border-radius:9px; transition:all 0.15s; user-select:none; }
    .dash-nav-link svg { flex-shrink:0; opacity:0.65; transition:opacity 0.15s; }
    .dash-nav-link:hover { color:#111; background:#f3f4f6; }
    .dash-nav-link:hover svg { opacity:1; }
    .dash-nav-link.active { color:#111; background:#f3f4f6; font-weight:700; }
    .dash-nav-link.active svg { opacity:1; }
    .dash-sidebar-bottom { padding:0.75rem; border-top:1px solid #e5e7eb; }
    .dash-nav-logout { display:flex; align-items:center; gap:0.7rem; padding:0.68rem 0.85rem; font-size:0.83rem; font-weight:600; color:#ef4444; cursor:pointer; border-radius:9px; transition:background 0.15s; }
    .dash-nav-logout:hover { background:#fef2f2; }
    /* Main */
    .dash-main-scroll { flex:1; overflow-y:auto; background:#f8f9fc; padding:2rem 2.25rem; }
    .dash-view { display:none; }
    .dash-view.active { display:block; animation:fadeUp 0.22s ease both; }
    /* CTA button */
    .dash-cta-btn { background:#111; color:#fff; border:none; border-radius:9px; padding:0.65rem 1.2rem; font-size:0.8rem; font-weight:700; cursor:pointer; font-family:var(--font); display:inline-flex; align-items:center; gap:0.4rem; white-space:nowrap; transition:opacity 0.15s; flex-shrink:0; }
    .dash-cta-btn:hover { opacity:0.78; }
    /* Hero banner */
    .dash-hero { background:#111; border-radius:18px; padding:2.25rem 2.5rem; display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem; overflow:hidden; position:relative; min-height:168px; }
    .dash-hero-content { flex:1; z-index:1; max-width:360px; }
    .dash-hero-tag { display:inline-block; background:rgba(255,255,255,0.1); color:rgba(255,255,255,0.65); font-size:0.66rem; font-weight:700; letter-spacing:0.09em; text-transform:uppercase; padding:0.28rem 0.75rem; border-radius:100px; margin-bottom:0.85rem; }
    .dash-hero-title { font-size:1.4rem; font-weight:900; color:#fff; letter-spacing:-0.04em; line-height:1.22; margin-bottom:0.35rem; }
    .dash-hero-sub { font-size:0.82rem; color:rgba(255,255,255,0.5); margin-bottom:1.4rem; }
    .dash-hero-btn { display:inline-flex; align-items:center; gap:0.45rem; background:#fff; color:#111; border:none; border-radius:9px; padding:0.65rem 1.25rem; font-size:0.8rem; font-weight:700; cursor:pointer; font-family:var(--font); transition:opacity 0.15s; }
    .dash-hero-btn:hover { opacity:0.88; }
    .dash-hero-illo { width:190px; display:flex; align-items:center; justify-content:flex-end; flex-shrink:0; z-index:1; }
    /* Stat cards */
    .dash-stats-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:1.5rem; }
    .dash-stat-card { border-radius:14px; padding:1.35rem 1.4rem; display:flex; align-items:center; justify-content:space-between; }
    .dash-stat-mint  { background:#ecfdf5; }
    .dash-stat-cream { background:#fffbeb; }
    .dash-stat-info  { display:flex; flex-direction:column; gap:0.2rem; }
    .dash-stat-label { font-size:0.69rem; font-weight:700; color:#6b7280; text-transform:uppercase; letter-spacing:0.07em; }
    .dash-stat-value { font-size:2rem; font-weight:900; letter-spacing:-0.05em; line-height:1.1; }
    .dash-stat-mint  .dash-stat-value { color:#065f46; }
    .dash-stat-cream .dash-stat-value { color:#92400e; }
    .dash-stat-sub { font-size:0.7rem; }
    .dash-stat-mint  .dash-stat-sub { color:#34d399; }
    .dash-stat-cream .dash-stat-sub { color:#fbbf24; }
    .dash-stat-ico-wrap { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    .dash-stat-mint  .dash-stat-ico-wrap { background:rgba(16,185,129,0.14); color:#059669; }
    .dash-stat-cream .dash-stat-ico-wrap { background:rgba(245,158,11,0.14); color:#d97706; }
    /* Section header */
    .dash-section-hd { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.85rem; }
    .dash-section-hd h3 { font-size:0.9rem; font-weight:800; color:#111; }
    .dash-see-all { font-size:0.77rem; color:#9ca3af; cursor:pointer; background:none; border:none; font-family:var(--font); padding:0; }
    .dash-see-all:hover { color:#111; }
    /* Catalog */
    .dash-catalog-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:0.75rem; margin-bottom:1.75rem; }
    .dash-catalog-card { background:#fff; border:1px solid #e5e7eb; border-radius:13px; padding:1.2rem 0.6rem 1rem; text-align:center; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:0.5rem; transition:all 0.18s; user-select:none; -webkit-tap-highlight-color:transparent; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
    .dash-catalog-card:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.09); border-color:#d1d5db; }
    .dash-catalog-ico-wrap { width:42px; height:42px; border-radius:11px; display:flex; align-items:center; justify-content:center; }
    .dash-catalog-name { font-size:0.72rem; font-weight:700; color:#374151; }
    .ic-blue   { background:#eff6ff; color:#3b82f6; }
    .ic-yellow { background:#fef9c3; color:#ca8a04; }
    .ic-green  { background:#f0fdf4; color:#16a34a; }
    .ic-purple { background:#fdf4ff; color:#a855f7; }
    .ic-orange { background:#fff7ed; color:#f97316; }
    .ic-teal   { background:#f0fdfa; color:#0d9488; }
    .ic-sky    { background:#f0f9ff; color:#0ea5e9; }
    .ic-gray   { background:#f3f4f6; color:#6b7280; }
    /* Table */
    .dash-tbl-card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,0.04); margin-bottom:1.5rem; }
    .dash-tbl-scroll { overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .dash-table { width:100%; border-collapse:collapse; font-size:0.81rem; min-width:520px; }
    .dash-table th { padding:0.7rem 1rem; text-align:left; font-size:0.66rem; font-weight:700; color:#9ca3af; text-transform:uppercase; letter-spacing:0.07em; background:#f9fafb; border-bottom:1px solid #e5e7eb; white-space:nowrap; }
    .dash-table td { padding:0.85rem 1rem; border-bottom:1px solid #f3f4f6; color:#374151; vertical-align:middle; }
    .dash-table tr:last-child td { border-bottom:none; }
    .dash-table tbody tr:hover td { background:#fafafa; }
    .dash-tbl-svc-ico { width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    .dash-tbl-badge { display:inline-flex; align-items:center; padding:0.2rem 0.6rem; border-radius:100px; font-size:0.67rem; font-weight:700; white-space:nowrap; }
    .badge-enviada    { background:#d1fae5; color:#065f46; }
    .badge-nueva      { background:#dbeafe; color:#1e40af; }
    .badge-pendiente  { background:#fef3c7; color:#92400e; }
    .badge-completado { background:#dbeafe; color:#1e40af; }
    .dash-tbl-report { display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; border-radius:7px; background:#f3f4f6; border:none; cursor:pointer; color:#6b7280; transition:all 0.15s; }
    .dash-tbl-report:hover { background:#e5e7eb; color:#111; }
    /* Empty state */
    .dash-empty { text-align:center; padding:3rem 2rem; }
    .dash-empty h4 { font-size:0.93rem; font-weight:700; color:#111; margin-bottom:0.4rem; }
    .dash-empty p { font-size:0.81rem; color:#6b7280; line-height:1.65; margin-bottom:1.2rem; }
    /* Profile */
    .dash-profile-card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; max-width:480px; margin-bottom:1.2rem; }
    .dash-profile-head { background:#111; padding:2rem 1.5rem; display:flex; align-items:center; gap:1.2rem; }
    .dash-profile-avatar-xl { width:60px; height:60px; border-radius:50%; background:rgba(255,255,255,0.12); color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.4rem; font-weight:700; flex-shrink:0; }
    /* Mobile dash header */
    .dash-mobile-hd { display:none; height:52px; background:#fff; border-bottom:1px solid #e5e7eb; flex-shrink:0; align-items:center; justify-content:space-between; padding:0 1.1rem; }
    .dash-mobile-back { display:flex; align-items:center; gap:0.35rem; background:none; border:none; cursor:pointer; font-family:var(--font); font-size:0.83rem; font-weight:700; color:#111; padding:0.4rem 0.3rem; -webkit-tap-highlight-color:transparent; }
    .dash-mobile-logo-txt { font-weight:900; font-size:1.15rem; letter-spacing:-0.04em; color:#111; }
    /* Mobile bottom nav */
    .dash-bottom-nav { display:none; background:#fff; border-top:1px solid #e5e7eb; flex-shrink:0; width:100%; padding-bottom: env(safe-area-inset-bottom); }
    .dash-bottom-inner { display:flex; height:64px; align-items:stretch; width:100%; }
    .dash-bot-item { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:0.22rem; cursor:pointer; color:#9ca3af; transition:color 0.15s; user-select:none; min-height:44px; -webkit-tap-highlight-color:transparent; }
    .dash-bot-item svg { width:20px; height:20px; flex-shrink:0; }
    .dash-bot-label { font-size:0.58rem; font-weight:500; letter-spacing:0.01em; line-height:1; }
    .dash-bot-item { position:relative; }
    .dash-bot-item.active { color:#111; }
    .dash-bot-item.active svg { stroke:#111; }
    .dash-bot-item.active::after { content:''; position:absolute; top:0; left:50%; transform:translateX(-50%); width:24px; height:2.5px; background:#111; border-radius:0 0 3px 3px; }
    /* Badge notificación */
    .dash-bot-badge { position:absolute; top:-3px; right:-5px; width:8px; height:8px; background:#ef4444; border-radius:50%; border:2px solid #fff; display:none; }
    .dash-bot-badge.visible { display:block; }
    /* Skeleton loaders */
    @keyframes shimmer { 0%{background-position:-400px 0} 100%{background-position:400px 0} }
    .dash-skel-line { border-radius:6px; background:linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%); background-size:400px 100%; animation:shimmer 1.3s ease-in-out infinite; }
    .dash-skel-row { display:flex; align-items:center; gap:0.75rem; padding:0.9rem 1rem; border-bottom:1px solid #f3f4f6; }
    .dash-skel-ico { width:32px; height:32px; border-radius:8px; flex-shrink:0; }
    .dash-skel-lines { flex:1; display:flex; flex-direction:column; gap:0.35rem; }
    /* Status chips */
    .badge-pending  { background:#fef3c7; color:#92400e; }
    .badge-progress { background:#dbeafe; color:#1d4ed8; }
    .badge-done     { background:#d1fae5; color:#065f46; }
    /* Onboarding */
    .onb-overlay { display:none; position:fixed; inset:0; z-index:600; background:rgba(17,17,17,0.6); backdrop-filter:blur(8px); align-items:center; justify-content:center; padding:1.5rem; }
    .onb-overlay.onb-open { display:flex; animation:fadeIn 0.25s ease; }
    .onb-card { background:#fff; border-radius:20px; width:100%; max-width:420px; padding:2rem 1.75rem; }
    .onb-step { display:none; }
    .onb-step.onb-active { display:block; animation:tnlStepIn 0.28s ease both; }
    .onb-logo { font-weight:900; font-size:1.1rem; letter-spacing:-0.04em; color:#111; margin-bottom:1.25rem; }
    .onb-prog { display:flex; gap:0.3rem; margin-bottom:1.25rem; }
    .onb-prog-dot { height:3px; flex:1; background:#e5e7eb; border-radius:3px; transition:background 0.2s; }
    .onb-prog-dot.done { background:#111; }
    .onb-title { font-size:1.4rem; font-weight:900; letter-spacing:-0.04em; color:#111; margin-bottom:0.3rem; line-height:1.2; }
    .onb-sub { font-size:0.83rem; color:#6b7280; margin-bottom:1.4rem; line-height:1.6; }
    .onb-field { margin-bottom:0.8rem; }
    .onb-field label { display:block; font-size:0.66rem; font-weight:700; color:#9ca3af; text-transform:uppercase; letter-spacing:0.09em; margin-bottom:0.3rem; }
    .onb-field input { width:100%; border:1.5px solid #e5e7eb; border-radius:10px; padding:0.7rem 0.85rem; font-size:0.88rem; font-family:var(--font); color:#111; outline:none; background:#fff; }
    .onb-field input:focus { border-color:#111; }
    .onb-btn { width:100%; background:#111; color:#fff; border:none; border-radius:10px; padding:0.82rem; font-size:0.88rem; font-weight:700; cursor:pointer; font-family:var(--font); margin-top:0.4rem; transition:opacity 0.15s; }
    .onb-btn:hover { opacity:0.8; }
    .onb-skip { display:block; text-align:center; font-size:0.75rem; color:#9ca3af; margin-top:0.85rem; cursor:pointer; border:none; background:none; font-family:var(--font); width:100%; }
    .onb-skip:hover { color:#111; }
    /* Profile extra fields */
    .dash-prof-row { display:flex; justify-content:space-between; align-items:center; padding:1rem 1.5rem; border-bottom:1px solid #e5e7eb; min-height:52px; }
    .dash-prof-row:last-child { border-bottom:none; }
    .dash-prof-label { font-size:0.8rem; color:#6b7280; font-weight:600; }
    .dash-prof-val { font-size:0.85rem; font-weight:700; color:#111; text-align:right; max-width:60%; word-break:break-word; }
    .dash-prof-edit-btn { background:none; border:1.5px solid #e5e7eb; border-radius:8px; padding:0.35rem 0.75rem; font-size:0.72rem; font-weight:700; color:#6b7280; cursor:pointer; font-family:var(--font); white-space:nowrap; transition:border-color 0.15s,color 0.15s; }
    .dash-prof-edit-btn:hover { border-color:#111; color:#111; }
    .dash-prof-edit-form { display:none; padding:1.25rem 1.5rem; border-top:1px solid #e5e7eb; gap:0.7rem; flex-direction:column; }
    .dash-prof-edit-form.open { display:flex; }
    .dash-prof-field label { display:block; font-size:0.66rem; font-weight:700; color:#9ca3af; text-transform:uppercase; letter-spacing:0.09em; margin-bottom:0.3rem; }
    .dash-prof-field input { width:100%; border:1.5px solid #e5e7eb; border-radius:9px; padding:0.6rem 0.8rem; font-size:0.85rem; font-family:var(--font); color:#111; outline:none; }
    .dash-prof-field input:focus { border-color:#111; }
    .dash-prof-save { background:#111; color:#fff; border:none; border-radius:9px; padding:0.6rem 1.2rem; font-size:0.82rem; font-weight:700; cursor:pointer; font-family:var(--font); align-self:flex-start; }
    .dash-bot-cta { flex:none; display:flex; align-items:center; justify-content:center; padding:0 1rem; }
    .dash-bot-cta-pill { display:flex; align-items:center; gap:0.3rem; background:#111; color:#fff; border-radius:999px; height:36px; padding:0 14px; cursor:pointer; -webkit-tap-highlight-color:transparent; user-select:none; }
    .dash-bot-cta-pill svg { width:14px; height:14px; flex-shrink:0; }
    .dash-bot-cta-pill span { font-size:0.72rem; font-weight:700; letter-spacing:-0.01em; white-space:nowrap; }

    /* ══ ROLE PICKER ══ */
    #rolePicker { display:none; position:fixed; inset:0; z-index:550; background:rgba(8,9,15,0.88); backdrop-filter:blur(14px); align-items:center; justify-content:center; padding:1.5rem; }
    #rolePicker.rp-open { display:flex; animation:fadeIn 0.22s ease; }
    .rp-card { background:#fff; border-radius:22px; width:100%; max-width:440px; padding:2.25rem 2rem 2rem; text-align:center; box-shadow:0 32px 80px rgba(0,0,0,0.4); }
    .rp-logo { font-weight:900; font-size:1.15rem; letter-spacing:-0.04em; color:#111; margin-bottom:1.5rem; }
    .rp-title { font-size:1.45rem; font-weight:900; letter-spacing:-0.04em; color:#111; margin-bottom:0.3rem; line-height:1.2; }
    .rp-sub { font-size:0.82rem; color:#9ca3af; margin-bottom:1.85rem; }
    .rp-options { display:grid; grid-template-columns:1fr 1fr; gap:0.85rem; }
    .rp-option { background:#f9fafb; border:2px solid #e5e7eb; border-radius:16px; padding:1.75rem 1rem 1.4rem; cursor:pointer; font-family:var(--font); transition:all 0.18s; text-align:center; display:flex; flex-direction:column; align-items:center; gap:0.5rem; }
    .rp-option:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.1); }
    .rp-opt-client:hover { border-color:#111; background:#fff; }
    .rp-opt-tech:hover { border-color:#3b82f6; background:#eff6ff; }
    .rp-option-icon { font-size:2.2rem; line-height:1; }
    .rp-option-label { font-size:0.95rem; font-weight:800; color:#111; letter-spacing:-0.02em; }
    .rp-option-desc { font-size:0.72rem; color:#9ca3af; line-height:1.4; }

    /* ══ TECH DASHBOARD ══ */
    #techDashboard { display:none; position:fixed; inset:0; z-index:500; background:#f3f4f6; }
    #techDashboard.tech-open { display:block; }
    .tech-layout { position:absolute; inset:0; display:flex; overflow:hidden; }
    /* Sidebar */
    .tech-sidebar { position:relative; width:240px; min-width:240px; max-width:240px; height:100%; background:#fff; border-right:1px solid #e5e7eb; display:flex; flex-direction:column; flex-shrink:0; overflow-y:auto; }
    .tech-sidebar-brand { padding:1.4rem 1.25rem 1.1rem; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between; }
    .tech-brand-logo { font-weight:900; font-size:1.15rem; letter-spacing:-0.04em; color:#111; }
    .tech-brand-chip { font-size:0.58rem; font-weight:700; letter-spacing:0.1em; text-transform:uppercase; background:#eff6ff; color:#3b82f6; padding:0.22rem 0.6rem; border-radius:100px; border:1px solid #bfdbfe; }
    .tech-sidebar-user { padding:1.1rem 1.25rem; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; gap:0.85rem; }
    .tech-sidebar-avatar { width:38px; height:38px; border-radius:50%; background:linear-gradient(135deg,#3b82f6 0%,#6366f1 100%); color:#fff; display:flex; align-items:center; justify-content:center; font-size:0.95rem; font-weight:700; flex-shrink:0; }
    .tech-sidebar-info { flex:1; min-width:0; }
    .tech-sidebar-uname { font-size:0.84rem; font-weight:700; color:#111; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .tech-sidebar-uemail { font-size:0.67rem; color:#9ca3af; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    /* Status toggle */
    .tech-status-wrap { padding:0.85rem 1rem; border-bottom:1px solid #e5e7eb; }
    .tech-status-toggle { background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; padding:0.75rem 0.9rem; display:flex; align-items:center; justify-content:space-between; cursor:pointer; transition:all 0.2s; user-select:none; }
    .tech-status-toggle:hover { border-color:#d1d5db; }
    .tech-status-toggle.ts-on { border-color:rgba(16,185,129,0.35); background:rgba(16,185,129,0.06); }
    .tech-status-left { display:flex; align-items:center; gap:0.6rem; }
    .tech-status-dot { width:8px; height:8px; border-radius:50%; background:#d1d5db; flex-shrink:0; transition:background 0.25s; }
    .tech-status-toggle.ts-on .tech-status-dot { background:#10b981; animation:techPulse 2s ease-in-out infinite; }
    @keyframes techPulse { 0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.5)} 50%{box-shadow:0 0 0 5px rgba(16,185,129,0)} }
    .tech-status-lbl { font-size:0.75rem; font-weight:700; color:#9ca3af; }
    .tech-status-toggle.ts-on .tech-status-lbl { color:#10b981; }
    .tech-sw { width:30px; height:17px; border-radius:9px; background:#e5e7eb; border:1.5px solid #d1d5db; position:relative; transition:background 0.25s; flex-shrink:0; }
    .tech-sw::after { content:''; position:absolute; top:2px; left:2px; width:9px; height:9px; border-radius:50%; background:#9ca3af; transition:all 0.25s; }
    .tech-status-toggle.ts-on .tech-sw { background:#10b981; border-color:transparent; }
    .tech-status-toggle.ts-on .tech-sw::after { left:calc(100% - 11px); background:#fff; }
    /* Nav links */
    .tech-sidebar-nav { flex:1; min-height:0; padding:0.65rem; display:flex; flex-direction:column; gap:0.06rem; }
    .tech-nav-link { display:flex; align-items:center; gap:0.7rem; padding:0.65rem 0.85rem; font-size:0.81rem; font-weight:600; color:#6b7280; cursor:pointer; border-radius:10px; transition:all 0.15s; user-select:none; position:relative; }
    .tech-nav-link svg { flex-shrink:0; opacity:0.5; transition:opacity 0.15s; }
    .tech-nav-link:hover { color:#374151; background:#f3f4f6; }
    .tech-nav-link:hover svg { opacity:0.8; }
    .tech-nav-link.active { color:#1d4ed8; background:#eff6ff; }
    .tech-nav-link.active svg { opacity:1; stroke:#3b82f6; }
    .tech-nav-badge { margin-left:auto; background:#ef4444; color:#fff; font-size:0.58rem; font-weight:700; padding:0.13rem 0.42rem; border-radius:100px; min-width:16px; text-align:center; display:none; }
    .tech-nav-badge.visible { display:block; }
    .tech-sidebar-bottom { padding:0.65rem; border-top:1px solid #e5e7eb; display:flex; flex-direction:column; gap:0.06rem; }
    .tech-nav-switch { display:flex; align-items:center; gap:0.7rem; padding:0.65rem 0.85rem; font-size:0.81rem; font-weight:600; color:#6b7280; cursor:pointer; border-radius:10px; transition:background 0.15s; }
    .tech-nav-switch:hover { background:#f3f4f6; color:#374151; }
    .tech-nav-logout { display:flex; align-items:center; gap:0.7rem; padding:0.65rem 0.85rem; font-size:0.81rem; font-weight:600; color:#ef4444; cursor:pointer; border-radius:10px; transition:background 0.15s; opacity:0.7; }
    .tech-nav-logout:hover { background:rgba(239,68,68,0.06); opacity:1; }
    /* Main */
    .tech-main { flex:1; min-width:0; min-height:0; overflow-y:auto; background:#f3f4f6; padding:2rem 2.25rem; height:100%; }
    .tech-view { display:none; }
    .tech-view.active { display:block; animation:fadeUp 0.22s ease both; }
    /* View header */
    .tech-view-hd { margin-bottom:1.75rem; }
    .tech-view-hd h2 { font-size:1.45rem; font-weight:900; color:#111; letter-spacing:-0.04em; line-height:1; }
    .tech-view-hd p { font-size:0.78rem; color:#6b7280; margin-top:0.2rem; }
    .tech-view-hd-row { display:flex; align-items:flex-end; justify-content:space-between; }
    /* 4 Metric chips */
    .tech-metrics { display:grid; grid-template-columns:repeat(4,1fr); gap:0.8rem; margin-bottom:1.75rem; }
    .tech-metric { background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:1.2rem 1.1rem; }
    .tech-metric-label { font-size:0.65rem; font-weight:700; color:#6b7280; text-transform:uppercase; letter-spacing:0.09em; margin-bottom:0.6rem; }
    .tech-metric-value { font-size:1.75rem; font-weight:900; letter-spacing:-0.05em; line-height:1; margin-bottom:0.25rem; }
    .tech-metric-sub { font-size:0.67rem; color:#9ca3af; }
    .tm-blue { border-color:rgba(59,130,246,0.22); } .tm-blue .tech-metric-value { color:#2563eb; }
    .tm-green { border-color:rgba(16,185,129,0.22); } .tm-green .tech-metric-value { color:#059669; }
    .tm-amber { border-color:rgba(245,158,11,0.22); } .tm-amber .tech-metric-value { color:#d97706; }
    .tm-purple { border-color:rgba(139,92,246,0.22); } .tm-purple .tech-metric-value { color:#7c3aed; }
    /* Section header */
    .tech-sec-hd { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.85rem; }
    .tech-sec-hd h3 { font-size:0.72rem; font-weight:700; color:#6b7280; text-transform:uppercase; letter-spacing:0.09em; }
    .tech-sec-link { font-size:0.75rem; color:#3b82f6; background:none; border:none; cursor:pointer; font-family:var(--font); padding:0; }
    /* Job card */
    .tech-job-card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; margin-bottom:0.85rem; transition:border-color 0.18s; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
    .tech-job-card:hover { border-color:#d1d5db; }
    .tech-job-head { padding:1rem 1.3rem; display:flex; align-items:center; gap:0.9rem; }
    .tech-job-ico { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.15rem; flex-shrink:0; border:1px solid #e5e7eb; }
    .tech-job-ico-blue { background:#eff6ff; border-color:#bfdbfe; }
    .tech-job-ico-green { background:#f0fdf4; border-color:#bbf7d0; }
    .tech-job-meta { flex:1; min-width:0; }
    .tech-job-svc { font-size:0.9rem; font-weight:700; color:#111; }
    .tech-job-loc { font-size:0.73rem; color:#6b7280; margin-top:0.12rem; }
    .tech-job-badge { font-size:0.62rem; font-weight:700; padding:0.2rem 0.6rem; border-radius:100px; white-space:nowrap; flex-shrink:0; }
    .tb-new { background:#eff6ff; color:#2563eb; border:1px solid #bfdbfe; }
    .tb-active { background:#f0fdf4; color:#059669; border:1px solid #bbf7d0; }
    .tb-done { background:#f3f4f6; color:#6b7280; border:1px solid #e5e7eb; }
    .tech-job-body { padding:0 1.3rem 1rem; border-top:1px solid #f3f4f6; padding-top:0.85rem; }
    .tech-job-desc { font-size:0.77rem; color:#6b7280; margin-bottom:0.85rem; line-height:1.55; }
    .tech-job-actions { display:flex; gap:0.55rem; flex-wrap:wrap; }
    /* Tech buttons */
    .tbtn-primary { background:#3b82f6; color:#fff; border:none; border-radius:9px; padding:0.55rem 1rem; font-size:0.76rem; font-weight:700; cursor:pointer; font-family:var(--font); transition:opacity 0.15s; white-space:nowrap; }
    .tbtn-primary:hover { opacity:0.85; }
    .tbtn-ghost { background:#f3f4f6; color:#374151; border:1px solid #e5e7eb; border-radius:9px; padding:0.55rem 1rem; font-size:0.76rem; font-weight:700; cursor:pointer; font-family:var(--font); transition:all 0.15s; white-space:nowrap; }
    .tbtn-ghost:hover { background:#e5e7eb; color:#111; }
    .tbtn-danger { background:#fef2f2; color:#dc2626; border:1px solid #fecaca; border-radius:9px; padding:0.55rem 1rem; font-size:0.76rem; font-weight:700; cursor:pointer; font-family:var(--font); transition:all 0.15s; white-space:nowrap; }
    .tbtn-danger:hover { background:#fee2e2; }
    /* Timer */
    .tech-timer-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem; }
    .tech-timer-lbl { font-size:0.7rem; font-weight:600; color:#d97706; }
    .tech-timer-bar { height:3px; background:#e5e7eb; border-radius:3px; overflow:hidden; margin-bottom:0.85rem; }
    .tech-timer-fill { height:100%; background:#f59e0b; border-radius:3px; transition:width 1s linear; }
    /* Earnings card */
    .tech-earn-card { background:linear-gradient(135deg,#eff6ff 0%,#dbeafe 100%); border:1px solid rgba(59,130,246,0.2); border-radius:16px; padding:1.5rem 1.75rem; margin-bottom:1.2rem; display:flex; align-items:center; justify-content:space-between; }
    .tech-earn-label { font-size:0.65rem; font-weight:700; color:rgba(37,99,235,0.65); text-transform:uppercase; letter-spacing:0.09em; margin-bottom:0.3rem; }
    .tech-earn-value { font-size:2.2rem; font-weight:900; color:#1d4ed8; letter-spacing:-0.05em; line-height:1; }
    .tech-earn-sub { font-size:0.7rem; color:rgba(37,99,235,0.5); margin-top:0.2rem; }
    .tech-earn-ico { width:52px; height:52px; border-radius:13px; background:#eff6ff; border:1px solid #bfdbfe; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    /* Rating */
    .tech-rating-row { display:flex; align-items:center; gap:0.35rem; margin-top:0.35rem; }
    .tech-stars { color:#f59e0b; font-size:0.82rem; letter-spacing:0.04em; }
    .tech-rating-num { font-size:0.82rem; font-weight:700; color:#111; }
    .tech-rating-cnt { font-size:0.7rem; color:#9ca3af; }
    /* Empty state */
    .tech-empty { text-align:center; padding:2.5rem 2rem; }
    .tech-empty-ico { font-size:2.2rem; margin-bottom:0.85rem; opacity:0.4; }
    .tech-empty h4 { font-size:0.88rem; font-weight:700; color:#9ca3af; margin-bottom:0.35rem; }
    .tech-empty p { font-size:0.76rem; color:#9ca3af; line-height:1.65; }
    /* Profile tech */
    .tech-profile-head { background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:1.75rem 1.5rem; display:flex; align-items:center; gap:1.2rem; margin-bottom:1rem; }
    .tech-profile-av { width:62px; height:62px; border-radius:50%; background:linear-gradient(135deg,#3b82f6 0%,#6366f1 100%); color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.45rem; font-weight:700; flex-shrink:0; }
    .tech-profile-name { font-size:1.1rem; font-weight:800; color:#111; letter-spacing:-0.02em; }
    .tech-profile-role-lbl { font-size:0.7rem; font-weight:600; color:#3b82f6; margin-top:0.12rem; }
    .tech-profile-card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; margin-bottom:1rem; }
    .tech-prof-row { display:flex; align-items:center; justify-content:space-between; padding:0.88rem 1.35rem; border-bottom:1px solid #f3f4f6; min-height:48px; }
    .tech-prof-row:last-child { border-bottom:none; }
    .tech-prof-label { font-size:0.77rem; color:#6b7280; font-weight:600; }
    .tech-prof-val { font-size:0.82rem; font-weight:700; color:#111; text-align:right; max-width:60%; word-break:break-word; }
    .tech-prof-card-title { font-size:0.72rem; font-weight:700; color:#9ca3af; text-transform:uppercase; letter-spacing:0.09em; padding:0.88rem 1.35rem 0.4rem; border-bottom:1px solid #f3f4f6; }
    .tech-svc-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:0.5rem; padding:0.9rem 1.35rem 1.1rem; }
    .tech-svc-check { display:flex; align-items:center; gap:0.4rem; cursor:pointer; }
    .tech-svc-check input { width:14px; height:14px; accent-color:#3b82f6; cursor:pointer; flex-shrink:0; }
    .tech-svc-check span { font-size:0.73rem; color:#9ca3af; font-weight:600; }
    .tech-svc-check input:checked + span { color:#111; }
    /* Mobile tech header */
    .tech-mobile-hd { display:none; position:absolute; top:0; left:0; right:0; z-index:5; height:52px; background:#fff; border-bottom:1px solid #e5e7eb; align-items:center; justify-content:space-between; padding:0 1.1rem; }
    .tech-mobile-logo { font-weight:900; font-size:1.1rem; letter-spacing:-0.04em; color:#111; }
    .tech-mobile-right { display:flex; align-items:center; gap:0.6rem; }
    .tech-mobile-status { display:flex; align-items:center; gap:0.4rem; font-size:0.72rem; font-weight:700; color:#9ca3af; cursor:pointer; padding:0.4rem 0.7rem; border-radius:100px; border:1px solid #e5e7eb; }
    .tech-mobile-status.ts-on { color:#10b981; border-color:rgba(16,185,129,0.28); background:rgba(16,185,129,0.07); }
    .tech-mob-dot { width:6px; height:6px; border-radius:50%; background:#d1d5db; flex-shrink:0; }
    .tech-mobile-status.ts-on .tech-mob-dot { background:#10b981; animation:techPulse 2s ease-in-out infinite; }
    /* Hamburger button */
    .tech-mob-hamburger { display:flex; flex-direction:column; justify-content:center; align-items:center; gap:4px; width:40px; height:40px; background:transparent; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer; flex-shrink:0; }
    .tech-mob-hamburger span { display:block; width:18px; height:2px; background:#111; border-radius:2px; transition:all 0.22s ease; }
    .tech-mob-hamburger.open span:nth-child(1) { transform:translateY(6px) rotate(45deg); }
    .tech-mob-hamburger.open span:nth-child(2) { opacity:0; transform:scaleX(0); }
    .tech-mob-hamburger.open span:nth-child(3) { transform:translateY(-6px) rotate(-45deg); }
    /* Mobile sidebar drawer */
    .tech-sidebar-overlay { display:none; position:fixed; inset:0; z-index:600; background:rgba(0,0,0,0.35); }
    .tech-sidebar-overlay.open { display:block; animation:fadeIn 0.2s ease; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .tech-sidebar-drawer { position:fixed; top:0; left:0; bottom:0; width:260px; z-index:601; background:#fff; border-right:1px solid #e5e7eb; display:flex; flex-direction:column; transform:translateX(-100%); transition:transform 0.28s cubic-bezier(0.4,0,0.2,1); overflow-y:auto; }
    .tech-sidebar-overlay.open .tech-sidebar-drawer { transform:translateX(0); }
    /* Mobile bottom nav (tech) */
    .tech-bottom-nav { display:none; position:absolute; bottom:0; left:0; right:0; z-index:5; background:#fff; border-top:1px solid #e5e7eb; padding-bottom:env(safe-area-inset-bottom); }
    .tech-bottom-inner { display:flex; height:64px; align-items:stretch; width:100%; }
    .tech-bot-item { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:0.22rem; cursor:pointer; color:#9ca3af; transition:color 0.15s; user-select:none; position:relative; min-height:44px; -webkit-tap-highlight-color:transparent; }
    .tech-bot-item svg { width:20px; height:20px; flex-shrink:0; }
    .tech-bot-label { font-size:0.58rem; font-weight:500; letter-spacing:0.01em; line-height:1; }
    .tech-bot-item.active { color:#3b82f6; }
    .tech-bot-item.active::after { content:''; position:absolute; top:0; left:50%; transform:translateX(-50%); width:24px; height:2.5px; background:#3b82f6; border-radius:0 0 3px 3px; }
    .tech-bot-badge { position:absolute; top:8px; right:calc(50% - 14px); width:8px; height:8px; background:#ef4444; border-radius:50%; border:2px solid #fff; display:none; }
    .tech-bot-badge.visible { display:block; }
    /* Responsive tech */
    @media(max-width:900px) { .tech-metrics { grid-template-columns:repeat(2,1fr); } }
    @media(max-width:768px) {
      .tech-sidebar { display:none; }
      .tech-mobile-hd { display:flex; }
      .tech-bottom-nav { display:flex; }
      .tech-main { padding:1.5rem 1.25rem; padding-top:calc(52px + 1.5rem); padding-bottom:calc(64px + 1rem); }
    }

    /* ══ RESPONSIVE ══ */
    @media(max-width:900px){
      .why-strip-inner  { grid-template-columns: 1fr; gap: 3rem; padding: 3rem 2rem; }
      .why-strip-right  { display: none; }
      .services-grid    { grid-template-columns: repeat(4,1fr); }
      .main-content     { grid-template-columns: 1fr; padding: 3rem 2rem; }
      .hero             { grid-template-columns: 1fr; min-height: auto; }
      .hero-right       { height: auto; padding: 0 2rem 3rem; justify-content: center; }
      .carousel-wrap    { max-width: 480px; }
      .dash-main-scroll { padding: 2rem 1.5rem; }
      .tnl-step3-layout { grid-template-columns: 1fr; }
      .tnl-receipt      { position: static; }
    }

    @media(max-width:768px){
      .dash-sidebar { display: none; }
      .dash-mobile-hd { display: flex; }
      .dash-bottom-nav { display: flex; }
      .dash-main-scroll { padding: 1.5rem 1.25rem 1rem; }
    }
    @media(max-width:600px){
      nav { padding: 0 1.2rem; }
      .nav-center { display: none; }
      .nav-right .btn-ghost { display: none; }
      .nav-right .btn-solid { display: none; }
      .nav-hamburger { display: flex; }
      .hero { grid-template-columns: 1fr; min-height: auto; }
      .hero-left { padding: 2rem 1.2rem 1.5rem; }
      .hero-right { height: auto; padding: 0 1.2rem 2.5rem; }
      .carousel-wrap { max-width: 100%; }
      .carousel-frame { border-radius: 14px; }
      .hero-h1 { font-size: 1.75rem; line-height: 1.1; }
      .hero-sub { font-size: 0.9rem; max-width: 100%; margin-bottom: 1.8rem; }
      .hero-actions { flex-direction: column; gap: 0.5rem; margin-bottom: 2rem; }
      .hero-actions .btn-solid, .hero-actions .btn-ghost { width: 100%; justify-content: center; padding: 0.9rem; font-size: 0.95rem; border-radius: var(--radius); }
      .hero-stats { display: grid; grid-template-columns: 1fr 1fr; width: 100%; border-radius: var(--radius); }
      .hero-stat { padding: 1rem; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); }
      .hero-stat:nth-child(2) { border-right: none; }
      .hero-stat:nth-child(3) { border-bottom: none; }
      .hero-stat:nth-child(4) { border-right: none; border-bottom: none; }
      .hero-stat strong { font-size: 1.1rem; }
      .hero-stat span   { font-size: 0.6rem; }
      .why-strip-inner  { padding: 2.5rem 1.2rem; gap: 2rem; }
      .why-strip-title  { font-size: 1.4rem; margin-bottom: 1.8rem; }
      .why-strip-right  { display: none; }
      .why-strip-list   { gap: 1.2rem; }
      .services-bar-inner { padding: 1.5rem 1.2rem; }
      .services-bar-top { flex-direction: column; align-items: flex-start; gap: 0.4rem; }
      .services-grid { grid-template-columns: repeat(4,1fr); gap: 0.45rem; }
      .service-pill { padding: 0.8rem 0.3rem; border-radius: 10px; min-height: 70px; gap: 0.3rem; }
      .service-pill-icon  { font-size: 1.35rem; }
      .service-pill-label { font-size: 0.6rem; }
      .main-content { padding: 2rem 1.2rem; gap: 2rem; }
      .block-title  { font-size: 1.2rem; }
      .problem-card { padding: 1.1rem 1.2rem; }
      .how-step { padding: 0.9rem; }
      .block-tab { font-size: 0.79rem; padding: 0.7rem 0.4rem; }
      .why-2col { grid-template-columns: 1fr; }
      .why-card { padding: 1.2rem 1.3rem; }
      .register-form-panel { padding: 1.2rem; }
      .form-row { grid-template-columns: 1fr; gap: 0; }
      footer { flex-direction: column; align-items: flex-start; padding: 1.5rem 1.2rem; }
      .footer-links { display: grid; grid-template-columns: 1fr 1fr; gap: 0; width: 100%; }
      .footer-links a { min-height: 48px; }
      /* Platform dashboard — mobile */
      .dash-sidebar { display: none; }
      .dash-mobile-hd { display: flex; }
      .dash-bottom-nav { display: flex; }
      .dash-stats-row { gap: 0.6rem; }
      .dash-stat-card { padding: 1rem; }
      .dash-stat-value { font-size: 1.5rem; }
      .dash-stat-ico-wrap { width: 40px; height: 40px; }
      .dash-catalog-grid { grid-template-columns: repeat(4,1fr); gap: 0.5rem; }
      .dash-catalog-card { padding: 0.85rem 0.3rem; }
      .dash-catalog-ico-wrap { width: 36px; height: 36px; }
      .dash-main-scroll { padding: 1.25rem 0.9rem 1rem; }
      .dash-hero { padding: 1.5rem 1.4rem; min-height: auto; }
      .dash-hero-illo { display: none; }
      .dash-hero-title { font-size: 1.2rem; }
      .dash-hero-sub { margin-bottom: 1rem; }
      .dash-cta-btn { width: 100%; justify-content: center; }
      #dv-services .dash-section-hd { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
      .modal-box { padding: 2rem 1.4rem; margin: 0.8rem; }
      .modal-box h2 { font-size: 1.15rem; }
      /* Túnel móvil */
      .tnl-header  { padding: 0 1.2rem; height: 58px; }
      .tnl-body    { padding: 1.5rem 1.2rem 5rem; }
      .tnl-title   { font-size: 1.45rem; }
      .tnl-svc-grid { grid-template-columns: repeat(3, 1fr); gap: 0.55rem; }
      .tnl-svc-card { padding: 1.2rem 0.4rem; }
      .tnl-svc-icon { font-size: 1.7rem; }
      .tnl-svc-name { font-size: 0.72rem; }
      .tnl-urgency-row { grid-template-columns: 1fr 1fr; }
      .tnl-step3-layout { grid-template-columns: 1fr; }
      .tnl-receipt  { position: static; }
      .tnl-datetime-grid { grid-template-columns: 1fr; }
      .tnl-datetime-col { border-right: none; border-bottom: 1px solid var(--border); }
      .tnl-datetime-col:last-child { border-bottom: none; }
      .tnl-success { padding: 3.5rem 1.2rem 3rem; }
      .tnl-success h2 { font-size: 1.45rem; }
    }

    @media(max-width:380px){
      .hero-h1 { font-size: 1.5rem; }
      .services-grid { gap: 0.3rem; }
      .service-pill-icon  { font-size: 1.2rem; }
      .service-pill-label { font-size: 0.56rem; }
      .dash-stat-value { font-size: 1.25rem; }
      .tnl-svc-grid { grid-template-columns: repeat(3, 1fr); gap: 0.4rem; }
      .tnl-svc-icon { font-size: 1.5rem; }
      .tnl-svc-name { font-size: 0.65rem; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav id="main-nav">
  <a href="#" class="nav-logo">thruver</a>
  <ul class="nav-center">
    <li><a href="#servicios">Servicios</a></li>
    <li><a href="#como-funciona">Cómo funciona</a></li>
    <li><a href="#por-que">Por qué Thruver</a></li>
    <li><a href="#registro">Técnicos</a></li>
  </ul>
  <div class="nav-right">
    <a href="tecnico.html" class="btn-ghost">Ser técnico</a>
    <button class="btn-ghost" id="btn-open-login">Iniciar sesión</button>
    <a href="#" class="btn-solid tnl-trigger">Solicitar servicio</a>
    <button class="nav-hamburger" id="nav-hamburger" aria-label="Menú">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<!-- MOBILE DRAWER -->
<div class="mobile-menu" id="mobile-menu">
  <a href="#servicios"     id="mm-link-1">🔧 Servicios</a>
  <a href="#como-funciona" id="mm-link-2">⚙️ Cómo funciona</a>
  <a href="#por-que"       id="mm-link-3">🛡️ Por qué Thruver</a>
  <a href="#registro"      id="mm-link-4">👷 Ser técnico</a>
  <div class="mm-divider"></div>
  <div class="mm-cta">
    <button class="btn-ghost" id="btn-open-login-mobile">Iniciar sesión</button>
    <a href="tecnico.html" class="btn-ghost" style="justify-content:center;">Ser técnico</a>
    <button class="btn-solid tnl-trigger" id="mm-cta">Solicitar servicio →</button>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════════
     TÚNEL DE CONVERSIÓN — FULL SCREEN OVERLAY
═══════════════════════════════════════════════════════ -->
<div class="tnl-overlay" id="tnlOverlay" role="dialog" aria-modal="true" aria-label="Solicitar servicio">

  <header class="tnl-header">
    <span class="tnl-logo">thruver</span>
    <button class="tnl-close" id="tnlClose" aria-label="Cerrar">✕ Cancelar</button>
  </header>

  <div class="tnl-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="33">
    <div class="tnl-progress-fill" id="tnlFill" style="width:33%"></div>
  </div>

  <div class="tnl-step-indicator" id="tnlDots">
    <div class="tnl-dot active"></div>
    <div class="tnl-dot"></div>
    <div class="tnl-dot"></div>
  </div>

  <div class="tnl-body">

    <!-- ─────────────── PASO 1 ─────────────── -->
    <div class="tnl-view tnl-active" id="tnl-s1">
      <p class="tnl-eyebrow">Paso 1 de 3</p>
      <h2 class="tnl-title">¿En qué te podemos ayudar hoy?</h2>
      <p class="tnl-sub">Selecciona el tipo de servicio y te asignamos un técnico verificado en tu zona.</p>

      <div class="tnl-svc-grid">
        <div class="tnl-svc-card" data-svc="Plomería"      data-ico="🔧"><span class="tnl-svc-icon">🔧</span><span class="tnl-svc-name">Plomería</span></div>
        <div class="tnl-svc-card" data-svc="Electricidad"  data-ico="⚡"><span class="tnl-svc-icon">⚡</span><span class="tnl-svc-name">Electricidad</span></div>
        <div class="tnl-svc-card" data-svc="Limpieza"      data-ico="🧹"><span class="tnl-svc-icon">🧹</span><span class="tnl-svc-name">Limpieza</span></div>
        <div class="tnl-svc-card" data-svc="Pintura"       data-ico="🖌️"><span class="tnl-svc-icon">🖌️</span><span class="tnl-svc-name">Pintura</span></div>
        <div class="tnl-svc-card" data-svc="Aire / Clima"  data-ico="❄️"><span class="tnl-svc-icon">❄️</span><span class="tnl-svc-name">Aire / Clima</span></div>
        <div class="tnl-svc-card" data-svc="Carpintería"   data-ico="🪚"><span class="tnl-svc-icon">🪚</span><span class="tnl-svc-name">Carpintería</span></div>
        <div class="tnl-svc-card" data-svc="Jardinería"    data-ico="🌿"><span class="tnl-svc-icon">🌿</span><span class="tnl-svc-name">Jardinería</span></div>
        <div class="tnl-svc-card" data-svc="Remodelación"  data-ico="🏗️"><span class="tnl-svc-icon">🏗️</span><span class="tnl-svc-name">Remodelación</span></div>
        <div class="tnl-svc-card" data-svc="Otro"          data-ico="💬"><span class="tnl-svc-icon">💬</span><span class="tnl-svc-name">Otro</span></div>
      </div>
    </div>

    <!-- ─────────────── PASO 2 ─────────────── -->
    <div class="tnl-view" id="tnl-s2">
      <button class="tnl-back-btn" id="tnl-back2">← Volver</button>
      <p class="tnl-eyebrow">Paso 2 de 3</p>
      <h2 class="tnl-title">Danos un poco más de contexto</h2>
      <p class="tnl-sub">Nos ayuda a asignarte al técnico correcto mucho más rápido.</p>

      <div class="tnl-field">
        <label>Tipo de espacio</label>
        <select id="tnl-espacio">
          <option value="">Selecciona tu tipo de espacio...</option>
          <option value="Casa / Hogar">🏠  Casa / Hogar</option>
          <option value="Oficina / Empresa">🏢  Oficina / Empresa</option>
          <option value="Local comercial">🏪  Local comercial</option>
          <option value="Industria / Planta">🏭  Industria / Planta</option>
        </select>
      </div>

      <div class="tnl-field">
        <label>¿Qué está fallando exactamente?</label>
        <textarea id="tnl-desc" placeholder="Ej: Se tapó el fregadero y hay una gotera pequeña debajo del lavabo..."></textarea>
      </div>

      <div style="margin-bottom:0.4rem;">
        <p style="font-size:0.66rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.09em;margin-bottom:0.55rem;">¿Cuándo lo necesitas?</p>
        <div class="tnl-urgency-row">
          <button class="tnl-urgency-btn tnl-urg-sel" id="tnl-u1" data-val="Lo antes posible">⚡ Lo antes posible</button>
          <button class="tnl-urgency-btn"              id="tnl-u2" data-val="Agendar fecha">📅 Agendar fecha</button>
        </div>
      </div>

      <!-- CALENDARIO + HORA (aparece al elegir "Agendar fecha") -->
      <div class="tnl-datetime-wrap" id="tnl-datetime-wrap">
        <div class="tnl-datetime-header">
          <span>📅</span>
          <span>Selecciona tu fecha y hora preferida</span>
        </div>
        <div class="tnl-datetime-grid">
          <div class="tnl-datetime-col">
            <label>Fecha</label>
            <input type="date" id="tnl-fecha" />
          </div>
          <div class="tnl-datetime-col">
            <label>Hora</label>
            <input type="time" id="tnl-hora" value="10:00" />
          </div>
        </div>
        <div class="tnl-fecha-note">
          ⚠️ La fecha es preferencial — Thruver la confirmará por WhatsApp.
        </div>
      </div>

      <div class="tnl-trust">
        <span class="tnl-trust-icon">🛡️</span>
        <p>Thruver te asignará a un técnico <b>verificado con antecedentes revisados</b> y respaldará el trabajo con nuestra <b>Garantía Total</b>. Si no queda bien, regresa sin costo.</p>
      </div>

      <button class="tnl-cta" id="tnl-next2">Continuar →</button>
    </div>

    <!-- ─────────────── PASO 3 ─────────────── -->
    <div class="tnl-view" id="tnl-s3">
      <button class="tnl-back-btn" id="tnl-back3">← Volver</button>
      <p class="tnl-eyebrow">Paso 3 de 3 — Ya casi terminamos</p>

      <div class="tnl-step3-layout">

        <!-- Recibo / Resumen negro -->
        <div class="tnl-receipt">
          <p class="tnl-receipt-title">Tu solicitud</p>

          <div class="tnl-rrow">
            <div class="tnl-rrow-ico" id="r-svc-ico">🔧</div>
            <div class="tnl-rrow-info">
              <small>Servicio</small>
              <span id="r-svc">—</span>
            </div>
          </div>
          <div class="tnl-rrow">
            <div class="tnl-rrow-ico">🏠</div>
            <div class="tnl-rrow-info">
              <small>Espacio</small>
              <span id="r-esp">—</span>
            </div>
          </div>
          <div class="tnl-rrow">
            <div class="tnl-rrow-ico">⏱️</div>
            <div class="tnl-rrow-info">
              <small>Urgencia</small>
              <span id="r-urg">—</span>
            </div>
          </div>
          <!-- FILA DE FECHA Y HORA (visible solo cuando se agenda fecha) -->
          <div class="tnl-rrow tnl-rrow-fecha" id="r-fecha-row">
            <div class="tnl-rrow-ico">📅</div>
            <div class="tnl-rrow-info">
              <small>Fecha programada</small>
              <span id="r-fecha">—</span>
            </div>
          </div>
          <div class="tnl-rrow">
            <div class="tnl-rrow-ico">📝</div>
            <div class="tnl-rrow-info">
              <small>Detalle</small>
              <span id="r-desc" style="font-size:0.77rem;opacity:0.65;font-weight:500;">—</span>
            </div>
          </div>

          <div class="tnl-receipt-badge">
            <span style="font-size:1rem;flex-shrink:0;">✅</span>
            <p><b>Garantía Thruver.</b> Si el trabajo no cumple, el técnico regresa sin costo adicional.</p>
          </div>
        </div>

        <!-- Formulario -->
        <div class="tnl-form-card">
          <h3 class="tnl-form-title">¿A dónde enviamos a tu experto?</h3>
          <p class="tnl-form-sub">Crea tu cuenta o inicia sesión para confirmar y dar seguimiento a tu servicio.</p>

          <div id="tnl-form-fields">

            <!-- Banner sesión activa (visible cuando ya hay sesión) -->
            <div class="tnl-session-banner" id="tnl-session-banner">
              <div class="tnl-session-avatar" id="tnl-session-avatar">?</div>
              <div class="tnl-session-info">
                <strong id="tnl-session-name">—</strong>
                <span id="tnl-session-email">—</span>
              </div>
              <button class="tnl-session-out" id="tnl-session-out">Salir</button>
            </div>

            <!-- Error de autenticación -->
            <div class="tnl-auth-error" id="tnl-auth-error"></div>

            <!-- Bloque de autenticación (se oculta si ya hay sesión) -->
            <div class="tnl-auth-fields" id="tnl-auth-fields">
              <!-- Botón Google -->
              <button class="tnl-google-btn" id="tnl-google-btn" type="button">
                <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                  <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/>
                  <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/>
                  <path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/>
                  <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z"/>
                </svg>
                Continuar con Google
              </button>

              <div class="tnl-auth-divider">o con tu correo</div>
            </div>

            <!-- Datos de contacto (se ocultan cuando ya hay sesión con datos guardados) -->
            <div id="tnl-contact-wrap">
            <div class="tnl-field">
              <label>Nombre completo</label>
              <input type="text" id="tnl-nombre" placeholder="Tu nombre" autocomplete="given-name" />
            </div>

            <div class="tnl-auth-fields" id="tnl-auth-fields-email">
              <div class="tnl-field">
                <label>Correo electrónico</label>
                <input type="email" id="tnl-email" placeholder="tu@correo.com" autocomplete="email" inputmode="email" />
              </div>

              <!-- Contraseña con toggle ver/ocultar -->
              <div class="tnl-field">
                <label id="tnl-pass-label">Contraseña <span id="tnl-pass-hint" style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--muted2);"> — mínimo 6 caracteres</span></label>
                <div class="tnl-pass-wrap">
                  <input type="password" id="tnl-pass" placeholder="••••••••" autocomplete="new-password" />
                  <button class="tnl-pass-toggle" id="tnl-pass-toggle" type="button" aria-label="Ver contraseña"><svg id="tnl-eye-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
              </div>

              <!-- Mensaje reset contraseña -->
              <div class="tnl-reset-msg" id="tnl-reset-msg"></div>

              <div class="tnl-mode-toggle">
                <span id="tnl-mode-text">¿Ya tienes cuenta?</span>
                <button id="tnl-mode-switch" type="button">Iniciar sesión</button>
              </div>
              <!-- Olvidaste contraseña (solo visible en modo login) -->
              <div class="tnl-forgot-wrap" id="tnl-forgot-wrap" style="display:none;">
                <button class="tnl-forgot-btn" id="tnl-forgot-btn" type="button">¿Olvidaste tu contraseña?</button>
              </div>
            </div>

            <div class="tnl-field">
              <label>WhatsApp</label>
              <input type="tel" id="tnl-tel" placeholder="667 000 0000" autocomplete="tel" inputmode="tel" />
            </div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:0 1rem;">
            <div class="tnl-field" style="grid-column:1/-1;">
              <label>Calle</label>
              <input type="text" id="tnl-calle" placeholder="Nombre de la calle" autocomplete="address-line1" />
            </div>
            <div class="tnl-field">
              <label>Número</label>
              <input type="text" id="tnl-numero" placeholder="Ej. 142" />
            </div>
            <div class="tnl-field">
              <label>Colonia</label>
              <input type="text" id="tnl-colonia" placeholder="Tu colonia" autocomplete="address-level2" />
            </div>
            </div>
            </div><!-- /tnl-contact-wrap -->

            <!-- Resumen de datos guardados (visible solo cuando hay sesión + datos) -->
            <div id="tnl-saved-card" style="display:none;background:#f9fafb;border:1.5px solid #e5e7eb;border-radius:12px;padding:0.9rem 1rem;margin-bottom:0.5rem;">
              <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                <div>
                  <div style="font-size:0.66rem;font-weight:700;color:#9ca3af;text-transform:uppercase;letter-spacing:0.09em;margin-bottom:0.5rem;">Contacto guardado</div>
                  <div id="tnl-saved-name" style="font-size:0.88rem;font-weight:700;color:#111;margin-bottom:0.2rem;">—</div>
                  <div id="tnl-saved-tel" style="font-size:0.8rem;color:#6b7280;margin-bottom:0.15rem;">—</div>
                  <div id="tnl-saved-dir" style="font-size:0.8rem;color:#6b7280;">—</div>
                </div>
                <button id="tnl-saved-edit" type="button" style="background:none;border:1.5px solid #e5e7eb;border-radius:8px;padding:0.3rem 0.65rem;font-size:0.72rem;font-weight:700;color:#6b7280;cursor:pointer;font-family:var(--font);white-space:nowrap;flex-shrink:0;">Cambiar</button>
              </div>
            </div>

            <button class="tnl-cta" id="tnl-submit">
              <span class="spinner" id="tnl-spinner"></span>
              <span id="tnl-submit-txt">Crear cuenta y confirmar ✓</span>
            </button>
            <!-- Nota de correo — movida debajo del botón -->
            <div class="tnl-email-note" style="margin-top:0.9rem;">
              <span>✉️</span>
              <p>Recibirás tu <b>ticket de soporte</b> desde <b><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dba8b4abb4a9afbe9bafb3a9aeadbea9f5b8b4b6">[email&#160;protected]</a></b> con todos los detalles de tu servicio.</p>
            </div>
            <p class="tnl-cta-note">Al confirmar podrás ver tu historial de servicios desde tu cuenta.</p>
          </div>
        </div>

      </div>
    </div>

    <!-- ─────────────── ÉXITO ─────────────── -->
    <div class="tnl-success" id="tnl-success">
      <!-- Círculo negro con palomita SVG animada -->
      <div class="tnl-success-ring">
        <svg class="check-svg" viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg">
          <circle class="check-circle" cx="26" cy="26" r="22"/>
          <path class="check-mark" d="M14 26 l8 9 l16 -18"/>
        </svg>
      </div>

      <h2>¡Solicitud enviada!</h2>
      <p>Tu solicitud está en camino. Un técnico <strong>verificado por Thruver</strong> se pondrá en contacto por WhatsApp en los próximos minutos.<br/>Revisa también tu correo para el ticket de seguimiento.</p>

      <button class="tnl-cta" id="tnl-ok" style="max-width:260px;margin:0 auto;">Volver al inicio</button>
    </div>

  </div><!-- /tnl-body -->
</div><!-- /tnl-overlay -->

<!-- HERO -->
<section class="hero">
  <div class="hero-grid-pattern"></div>

  <div class="hero-left">
    <div class="hero-badge">
      <span class="badge-dot"></span>
      Culiacán, Sinaloa · Lanzando pronto
    </div>
    <h1 class="hero-h1">Infraestructura de mantenimiento y mejoras para hogares y empresas.</h1>
    <p class="hero-sub">Thruver es la infraestructura confiable para reparar, mantener y mejorar tu hogar o empresa.</p>
    <div class="hero-actions">
      <a href="#" class="btn-solid tnl-trigger">Solicitar servicio →</a>
      <a href="#como-funciona" class="btn-ghost">Cómo funciona</a>
    </div>
    <div class="hero-stats">
      <div class="hero-stat"><strong>100%</strong><span>Verificados</span></div>
      <div class="hero-stat"><strong>Por zona</strong><span>Red curada</span></div>
      <div class="hero-stat"><strong>Garantía</strong><span>O lo resolvemos</span></div>
      <div class="hero-stat"><strong>$0</strong><span>Sin sorpresas</span></div>
    </div>
  </div>

  <div class="hero-right">
    <div class="carousel-wrap">
      <div class="carousel-frame">
        <div class="carousel-slides" id="carouselSlides">
          <div class="carousel-slide active">
            <img src="https://raw.githubusercontent.com/tny-me/thruver.github.io/main/Plomero.jpeg" alt="Plomería" />
          </div>
          <div class="carousel-slide">
            <img src="https://raw.githubusercontent.com/tny-me/thruver.github.io/main/Electrico.jpeg" alt="Electricidad" loading="lazy" />
          </div>
          <div class="carousel-slide">
            <img src="https://raw.githubusercontent.com/tny-me/thruver.github.io/main/Pintor.jpeg" alt="Pintura" loading="lazy" />
          </div>
          <div class="carousel-slide">
            <img src="https://raw.githubusercontent.com/tny-me/thruver.github.io/main/Limpieza.jpeg" alt="Limpieza" loading="lazy" />
          </div>
        </div>
      </div>
      <div class="carousel-dots" id="carouselDots"></div>
    </div>
  </div>
</section>

<!-- WHY STRIP -->
<section class="why-strip">
  <div class="why-strip-inner">
    <div class="why-strip-left">
      <p class="why-strip-eyebrow">¿Por qué Thruver?</p>
      <h2 class="why-strip-title">La forma más confiable de contratar servicios para tu hogar o empresa.</h2>
      <div class="why-strip-list">
        <div class="why-strip-item">
          <div class="why-strip-icon">⭐</div>
          <div class="why-strip-item-text">
            <strong>Experiencia de servicio</strong>
            <p>Una experiencia estandarizada, segura y de alta calidad. Sin importar qué técnico llegue a tu puerta, el nivel de atención siempre es el mismo.</p>
          </div>
        </div>
        <div class="why-strip-item">
          <div class="why-strip-icon">🛡️</div>
          <div class="why-strip-item-text">
            <strong>Red verificada</strong>
            <p>No cualquiera puede ofrecer servicios en Thruver. Cada profesional pasa por entrevistas, pruebas técnicas y revisión estricta de antecedentes.</p>
          </div>
        </div>
        <div class="why-strip-item">
          <div class="why-strip-icon">🔩</div>
          <div class="why-strip-item-text">
            <strong>Experiencia comprobada</strong>
            <p>Nuestros técnicos no solo dicen que saben — <b>lo demuestran</b>. Capacitados, con experiencia real y supervisados por Thruver.</p>
          </div>
        </div>
        <div class="why-strip-item">
          <div class="why-strip-icon">✅</div>
          <div class="why-strip-item-text">
            <strong>Garantía y responsabilidad</strong>
            <p>Si algo no queda bien, Thruver lo resuelve. Sin pretextos, sin excusas y sin desaparecer.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="why-strip-right">
      <div class="why-badge-card">
        <div class="why-badge-icon">
          <svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M48 6L14 20V44C14 63.8 28.8 82.4 48 88C67.2 82.4 82 63.8 82 44V20L48 6Z" fill="#000000"/>
            <circle cx="48" cy="40" r="13" fill="#ffffff"/>
            <path d="M27 68C27 57.5 36.5 49 48 49C59.5 49 69 57.5 69 68" stroke="#ffffff" stroke-width="5" stroke-linecap="round"/>
          </svg>
        </div>
        <h3>100% calidad asegurada</h3>
        <p>Si no le gusta nuestro servicio, lo solucionaremos.</p>
      </div>
    </div>
  </div>
</section>

<!-- SERVICES BAR -->
<section class="services-bar" id="servicios">
  <div class="services-bar-inner">
    <div class="services-bar-top">
      <h2>¿Qué necesitas hoy?</h2>
      <a href="#" class="link-muted tnl-trigger">Ver todos →</a>
    </div>
    <div class="services-grid">
      <a href="#" class="service-pill tnl-trigger" data-preset="Plomería"><span class="service-pill-icon">🔧</span><span class="service-pill-label">Plomería</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Electricidad"><span class="service-pill-icon">⚡</span><span class="service-pill-label">Electricidad</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Limpieza"><span class="service-pill-icon">🧹</span><span class="service-pill-label">Limpieza</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Pintura"><span class="service-pill-icon">🖌️</span><span class="service-pill-label">Pintura</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Carpintería"><span class="service-pill-icon">🪚</span><span class="service-pill-label">Carpintería</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Jardinería"><span class="service-pill-icon">🌿</span><span class="service-pill-label">Jardinería</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Aire / Clima"><span class="service-pill-icon">❄️</span><span class="service-pill-label">Aire / Clima</span></a>
      <a href="#" class="service-pill tnl-trigger" data-preset="Remodelación"><span class="service-pill-icon">🏗️</span><span class="service-pill-label">Remodelación</span></a>
    </div>
  </div>
</section>

<!-- MAIN CONTENT -->
<div class="main-content">
  <div class="main-left">
    <div>
      <p class="eyebrow">El problema</p>
      <h2 class="block-title">Contratar un técnico en México es una lotería.</h2>
    </div>
    <div class="problem-grid">
      <div class="problem-card">
        <div class="problem-icon">😰</div>
        <div><h3>Sin verificación</h3><p>Cualquiera puede llamarse técnico. No hay forma de saber quién entra a tu hogar antes de que llegue.</p></div>
      </div>
      <div class="problem-card">
        <div class="problem-icon">📵</div>
        <div><h3>Sin tecnología</h3><p>Todo se hace por WhatsApp y recomendaciones. Sin plataforma, sin transparencia, sin trazabilidad.</p></div>
      </div>
      <div class="problem-card">
        <div class="problem-icon">🔁</div>
        <div><h3>Sin garantía</h3><p>Si el trabajo queda mal, no hay a quién reclamar. El cliente pierde tiempo y dinero sin solución.</p></div>
      </div>
    </div>
    <div id="como-funciona">
      <p class="eyebrow" style="margin-top:0.3rem;">Cómo funciona</p>
      <h2 class="block-title">Simple por diseño.</h2>
    </div>
    <div class="how-block">
      <div class="block-tabs">
        <button class="block-tab active" data-tab="how" data-target="how-cliente">Para clientes</button>
        <button class="block-tab" data-tab="how" data-target="how-tecnico">Para técnicos</button>
      </div>
      <div class="tab-panel active" id="how-cliente">
        <div class="how-step"><div class="step-num">01</div><div><h3>Solicita tu servicio</h3><p>Dinos qué necesitas — plomería, electricidad, limpieza. Tipo de espacio y horario preferido.</p></div></div>
        <div class="how-step"><div class="step-num">02</div><div><h3>Asignamos al técnico</h3><p>Thruver asigna al técnico verificado en tu zona. Tú no eliges — nosotros garantizamos el estándar.</p></div></div>
        <div class="how-step"><div class="step-num">03</div><div><h3>El servicio se realiza</h3><p>El técnico llega en el horario acordado, identificado como técnico Thruver. Profesional y puntual.</p></div></div>
        <div class="how-step"><div class="step-num">04</div><div><h3>Pagas y calificas</h3><p>Cobro transparente en la plataforma. Sin efectivo inesperado. Califica el servicio recibido.</p></div></div>
      </div>
      <div class="tab-panel" id="how-tecnico">
        <div class="how-step"><div class="step-num">01</div><div><h3>Regístrate y verifica</h3><p>INE, antecedentes no penales y prueba práctica. Solo los mejores entran a la red Thruver.</p></div></div>
        <div class="how-step"><div class="step-num">02</div><div><h3>Obtén tu zona</h3><p>Cupos limitados por especialidad y zona. Si hay lugar para ti, es tuyo. Sin competencia interna.</p></div></div>
        <div class="how-step"><div class="step-num">03</div><div><h3>Recibe trabajo constante</h3><p>Thruver te asigna servicios. Trabaja bien — nosotros te traemos los clientes.</p></div></div>
        <div class="how-step"><div class="step-num">04</div><div><h3>Cobra por cada servicio</h3><p>Sin suscripción ni cuotas. Thruver retiene una comisión. Si no hay trabajo, no pagas nada.</p></div></div>
      </div>
    </div>
  </div>

  <div class="main-right">
    <div id="por-que">
      <p class="eyebrow">Por qué Thruver</p>
      <h2 class="block-title">No es una app.<br/>Es infraestructura de confianza.</h2>
    </div>
    <div class="why-card why-card-dark">
      <div class="why-card-icon">👤</div>
      <h3>El técnico es invisible. La marca lo es todo.</h3>
      <p>No buscas a una persona — confías en Thruver. Igual que confías en FedEx sin saber quién entrega tu paquete.</p>
    </div>
    <div class="why-card"><h3>Red curada, no abierta</h3><p>Cupos limitados por zona. Los que están adentro trabajan bien y trabajan siempre. Sin competencia entre técnicos.</p></div>
    <div class="why-card"><h3>Verificación real</h3><p>INE, antecedentes no penales y prueba práctica supervisada. Sin los tres no hay cupo. Sin excepciones.</p></div>
    <div class="why-2col">
      <div class="why-card"><h3>Hogares y empresas</h3><p>Un solo proveedor para todos tus espacios sin importar el tamaño.</p></div>
      <div class="why-card"><h3>Garantía real</h3><p>Si el servicio no cumple el estándar, Thruver responde. Sin pretextos.</p></div>
    </div>

    <div id="registro">
      <p class="eyebrow" style="margin-top:0.3rem;">Únete a Thruver</p>
      <h2 class="block-title">Sé de los primeros.</h2>
    </div>
    <div class="register-block">
      <div class="block-tabs">
        <button class="block-tab active" data-tab="reg" data-target="reg-cliente">Solicitar servicio</button>
        <button class="block-tab" data-tab="reg" data-target="reg-tecnico">Ser técnico</button>
      </div>
      <div class="register-form-panel active" id="reg-cliente">
        <div id="rform-cliente">
          <div class="form-row">
            <div class="form-group"><label>Nombre</label><input type="text" id="c-nombre" placeholder="Tu nombre" autocomplete="given-name" /></div>
            <div class="form-group"><label>WhatsApp</label><input type="tel" id="c-telefono" placeholder="667 000 0000" autocomplete="tel" inputmode="tel" /></div>
          </div>
          <div class="form-group"><label>Correo electrónico</label><input type="email" id="c-email" placeholder="tu@correo.com" autocomplete="email" inputmode="email" /></div>
          <div class="form-row">
            <div class="form-group">
              <label>Tipo de espacio</label>
              <select id="c-espacio">
                <option value="">Selecciona...</option>
                <option>Hogar / Casa</option><option>Oficina / Empresa</option>
                <option>Local comercial</option><option>Industria / Planta</option>
              </select>
            </div>
            <div class="form-group">
              <label>Servicio</label>
              <select id="c-servicio">
                <option value="">Selecciona...</option>
                <option>Plomería</option><option>Electricidad</option>
                <option>Limpieza</option><option>Pintura</option>
                <option>Carpintería</option><option>Jardinería</option><option>Otro</option>
              </select>
            </div>
          </div>
          <div id="error-cliente" style="display:none;background:#fff0f0;border:1px solid #fcc;border-radius:7px;padding:0.6rem 0.9rem;font-size:0.78rem;color:#cc3333;margin-bottom:0.5rem;"></div>
          <button class="btn-submit" id="btn-cliente">
            <span class="spinner" id="spinner-cliente"></span>
            <span id="btn-cliente-text">Registrarme como cliente →</span>
          </button>
          <p class="form-note">Te contactamos por WhatsApp para agendar.</p>
        </div>
        <div class="success-msg" id="success-cliente">
          <div class="check">✅</div><h4>¡Registro exitoso!</h4>
          <p>Te contactamos por WhatsApp en las próximas horas.</p>
        </div>
      </div>
      <div class="register-form-panel" id="reg-tecnico">
        <div id="rform-tecnico">
          <div class="form-row">
            <div class="form-group"><label>Nombre</label><input type="text" id="t-nombre" placeholder="Tu nombre" autocomplete="given-name" /></div>
            <div class="form-group"><label>WhatsApp</label><input type="tel" id="t-telefono" placeholder="667 000 0000" autocomplete="tel" inputmode="tel" /></div>
          </div>
          <div class="form-group"><label>Correo electrónico</label><input type="email" id="t-email" placeholder="tu@correo.com" autocomplete="email" inputmode="email" /></div>
          <div class="form-row">
            <div class="form-group">
              <label>Especialidad</label>
              <select id="t-especialidad">
                <option value="">Selecciona...</option>
                <option>Plomero</option><option>Electricista</option><option>Limpieza</option>
                <option>Pintor</option><option>Carpintero</option><option>Jardinero</option><option>Multi-servicio</option>
              </select>
            </div>
            <div class="form-group">
              <label>Experiencia</label>
              <select id="t-experiencia">
                <option value="">Selecciona...</option>
                <option>Menos de 1 año</option><option>1 a 3 años</option>
                <option>3 a 5 años</option><option>Más de 5 años</option>
              </select>
            </div>
          </div>
          <div class="form-group"><label>Colonia donde trabajas</label><input type="text" id="t-zona" placeholder="Ej. Las Quintas, Tres Ríos..." /></div>
          <div id="error-tecnico" style="display:none;background:#fff0f0;border:1px solid #fcc;border-radius:7px;padding:0.6rem 0.9rem;font-size:0.78rem;color:#cc3333;margin-bottom:0.5rem;"></div>
          <button class="btn-submit" id="btn-tecnico">
            <span class="spinner" id="spinner-tecnico"></span>
            <span id="btn-tecnico-text">Solicitar mi cupo →</span>
          </button>
          <p class="form-note">Cupos limitados. Te notificamos si hay disponibilidad.</p>
        </div>
        <div class="success-msg" id="success-tecnico">
          <div class="check">✅</div><h4>¡Solicitud recibida!</h4>
          <p>Si hay cupo en tu zona, te contactamos por WhatsApp.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-logo">thruver</div>
  <div class="footer-links">
    <a href="#servicios">Servicios</a>
    <a href="#como-funciona">Cómo funciona</a>
    <a href="#" class="tnl-trigger">Solicitar servicio</a>
    <a href="#registro">Ser técnico</a>
    <a href="https://wa.me/52" target="_blank" rel="noopener noreferrer">WhatsApp</a>
  </div>
  <p class="footer-copy">© 2026 Thruver · Culiacán, Sinaloa, México</p>
</footer>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="loginModal">
  <div class="modal-box">
    <button class="modal-close" id="btn-close-login">✕</button>

    <!-- ── PANEL LOGIN ── -->
    <div class="modal-panel active" id="modal-panel-login">
      <h2>Iniciar sesión</h2>
      <p class="modal-sub">Accede a tu cuenta Thruver</p>
      <div class="modal-error" id="login-error"></div>
      <div class="form-group">
        <label>Correo electrónico</label>
        <input type="email" id="login-email" placeholder="tu@correo.com" inputmode="email" autocomplete="email" />
      </div>
      <div class="form-group">
        <label>Contraseña</label>
        <div class="modal-pass-wrap">
          <input type="password" id="login-pass" placeholder="••••••••" autocomplete="current-password" />
          <button class="modal-pass-eye" id="login-pass-eye" type="button" aria-label="Ver contraseña"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        </div>
      </div>
      <div class="modal-forgot">
        <button id="btn-to-forgot" type="button">¿Olvidaste tu contraseña?</button>
      </div>
      <button class="btn-submit" id="btn-do-login">
        <span class="spinner" id="spinner-login"></span>
        <span id="btn-login-text">Entrar →</span>
      </button>
      <p class="modal-footer-link">¿No tienes cuenta? <button id="btn-to-register">Regístrate</button></p>
    </div>

    <!-- ── PANEL OLVIDÉ CONTRASEÑA ── -->
    <div class="modal-panel" id="modal-panel-forgot">
      <h2>Restablecer</h2>
      <p class="modal-sub">Te enviaremos un enlace a tu correo para crear una nueva contraseña.</p>
      <div class="modal-error"  id="forgot-error"></div>
      <div class="modal-success" id="forgot-success"></div>
      <div class="form-group">
        <label>Correo electrónico</label>
        <input type="email" id="forgot-email" placeholder="tu@correo.com" inputmode="email" autocomplete="email" />
      </div>
      <button class="btn-submit" id="btn-do-forgot">
        <span class="spinner" id="spinner-forgot"></span>
        <span id="btn-forgot-text">Enviar enlace</span>
      </button>
      <p class="modal-footer-link"><button id="btn-back-to-login">← Volver al inicio de sesión</button></p>
    </div>

    <!-- ── PANEL REGISTRO ── -->
    <div class="modal-panel" id="modal-panel-register">
      <h2>Crear cuenta</h2>
      <p class="modal-sub">Regístrate para solicitar y dar seguimiento a tus servicios.</p>
      <div class="modal-error" id="register-error"></div>
      <div class="form-group">
        <label>Nombre completo</label>
        <input type="text" id="reg-nombre" placeholder="Tu nombre" autocomplete="given-name" />
      </div>
      <div class="form-group">
        <label>Correo electrónico</label>
        <input type="email" id="reg-email" placeholder="tu@correo.com" inputmode="email" autocomplete="email" />
      </div>
      <div class="form-group">
        <label>Contraseña <span style="font-weight:400;text-transform:none;letter-spacing:0;color:#aaa;font-size:0.7rem;"> — mínimo 6 caracteres</span></label>
        <div class="modal-pass-wrap">
          <input type="password" id="reg-pass" placeholder="••••••••" autocomplete="new-password" />
          <button class="modal-pass-eye" id="reg-pass-eye" type="button" aria-label="Ver contraseña"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        </div>
      </div>
      <div class="form-group">
        <label>WhatsApp</label>
        <input type="tel" id="reg-tel" placeholder="667 000 0000" autocomplete="tel" inputmode="tel" />
      </div>
      <div class="form-group">
        <label>Calle</label>
        <input type="text" id="reg-calle" placeholder="Nombre de la calle" autocomplete="address-line1" />
      </div>
      <div class="modal-addr-grid">
        <div class="form-group">
          <label>Número</label>
          <input type="text" id="reg-numero" placeholder="Ej. 142" />
        </div>
        <div class="form-group">
          <label>Colonia</label>
          <input type="text" id="reg-colonia" placeholder="Tu colonia" autocomplete="address-level2" />
        </div>
      </div>
      <button class="btn-submit" id="btn-do-register">
        <span class="spinner" id="spinner-register"></span>
        <span id="btn-register-text">Crear cuenta</span>
      </button>
      <p class="modal-footer-link">¿Ya tienes cuenta? <button id="btn-back-to-login-2">Iniciar sesión</button></p>
    </div>

  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">

  <!-- Mobile header (visible sólo en móvil) -->
  <div class="dash-mobile-hd">
    <button class="dash-mobile-back" id="btn-dash-back">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      <span class="dash-mobile-logo-txt">thruver</span>
    </button>
  </div>

  <!-- Layout -->
  <div class="dash-layout">

    <!-- Sidebar -->
    <aside class="dash-sidebar">
      <div class="dash-sidebar-user">
        <div class="dash-sidebar-avatar" id="dash-topnav-avatar">?</div>
        <div>
          <div class="dash-sidebar-uwelcome">Bienvenido de vuelta</div>
          <div class="dash-sidebar-uname" id="dash-topnav-name">—</div>
        </div>
      </div>
      <div class="dash-sidebar-nav">
        <div class="dash-nav-link active" data-view="dv-home">
          <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Inicio
        </div>
        <div class="dash-nav-link" data-view="dv-profile">
          <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Mi perfil
        </div>
        <div class="dash-nav-link" data-view="dv-services">
          <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
          Mis servicios
        </div>
      </div>
      <div class="dash-sidebar-bottom">
        <div class="dash-nav-logout" id="btn-logout">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Cerrar sesión
        </div>
      </div>
    </aside>

    <!-- Main -->
    <div class="dash-main-scroll">

      <!-- VIEW: Inicio -->
      <div class="dash-view active" id="dv-home">

        <!-- Hero -->
        <div class="dash-hero">
          <div class="dash-hero-content">
            <div class="dash-hero-tag">Plataforma de servicios del hogar</div>
            <div class="dash-hero-title" id="dash-greeting-name">Bienvenido a Thruver.</div>
            <div class="dash-hero-sub">¿Qué necesitas hoy?</div>
            <button class="dash-hero-btn tnl-trigger">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Solicitar servicio
            </button>
          </div>
          <div class="dash-hero-illo">
            <svg width="190" height="170" viewBox="0 0 190 170" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="120" cy="85" r="78" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
              <circle cx="120" cy="85" r="54" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
              <rect x="85" y="97" width="70" height="58" rx="4" fill="rgba(255,255,255,0.07)" stroke="rgba(255,255,255,0.16)" stroke-width="1.5"/>
              <path d="M78 99 L120 57 L162 99" fill="rgba(255,255,255,0.08)" stroke="rgba(255,255,255,0.26)" stroke-width="1.5" stroke-linejoin="round"/>
              <rect x="148" y="71" width="8" height="15" rx="1" fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.18)" stroke-width="1"/>
              <rect x="108" y="117" width="24" height="38" rx="2" fill="rgba(255,255,255,0.14)"/>
              <circle cx="128" cy="137" r="2" fill="rgba(255,255,255,0.3)"/>
              <rect x="90" y="106" width="14" height="11" rx="1.5" fill="rgba(255,255,255,0.16)"/>
              <rect x="136" y="106" width="14" height="11" rx="1.5" fill="rgba(255,255,255,0.16)"/>
              <line x1="97" y1="106" x2="97" y2="117" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
              <line x1="90" y1="111.5" x2="104" y2="111.5" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
              <line x1="143" y1="106" x2="143" y2="117" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
              <line x1="136" y1="111.5" x2="150" y2="111.5" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
              <g transform="translate(14,22) rotate(-38,22,18)">
                <rect x="18" y="2" width="8" height="28" rx="4" fill="rgba(255,255,255,0.08)" stroke="rgba(255,255,255,0.28)" stroke-width="1.5"/>
                <circle cx="22" cy="6" r="7" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.25)" stroke-width="1.5"/>
                <circle cx="22" cy="28" r="5" fill="rgba(255,255,255,0.07)" stroke="rgba(255,255,255,0.22)" stroke-width="1.5"/>
              </g>
              <circle cx="167" cy="121" r="16" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.11)" stroke-width="1.5"/>
              <circle cx="167" cy="121" r="7" fill="rgba(255,255,255,0.08)" stroke="rgba(255,255,255,0.14)" stroke-width="1"/>
              <rect x="164" y="103" width="6" height="4" rx="1" fill="rgba(255,255,255,0.11)"/>
              <rect x="164" y="134" width="6" height="4" rx="1" fill="rgba(255,255,255,0.11)"/>
              <rect x="149" y="118" width="4" height="6" rx="1" fill="rgba(255,255,255,0.11)"/>
              <rect x="182" y="118" width="4" height="6" rx="1" fill="rgba(255,255,255,0.11)"/>
              <circle cx="34" cy="115" r="3" fill="rgba(255,255,255,0.18)"/>
              <circle cx="170" cy="44" r="2" fill="rgba(255,255,255,0.13)"/>
              <circle cx="178" cy="156" r="3" fill="rgba(255,255,255,0.09)"/>
              <circle cx="58" cy="52" r="1.5" fill="rgba(255,255,255,0.13)"/>
            </svg>
          </div>
        </div>

        <!-- Stat cards -->
        <div class="dash-stats-row">
          <div class="dash-stat-card dash-stat-mint">
            <div class="dash-stat-info">
              <div class="dash-stat-label">Servicios solicitados</div>
              <div class="dash-stat-value" id="stat-total">0</div>
              <div class="dash-stat-sub">total acumulado</div>
            </div>
            <div class="dash-stat-ico-wrap">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><line x1="12" y1="11" x2="16" y2="11"/><line x1="12" y1="16" x2="16" y2="16"/><line x1="8" y1="11" x2="8.01" y2="11"/><line x1="8" y1="16" x2="8.01" y2="16"/></svg>
            </div>
          </div>
          <div class="dash-stat-card dash-stat-cream">
            <div class="dash-stat-info">
              <div class="dash-stat-label">Servicios completados</div>
              <div class="dash-stat-value" id="stat-done">0</div>
              <div class="dash-stat-sub">finalizados con éxito</div>
            </div>
            <div class="dash-stat-ico-wrap">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            </div>
          </div>
        </div>

        <!-- Catalog -->
        <div class="dash-section-hd">
          <h3>Servicios disponibles</h3>
        </div>
        <div class="dash-catalog-grid">
          <div class="dash-catalog-card tnl-trigger" data-svc="Plomería">
            <div class="dash-catalog-ico-wrap ic-blue"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg></div>
            <div class="dash-catalog-name">Plomería</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Electricidad">
            <div class="dash-catalog-ico-wrap ic-yellow"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
            <div class="dash-catalog-name">Electricidad</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Limpieza">
            <div class="dash-catalog-ico-wrap ic-green"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg></div>
            <div class="dash-catalog-name">Limpieza</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Pintura">
            <div class="dash-catalog-ico-wrap ic-purple"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.37 2.63 14 7l-1.59-1.59-2.83 2.83 1.59 1.59L7 14l-1-4-4 4 4 4h16V8z"/></svg></div>
            <div class="dash-catalog-name">Pintura</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Carpintería">
            <div class="dash-catalog-ico-wrap ic-orange"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"/></svg></div>
            <div class="dash-catalog-name">Carpintería</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Jardinería">
            <div class="dash-catalog-ico-wrap ic-teal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg></div>
            <div class="dash-catalog-name">Jardinería</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Aire / Clima">
            <div class="dash-catalog-ico-wrap ic-sky"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg></div>
            <div class="dash-catalog-name">Aire / Clima</div>
          </div>
          <div class="dash-catalog-card tnl-trigger" data-svc="Remodelación">
            <div class="dash-catalog-ico-wrap ic-gray"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg></div>
            <div class="dash-catalog-name">Remodelación</div>
          </div>
        </div>

        <!-- Recent activity -->
        <div class="dash-section-hd">
          <h3>Actividad reciente</h3>
          <button class="dash-see-all" id="btn-see-all-svcs">Ver todo →</button>
        </div>
        <div class="dash-tbl-card" id="dash-card-historial">
          <div id="dash-historial-skel">
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:55%;"></div><div class="dash-skel-line" style="height:10px;width:35%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:45%;"></div><div class="dash-skel-line" style="height:10px;width:30%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:60%;"></div><div class="dash-skel-line" style="height:10px;width:40%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
          </div>
          <div id="dash-historial-empty" class="dash-empty" style="display:none;">
            <h4>Sin actividad reciente</h4>
            <p>Solicita tu primer servicio y te conectamos<br>con un técnico verificado en tu zona.</p>
            <button class="tnl-trigger dash-cta-btn" style="margin:0 auto;">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Solicitar ahora
            </button>
          </div>
        </div>

      </div><!-- /dv-home -->

      <!-- VIEW: Mis servicios -->
      <div class="dash-view" id="dv-services">
        <div class="dash-section-hd" style="margin-bottom:1.5rem;align-items:flex-end;">
          <div>
            <h3 style="font-size:1.35rem;font-weight:900;letter-spacing:-0.04em;color:#111;margin-bottom:0.25rem;">Mis servicios</h3>
            <p style="font-size:0.82rem;color:#9ca3af;">Aquí se muestra el historial completo de tus solicitudes.</p>
          </div>
          <button class="dash-cta-btn tnl-trigger">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Nuevo servicio
          </button>
        </div>
        <div class="dash-tbl-card" id="dash-services-list">
          <div id="dash-services-skel">
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:55%;"></div><div class="dash-skel-line" style="height:10px;width:35%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:45%;"></div><div class="dash-skel-line" style="height:10px;width:30%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
            <div class="dash-skel-row"><div class="dash-skel-ico dash-skel-line"></div><div class="dash-skel-lines"><div class="dash-skel-line" style="height:12px;width:60%;"></div><div class="dash-skel-line" style="height:10px;width:40%;"></div></div><div class="dash-skel-line" style="height:10px;width:60px;border-radius:100px;"></div></div>
          </div>
          <div id="dash-services-empty" class="dash-empty" style="display:none;">
            <h4>Sin servicios aún</h4>
            <p>Aquí aparecerán todos tus servicios solicitados.</p>
            <button class="tnl-trigger dash-cta-btn" style="margin:0 auto;">
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Solicitar servicio
            </button>
          </div>
        </div>
      </div><!-- /dv-services -->

      <!-- VIEW: Mi perfil -->
      <div class="dash-view" id="dv-profile">
        <div class="dash-section-hd" style="margin-bottom:1.5rem;">
          <h3 style="font-size:1.35rem;font-weight:900;letter-spacing:-0.04em;color:#111;">Mi perfil</h3>
        </div>
        <div class="dash-profile-card">
          <div class="dash-profile-head">
            <div class="dash-profile-avatar-xl" id="dash-profile-avatar">?</div>
            <div>
              <div id="dash-profile-name" style="font-size:1.05rem;font-weight:900;color:#fff;letter-spacing:-0.02em;">—</div>
              <div id="dash-profile-email" style="font-size:0.76rem;color:rgba(255,255,255,0.5);margin-top:0.2rem;">—</div>
            </div>
          </div>
          <div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid #e5e7eb;min-height:52px;">
              <span style="font-size:0.8rem;color:#6b7280;font-weight:600;">Miembro desde</span>
              <span id="dash-profile-since" style="font-size:0.85rem;font-weight:700;color:#111;">—</span>
            </div>
            <div class="dash-prof-row">
              <span class="dash-prof-label">Estado</span>
              <span style="font-size:0.85rem;font-weight:700;color:#059669;">Activo</span>
            </div>
            <div class="dash-prof-row">
              <span class="dash-prof-label">Servicios totales</span>
              <span id="dash-profile-total" class="dash-prof-val">—</span>
            </div>
            <div class="dash-prof-row">
              <span class="dash-prof-label">Teléfono</span>
              <span id="dash-profile-tel" class="dash-prof-val" style="color:#9ca3af;">—</span>
            </div>
            <div class="dash-prof-row" style="border-bottom:none;">
              <span class="dash-prof-label">Dirección</span>
              <span id="dash-profile-dir" class="dash-prof-val" style="color:#9ca3af;">—</span>
            </div>
            <!-- Formulario edición inline -->
            <div class="dash-prof-edit-form" id="prof-edit-form">
              <div class="dash-prof-field">
                <label>Teléfono</label>
                <input type="tel" id="prof-input-tel" placeholder="Ej: 81 1234 5678" />
              </div>
              <div class="dash-prof-field">
                <label>Dirección (calle y colonia)</label>
                <input type="text" id="prof-input-dir" placeholder="Ej: Av. Morelos 45, Col. Centro" />
              </div>
              <button class="dash-prof-save" id="prof-save-btn">Guardar cambios</button>
            </div>
          </div>
          <div style="padding:1rem 1.5rem;border-top:1px solid #e5e7eb;">
            <button class="dash-prof-edit-btn" id="prof-edit-toggle">Editar información</button>
          </div>
        </div>
        <button id="btn-logout-profile" style="margin-top:0.5rem;background:none;border:1.5px solid #fecaca;border-radius:10px;color:#ef4444;padding:0.85rem 1.5rem;font-size:0.85rem;font-weight:700;cursor:pointer;font-family:var(--font);width:100%;max-width:480px;">Cerrar sesión</button>
      </div><!-- /dv-profile -->

    </div><!-- /dash-main-scroll -->
  </div><!-- /dash-layout -->

  <!-- Mobile bottom nav -->
  <div class="dash-bottom-nav">
    <div class="dash-bottom-inner">
      <div class="dash-bot-item active" data-view="dv-home" aria-label="Inicio">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span class="dash-bot-label">Inicio</span>
      </div>
      <div class="dash-bot-item" data-view="dv-services" aria-label="Servicios">
        <span style="position:relative;display:inline-flex;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
          <span class="dash-bot-badge" id="svc-badge"></span>
        </span>
        <span class="dash-bot-label">Servicios</span>
      </div>
      <div class="dash-bot-item" data-view="dv-profile" aria-label="Perfil">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span class="dash-bot-label">Perfil</span>
      </div>
      <div class="dash-bot-cta tnl-trigger" aria-label="Solicitar servicio">
        <div class="dash-bot-cta-pill">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          <span>Solicitar</span>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- ROLE PICKER -->
<div id="rolePicker">
  <div class="rp-card">
    <div class="rp-logo">thruver</div>
    <div class="rp-title">¿Cómo deseas<br>continuar?</div>
    <div class="rp-sub">Selecciona tu tipo de cuenta</div>
    <div class="rp-options">
      <button class="rp-option rp-opt-client" id="rp-client">
        <div class="rp-option-icon">🏠</div>
        <div class="rp-option-label">Soy cliente</div>
        <div class="rp-option-desc">Solicita servicios del hogar</div>
      </button>
      <button class="rp-option rp-opt-tech" id="rp-tech">
        <div class="rp-option-icon">🔧</div>
        <div class="rp-option-label">Soy técnico</div>
        <div class="rp-option-desc">Recibe y gestiona trabajos</div>
      </button>
    </div>
  </div>
</div>

<!-- TECH DASHBOARD -->
<div id="techDashboard">
  <!-- Mobile header -->
  <div class="tech-mobile-hd">
    <button class="tech-mob-hamburger" id="tech-mob-hamburger" aria-label="Menú">
      <span></span><span></span><span></span>
    </button>
    <span class="tech-mobile-logo">thruver</span>
    <div class="tech-mobile-right">
      <div class="tech-mobile-status" id="tech-mob-status">
        <span class="tech-mob-dot"></span>
        <span id="tech-mob-status-lbl">No disponible</span>
      </div>
    </div>
  </div>

  <!-- Mobile sidebar drawer overlay -->
  <div class="tech-sidebar-overlay" id="tech-sidebar-overlay">
    <div class="tech-sidebar-drawer">
      <div class="tech-sidebar-brand" style="padding:1.2rem 1.25rem 1rem;">
        <span class="tech-brand-logo">thruver</span>
        <span class="tech-brand-chip">Técnico</span>
      </div>
      <div class="tech-sidebar-user" style="padding:1rem 1.25rem;">
        <div class="tech-sidebar-avatar" id="tech-drawer-av">T</div>
        <div class="tech-sidebar-info">
          <div class="tech-sidebar-uname" id="tech-drawer-name">—</div>
          <div class="tech-sidebar-uemail" id="tech-drawer-email">—</div>
        </div>
      </div>
      <div class="tech-status-wrap">
        <div class="tech-status-toggle" id="tech-drawer-status">
          <div class="tech-status-left">
            <span class="tech-status-dot" id="tech-drawer-dot"></span>
            <span class="tech-status-lbl" id="tech-drawer-status-lbl">No disponible</span>
          </div>
          <div class="tech-sw"></div>
        </div>
      </div>
      <div class="tech-sidebar-nav" id="tech-drawer-nav">
        <div class="tech-nav-link active" data-tview="tdv-home" data-drawer="1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Inicio
        </div>
        <div class="tech-nav-link" data-tview="tdv-requests" data-drawer="1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          Solicitudes
          <span class="tech-nav-badge visible" id="tnav-drawer-badge">3</span>
        </div>
        <div class="tech-nav-link" data-tview="tdv-history" data-drawer="1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Historial
        </div>
        <div class="tech-nav-link" data-tview="tdv-profile" data-drawer="1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Mi perfil
        </div>
      </div>
      <div class="tech-sidebar-bottom">
        <div class="tech-nav-logout" id="tech-drawer-logout">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Cerrar sesión
        </div>
      </div>
    </div>
  </div>

  <div class="tech-layout">
    <!-- Sidebar -->
    <aside class="tech-sidebar">
      <div class="tech-sidebar-brand">
        <span class="tech-brand-logo">thruver</span>
        <span class="tech-brand-chip">Técnico</span>
      </div>
      <div class="tech-sidebar-user">
        <div class="tech-sidebar-avatar" id="tech-sidebar-av">T</div>
        <div class="tech-sidebar-info">
          <div class="tech-sidebar-uname" id="tech-sidebar-name">—</div>
          <div class="tech-sidebar-uemail" id="tech-sidebar-email">—</div>
        </div>
      </div>
      <div class="tech-status-wrap">
        <div class="tech-status-toggle" id="tech-status-toggle">
          <div class="tech-status-left">
            <span class="tech-status-dot"></span>
            <span class="tech-status-lbl" id="tech-status-lbl">No disponible</span>
          </div>
          <div class="tech-sw"></div>
        </div>
      </div>
      <div class="tech-sidebar-nav">
        <div class="tech-nav-link active" data-tview="tdv-home">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Inicio
        </div>
        <div class="tech-nav-link" data-tview="tdv-requests">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          Solicitudes
          <span class="tech-nav-badge visible" id="tnav-badge">3</span>
        </div>
        <div class="tech-nav-link" data-tview="tdv-history">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Historial
        </div>
        <div class="tech-nav-link" data-tview="tdv-profile">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Mi perfil
        </div>
      </div>
      <div class="tech-sidebar-bottom">
        <div class="tech-nav-logout" id="tech-logout">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Cerrar sesión
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <div class="tech-main">

      <!-- VIEW: Inicio -->
      <div class="tech-view active" id="tdv-home">
        <div class="tech-view-hd tech-view-hd-row">
          <div>
            <h2 id="tech-greeting">Hola, Técnico.</h2>
            <p id="tech-greeting-sub">Tu panel de control</p>
          </div>
        </div>
        <!-- 4 metrics -->
        <div class="tech-metrics">
          <div class="tech-metric tm-blue">
            <div class="tech-metric-label">Jobs hoy</div>
            <div class="tech-metric-value" id="tm-today">0</div>
            <div class="tech-metric-sub">solicitados</div>
          </div>
          <div class="tech-metric tm-green">
            <div class="tech-metric-label">Completados</div>
            <div class="tech-metric-value" id="tm-done">0</div>
            <div class="tech-metric-sub">este mes</div>
          </div>
          <div class="tech-metric tm-amber">
            <div class="tech-metric-label">Ganancias</div>
            <div class="tech-metric-value" id="tm-earn">$0</div>
            <div class="tech-metric-sub">esta semana</div>
          </div>
          <div class="tech-metric tm-purple">
            <div class="tech-metric-label">Calificación</div>
            <div class="tech-metric-value" id="tm-rating">—</div>
            <div class="tech-metric-sub">promedio ★</div>
          </div>
        </div>
        <!-- Trabajo activo -->
        <div class="tech-sec-hd">
          <h3>Trabajo activo</h3>
        </div>
        <div id="tdv-active-wrap">
          <div class="tech-empty">
            <div class="tech-empty-ico">⚙️</div>
            <h4>Sin trabajo activo</h4>
            <p>Activa tu disponibilidad para<br>recibir nuevas solicitudes.</p>
          </div>
        </div>
        <!-- Resumen solicitudes -->
        <div class="tech-sec-hd" style="margin-top:1rem;">
          <h3>Solicitudes nuevas</h3>
          <button class="tech-sec-link" id="tech-see-requests">Ver todas →</button>
        </div>
        <div id="tdv-home-requests">
          <div class="tech-empty">
            <div class="tech-empty-ico">📋</div>
            <h4>Sin solicitudes pendientes</h4>
            <p>Las nuevas solicitudes aparecerán aquí<br>cuando estés disponible.</p>
          </div>
        </div>
      </div><!-- /tdv-home -->

      <!-- VIEW: Solicitudes -->
      <div class="tech-view" id="tdv-requests">
        <div class="tech-view-hd tech-view-hd-row">
          <div>
            <h2>Solicitudes</h2>
            <p>Acepta o rechaza antes de que expiren</p>
          </div>
          <span class="tech-job-badge tb-new" style="font-size:0.72rem;padding:0.3rem 0.85rem;">3 nuevas</span>
        </div>
        <div id="tdv-requests-list">
          <div class="tech-job-card">
            <div class="tech-job-head">
              <div class="tech-job-ico tech-job-ico-blue">🔧</div>
              <div class="tech-job-meta">
                <div class="tech-job-svc">Plomería — fuga de agua</div>
                <div class="tech-job-loc">📍 Col. San Pedro, Monterrey · 2.3 km</div>
              </div>
              <span class="tech-job-badge tb-new">Nueva</span>
            </div>
            <div class="tech-job-body">
              <div class="tech-timer-row">
                <span class="tech-timer-lbl">⏱ Expira en <span class="tech-countdown" data-secs="540">9:00</span></span>
              </div>
              <div class="tech-timer-bar"><div class="tech-timer-fill" style="width:100%"></div></div>
              <div class="tech-job-desc">Fuga bajo el lavabo de la cocina, lleva un día. Urgencia normal.</div>
              <div class="tech-job-actions">
                <button class="tbtn-primary">Aceptar</button>
                <button class="tbtn-ghost">Ver detalles</button>
                <button class="tbtn-danger">Rechazar</button>
              </div>
            </div>
          </div>
          <div class="tech-job-card">
            <div class="tech-job-head">
              <div class="tech-job-ico tech-job-ico-blue">⚡</div>
              <div class="tech-job-meta">
                <div class="tech-job-svc">Electricidad — corto circuito</div>
                <div class="tech-job-loc">📍 Col. Mitras, Monterrey · 4.1 km</div>
              </div>
              <span class="tech-job-badge tb-new">Nueva</span>
            </div>
            <div class="tech-job-body">
              <div class="tech-timer-row">
                <span class="tech-timer-lbl">⏱ Expira en <span class="tech-countdown" data-secs="312">5:12</span></span>
              </div>
              <div class="tech-timer-bar"><div class="tech-timer-fill" style="width:57%"></div></div>
              <div class="tech-job-desc">Se fue la luz en dos cuartos, el breaker dispara. Revisión urgente.</div>
              <div class="tech-job-actions">
                <button class="tbtn-primary">Aceptar</button>
                <button class="tbtn-ghost">Ver detalles</button>
                <button class="tbtn-danger">Rechazar</button>
              </div>
            </div>
          </div>
          <div class="tech-job-card">
            <div class="tech-job-head">
              <div class="tech-job-ico tech-job-ico-blue">❄️</div>
              <div class="tech-job-meta">
                <div class="tech-job-svc">Aire / Clima — no enfría</div>
                <div class="tech-job-loc">📍 Col. Cumbres, Monterrey · 6.8 km</div>
              </div>
              <span class="tech-job-badge tb-new">Nueva</span>
            </div>
            <div class="tech-job-body">
              <div class="tech-timer-row">
                <span class="tech-timer-lbl">⏱ Expira en <span class="tech-countdown" data-secs="720">12:00</span></span>
              </div>
              <div class="tech-timer-bar"><div class="tech-timer-fill" style="width:80%"></div></div>
              <div class="tech-job-desc">El minisplit enciende pero no baja temperatura. Quiere revisión hoy.</div>
              <div class="tech-job-actions">
                <button class="tbtn-primary">Aceptar</button>
                <button class="tbtn-ghost">Ver detalles</button>
                <button class="tbtn-danger">Rechazar</button>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /tdv-requests -->

      <!-- VIEW: Historial -->
      <div class="tech-view" id="tdv-history">
        <div class="tech-view-hd">
          <h2>Historial</h2>
          <p>Registro de trabajos completados</p>
        </div>
        <div class="tech-earn-card">
          <div>
            <div class="tech-earn-label">Ganancias esta semana</div>
            <div class="tech-earn-value" id="tech-earn-total">$0</div>
            <div class="tech-earn-sub">0 trabajos completados</div>
          </div>
          <div class="tech-earn-ico">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#93c5fd" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          </div>
        </div>
        <div class="tech-sec-hd">
          <h3>Trabajos recientes</h3>
        </div>
        <div id="tdv-history-list">
          <div class="tech-empty">
            <div class="tech-empty-ico">📂</div>
            <h4>Sin historial aún</h4>
            <p>Aquí verás todos tus trabajos completados<br>junto con las calificaciones recibidas.</p>
          </div>
        </div>
      </div><!-- /tdv-history -->

      <!-- VIEW: Mi perfil -->
      <div class="tech-view" id="tdv-profile">
        <div class="tech-view-hd">
          <h2>Mi perfil</h2>
          <p>Tu información como técnico verificado</p>
        </div>
        <div class="tech-profile-head">
          <div class="tech-profile-av" id="tech-prof-av">T</div>
          <div>
            <div class="tech-profile-name" id="tech-prof-name">—</div>
            <div class="tech-profile-role-lbl">Técnico verificado · Thruver</div>
            <div class="tech-rating-row">
              <span class="tech-stars">★★★★★</span>
              <span class="tech-rating-num">5.0</span>
              <span class="tech-rating-cnt">(0 reseñas)</span>
            </div>
          </div>
        </div>
        <div class="tech-profile-card">
          <div class="tech-prof-row">
            <span class="tech-prof-label">Correo</span>
            <span class="tech-prof-val" id="tech-prof-email">—</span>
          </div>
          <div class="tech-prof-row">
            <span class="tech-prof-label">Teléfono</span>
            <span class="tech-prof-val" id="tech-prof-tel" style="color:#475569;">—</span>
          </div>
          <div class="tech-prof-row">
            <span class="tech-prof-label">Zona de cobertura</span>
            <span class="tech-prof-val" id="tech-prof-zone" style="color:#475569;">—</span>
          </div>
          <div class="tech-prof-row" style="border-bottom:none;">
            <span class="tech-prof-label">Miembro desde</span>
            <span class="tech-prof-val" id="tech-prof-since">—</span>
          </div>
        </div>
        <div class="tech-profile-card">
          <div class="tech-prof-card-title">Servicios que ofrezco</div>
          <div class="tech-svc-grid">
            <label class="tech-svc-check"><input type="checkbox" checked /><span>Plomería</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Electricidad</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Limpieza</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Pintura</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Carpintería</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Jardinería</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Aire / Clima</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Remodelación</span></label>
            <label class="tech-svc-check"><input type="checkbox" /><span>Otro</span></label>
          </div>
        </div>
        <button id="tech-logout-prof" style="margin-top:0.5rem;background:none;border:1.5px solid rgba(239,68,68,0.3);border-radius:10px;color:#f87171;padding:0.85rem 1.5rem;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:var(--font);width:100%;max-width:520px;">Cerrar sesión</button>
      </div><!-- /tdv-profile -->

    </div><!-- /tech-main -->
  </div><!-- /tech-layout -->

  <!-- Mobile bottom nav -->
  <div class="tech-bottom-nav">
    <div class="tech-bottom-inner">
      <div class="tech-bot-item active" data-tview="tdv-home">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span class="tech-bot-label">Inicio</span>
      </div>
      <div class="tech-bot-item" data-tview="tdv-requests">
        <span style="position:relative;display:inline-flex;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          <span class="tech-bot-badge visible" id="tech-bot-badge"></span>
        </span>
        <span class="tech-bot-label">Solicitudes</span>
      </div>
      <div class="tech-bot-item" data-tview="tdv-history">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="tech-bot-label">Historial</span>
      </div>
      <div class="tech-bot-item" data-tview="tdv-profile">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span class="tech-bot-label">Perfil</span>
      </div>
    </div>
  </div>
</div><!-- /techDashboard -->

<!-- ONBOARDING -->
<div id="onboarding" class="onb-overlay">
  <div class="onb-card">
    <div class="onb-logo">thruver</div>
    <div class="onb-prog">
      <div class="onb-prog-dot done" id="onb-dot-1"></div>
      <div class="onb-prog-dot" id="onb-dot-2"></div>
    </div>
    <!-- Paso 1 -->
    <div class="onb-step onb-active" id="onb-step-1">
      <div class="onb-title">¡Bienvenido! 👋</div>
      <div class="onb-sub">Configura tu perfil en segundos para que podamos conectarte con el técnico correcto.</div>
      <div class="onb-field">
        <label>Tu nombre completo</label>
        <input type="text" id="onb-nombre" placeholder="Ej: María González" autocomplete="name" />
      </div>
      <div class="onb-field">
        <label>Teléfono de contacto</label>
        <input type="tel" id="onb-tel" placeholder="Ej: 81 1234 5678" autocomplete="tel" />
      </div>
      <button class="onb-btn" id="onb-next-1">Continuar →</button>
      <button class="onb-skip" id="onb-skip-1">Omitir por ahora</button>
    </div>
    <!-- Paso 2 -->
    <div class="onb-step" id="onb-step-2">
      <div class="onb-title">¿Dónde estás? 📍</div>
      <div class="onb-sub">Guardamos tu dirección para agilizar futuras solicitudes. La puedes cambiar después.</div>
      <div class="onb-field">
        <label>Calle y número</label>
        <input type="text" id="onb-calle" placeholder="Ej: Av. Morelos 45" autocomplete="street-address" />
      </div>
      <div class="onb-field">
        <label>Colonia</label>
        <input type="text" id="onb-colonia" placeholder="Ej: Col. Centro" />
      </div>
      <button class="onb-btn" id="onb-finish">Empezar a usar Thruver ✓</button>
      <button class="onb-skip" id="onb-skip-2">Omitir por ahora</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {

  var SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyEyoOsNCpYEixE1rksRScf28qSiuYAfDHReo3v8XeFZ725vD3MqxRBs3JmEGZAsMY8/exec';

  /* ─────────────────────────────────────────────
     HELPER: Guardar en Firebase Firestore
     Guarda en la colección indicada.
     Si Firebase no está listo, lo ignora sin romper nada.
  ───────────────────────────────────────────── */
  function saveToFirebase(coleccion, data) {
    return new Promise(function(resolve) {
      if (window.db && window.fbAddDoc && window.fbCollection) {
        var docData = Object.assign({}, data, { creadoEn: new Date().toISOString() });
        window.fbAddDoc(window.fbCollection(window.db, coleccion), docData)
          .then(function(docRef) {
            console.log('[Thruver Firebase] Guardado en "' + coleccion + '" ID: ' + docRef.id);
            resolve(docRef.id);
          })
          .catch(function(err) {
            console.warn('[Thruver Firebase] Error al guardar:', err);
            resolve(null);
          });
      } else {
        console.warn('[Thruver Firebase] SDK no listo, omitiendo.');
        resolve(null);
      }
    });
  }

  /* ═══════════════════════════════════════════
     HAMBURGER / DRAWER
  ═══════════════════════════════════════════ */
  var hamburger  = document.getElementById('nav-hamburger');
  var mobileMenu = document.getElementById('mobile-menu');

  function closeMobileMenu() {
    hamburger.classList.remove('open');
    mobileMenu.classList.remove('open');
    document.body.style.overflow = '';
  }

  hamburger.addEventListener('click', function () {
    var open = mobileMenu.classList.contains('open');
    if (open) { closeMobileMenu(); }
    else { hamburger.classList.add('open'); mobileMenu.classList.add('open'); document.body.style.overflow = 'hidden'; }
  });

  mobileMenu.querySelectorAll('a').forEach(function (a) { a.addEventListener('click', closeMobileMenu); });

  document.getElementById('btn-open-login-mobile').addEventListener('click', function () {
    closeMobileMenu();
    if (window.currentUser) { cargarHistorialYMostrarDashboard(window.currentUser); }
    else { openLogin(); }
  });

  /* ═══════════════════════════════════════════
     TÚNEL DE CONVERSIÓN
  ═══════════════════════════════════════════ */
  var overlay  = document.getElementById('tnlOverlay');
  var fill     = document.getElementById('tnlFill');
  var dots     = document.querySelectorAll('.tnl-dot');
  var success  = document.getElementById('tnl-success');
  var dtWrap   = document.getElementById('tnl-datetime-wrap');

  /* Estado acumulado */
  var T = { servicio:'', ico:'🔧', espacio:'', desc:'', urgencia:'Lo antes posible', fecha:'', hora:'', nombre:'', email:'', tel:'', dir:'' };

  var PROG = { 1:'14%', 2:'58%', 3:'90%' };

  /* ── Abrir túnel ── */
  function openTunnel(presetSvc) {
    resetTunnel();
    overlay.classList.add('tnl-open');
    document.body.style.overflow = 'hidden';
    overlay.scrollTop = 0;
    if (presetSvc) preselectService(presetSvc);
  }

  /* ── Cerrar túnel ── */
  function closeTunnel() {
    overlay.classList.remove('tnl-open');
    document.body.style.overflow = '';
  }

  /* ── Reset completo ── */
  function resetTunnel() {
    T = { servicio:'', ico:'🔧', espacio:'', desc:'', urgencia:'Lo antes posible', fecha:'', hora:'', nombre:'', email:'', tel:'', dir:'' };
    showView(1, true);
    success.classList.remove('tnl-show');
    document.getElementById('tnl-form-fields').style.display = '';
    document.getElementById('tnl-espacio').value = '';
    document.getElementById('tnl-desc').value = '';
    document.getElementById('tnl-nombre').value = '';
    document.getElementById('tnl-email').value = '';
    document.getElementById('tnl-tel').value = '';
    var calleEl   = document.getElementById('tnl-calle');   if(calleEl)   calleEl.value   = '';
    var numeroEl  = document.getElementById('tnl-numero');  if(numeroEl)  numeroEl.value  = '';
    var coloniaEl = document.getElementById('tnl-colonia'); if(coloniaEl) coloniaEl.value = '';
    document.getElementById('tnl-fecha').value = '';
    document.getElementById('tnl-hora').value = '10:00';
    var passEl2 = document.getElementById('tnl-pass'); if(passEl2) passEl2.value = '';
    var errEl2  = document.getElementById('tnl-auth-error'); if(errEl2) errEl2.classList.remove('visible');
    tnlAuthMode = 'register';
    var submitTxt = document.getElementById('tnl-submit-txt'); if(submitTxt) submitTxt.textContent = 'Crear cuenta y confirmar ✓';
    document.getElementById('tnl-u1').classList.add('tnl-urg-sel');
    document.getElementById('tnl-u2').classList.remove('tnl-urg-sel');
    dtWrap.classList.remove('visible');
    document.getElementById('r-fecha-row').classList.remove('visible');
    document.querySelectorAll('.tnl-svc-card').forEach(function(c){ c.classList.remove('tnl-svc-selected'); });
    var submitBtn = document.getElementById('tnl-submit');
    submitBtn.disabled = false;
    document.getElementById('tnl-spinner').style.display = 'none';
    document.getElementById('tnl-submit-txt').textContent = 'Confirmar solicitud ✓';
    clearErrors();
  }

  /* ── Mostrar vista de paso ── */
  function showView(n, forward) {
    document.querySelectorAll('.tnl-view').forEach(function(v){
      v.classList.remove('tnl-active','tnl-back');
    });
    var v = document.getElementById('tnl-s' + n);
    if (v) {
      v.classList.add(forward === false ? 'tnl-back' : 'tnl-active');
    }
    fill.style.width = PROG[n] || '90%';
    dots.forEach(function(d, i){
      d.classList.remove('active','done');
      if (i + 1 < n)  d.classList.add('done');
      if (i + 1 === n) d.classList.add('active');
    });
    overlay.scrollTop = 0;
  }

  /* ── Formatear fecha legible ── */
  function formatFecha(fecha, hora) {
    if (!fecha) return '';
    var meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
    var dias  = ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'];
    var d = new Date(fecha + 'T12:00:00');
    var str = dias[d.getDay()] + ' ' + d.getDate() + ' ' + meses[d.getMonth()] + ' ' + d.getFullYear();
    if (hora) str += ' · ' + hora;
    return str;
  }

  /* ── Pre-seleccionar servicio ── */
  function preselectService(svc) {
    var card = document.querySelector('.tnl-svc-card[data-svc="' + svc + '"]');
    if (card) {
      card.classList.add('tnl-svc-selected');
      T.servicio = svc;
      T.ico = card.getAttribute('data-ico') || '🔧';
      setTimeout(function(){ showView(2, true); }, 200);
    }
  }

  /* ── Actualizar recibo ── */
  function updateReceipt() {
    document.getElementById('r-svc-ico').textContent = T.ico;
    document.getElementById('r-svc').textContent  = T.servicio  || '—';
    document.getElementById('r-esp').textContent  = T.espacio   || '—';
    document.getElementById('r-urg').textContent  = T.urgencia  || '—';
    var d = T.desc || '—';
    document.getElementById('r-desc').textContent = d.length > 70 ? d.slice(0,70) + '…' : d;

    /* Fecha programada: visible solo si se agendó */
    var fechaRow = document.getElementById('r-fecha-row');
    if (T.urgencia === 'Agendar fecha' && T.fecha) {
      document.getElementById('r-fecha').textContent = formatFecha(T.fecha, T.hora);
      fechaRow.classList.add('visible');
    } else {
      fechaRow.classList.remove('visible');
    }
  }

  /* ── Helpers de validación ── */
  function markError(id) {
    var el = document.getElementById(id);
    if (el) el.classList.add('tnl-error');
  }
  function clearErrors() {
    document.querySelectorAll('.tnl-error').forEach(function(el){ el.classList.remove('tnl-error'); });
  }

  /* ── Validar email ── */
  function isValidEmail(e) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
  }

  /* ─────── Triggers de apertura ─────── */
  document.querySelectorAll('.tnl-trigger').forEach(function (el) {
    el.addEventListener('click', function (e) {
      e.preventDefault();
      closeMobileMenu();
      var preset = el.getAttribute('data-preset') || el.getAttribute('data-svc') || null;
      openTunnel(preset);
    });
  });

  /* ─────── Cerrar ─────── */
  document.getElementById('tnlClose').addEventListener('click', closeTunnel);
  document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && overlay.classList.contains('tnl-open')) closeTunnel(); });

  /* ─────── PASO 1: clic en tarjeta de servicio ─────── */
  document.querySelectorAll('.tnl-svc-card').forEach(function (card) {
    card.addEventListener('click', function () {
      document.querySelectorAll('.tnl-svc-card').forEach(function(c){ c.classList.remove('tnl-svc-selected'); });
      card.classList.add('tnl-svc-selected');
      T.servicio = card.getAttribute('data-svc');
      T.ico      = card.getAttribute('data-ico') || '🔧';
      setTimeout(function(){ showView(2, true); }, 240);
    });
  });

  /* ─────── PASO 2: urgencia toggle con calendario ─────── */
  document.getElementById('tnl-u1').addEventListener('click', function () {
    T.urgencia = 'Lo antes posible';
    this.classList.add('tnl-urg-sel');
    document.getElementById('tnl-u2').classList.remove('tnl-urg-sel');
    dtWrap.classList.remove('visible');
  });
  document.getElementById('tnl-u2').addEventListener('click', function () {
    T.urgencia = 'Agendar fecha';
    this.classList.add('tnl-urg-sel');
    document.getElementById('tnl-u1').classList.remove('tnl-urg-sel');
    /* Mostrar calendario y establecer mínimo de hoy */
    var today = new Date();
    var yyyy  = today.getFullYear();
    var mm    = String(today.getMonth() + 1).padStart(2, '0');
    var dd    = String(today.getDate()).padStart(2, '0');
    document.getElementById('tnl-fecha').min = yyyy + '-' + mm + '-' + dd;
    dtWrap.classList.add('visible');
    /* Scroll suave al calendario en móvil */
    setTimeout(function(){
      dtWrap.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
  });

  /* ─────── PASO 2: continuar ─────── */
  document.getElementById('tnl-next2').addEventListener('click', function () {
    clearErrors();
    var esp = document.getElementById('tnl-espacio').value;
    if (!esp) { markError('tnl-espacio'); document.getElementById('tnl-espacio').focus(); return; }

    /* Validar fecha si eligió agendar */
    if (T.urgencia === 'Agendar fecha') {
      var fechaVal = document.getElementById('tnl-fecha').value;
      if (!fechaVal) {
        document.getElementById('tnl-fecha').classList.add('tnl-error');
        dtWrap.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        return;
      }
      T.fecha = fechaVal;
      T.hora  = document.getElementById('tnl-hora').value || '10:00';
    } else {
      T.fecha = '';
      T.hora  = '';
    }

    T.espacio = esp;
    T.desc    = document.getElementById('tnl-desc').value.trim();
    updateReceipt();
    showView(3, true);
  });

  /* ─────── Botones de volver ─────── */
  document.getElementById('tnl-back2').addEventListener('click', function(){ showView(1, false); });
  document.getElementById('tnl-back3').addEventListener('click', function(){ showView(2, false); });

  /* ------- AUTH STATE ------- */
  var tnlAuthMode = 'register';

  /* Muestra u oculta los campos de contacto del tunnel según si hay datos guardados */
  function actualizarContactWrap(user) {
    var tel    = localStorage.getItem('thruver_tel')    || '';
    var calle  = localStorage.getItem('thruver_calle')  || '';
    var wrap   = document.getElementById('tnl-contact-wrap');
    var card   = document.getElementById('tnl-saved-card');
    if (!wrap || !card) return;
    var tieneData = user && tel && calle;
    wrap.style.display = tieneData ? 'none' : '';
    card.style.display = tieneData ? '' : 'none';
    if (tieneData) {
      var colonia = localStorage.getItem('thruver_colonia') || '';
      var nombre  = user.displayName || localStorage.getItem('thruver_nombre') || '';
      var dir     = [calle, colonia].filter(Boolean).join(', ');
      document.getElementById('tnl-saved-name').textContent = nombre || '—';
      document.getElementById('tnl-saved-tel').textContent  = tel;
      document.getElementById('tnl-saved-dir').textContent  = dir || '—';
      /* Pre-llenar campos ocultos para el submit */
      var nEl = document.getElementById('tnl-nombre'); if (nEl) nEl.value = nombre;
      var tEl = document.getElementById('tnl-tel');    if (tEl) tEl.value = tel;
      var cEl = document.getElementById('tnl-calle');  if (cEl) cEl.value = calle;
      var oEl = document.getElementById('tnl-colonia');if (oEl) oEl.value = colonia;
    }
  }

  document.getElementById('tnl-saved-edit').addEventListener('click', function() {
    var wrap = document.getElementById('tnl-contact-wrap');
    var card = document.getElementById('tnl-saved-card');
    if (wrap) wrap.style.display = '';
    if (card) card.style.display = 'none';
  });

  window.onUserLoggedIn = function(user) {
    var banner = document.getElementById('tnl-session-banner');
    if (!banner) return;
    var initials = (user.displayName || user.email || '?').charAt(0).toUpperCase();
    document.getElementById('tnl-session-avatar').textContent = initials;
    document.getElementById('tnl-session-name').textContent   = user.displayName || 'Usuario';
    document.getElementById('tnl-session-email').textContent  = user.email || '';
    banner.classList.add('visible');
    document.querySelectorAll('.tnl-auth-fields').forEach(function(el){ el.classList.add('hidden'); });
    var eEl = document.getElementById('tnl-email'); if (eEl && user.email) eEl.value = user.email;
    document.getElementById('tnl-submit-txt').textContent = 'Confirmar solicitud ✓';
    actualizarNavConUsuario(user);
    actualizarContactWrap(user);
  };

  window.onUserLoggedOut = function() {
    var banner = document.getElementById('tnl-session-banner');
    if (banner) banner.classList.remove('visible');
    document.querySelectorAll('.tnl-auth-fields').forEach(function(el){ el.classList.remove('hidden'); });
    var wrap = document.getElementById('tnl-contact-wrap');
    var card = document.getElementById('tnl-saved-card');
    if (wrap) wrap.style.display = '';
    if (card) card.style.display = 'none';
  };

  document.getElementById('tnl-session-out').addEventListener('click', function() {
    if (window.fbSignOut && window.auth) window.fbSignOut(window.auth).catch(function(){});
  });

  document.getElementById('tnl-pass-toggle').addEventListener('click', function() {
    var inp = document.getElementById('tnl-pass');
    var eyeOpen  = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
    var eyeSlash = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';
    if (inp.type === 'password') { inp.type = 'text';     this.innerHTML = eyeSlash; }
    else                         { inp.type = 'password'; this.innerHTML = eyeOpen;  }
  });

  document.getElementById('tnl-mode-switch').addEventListener('click', function() {
    var forgotWrap = document.getElementById('tnl-forgot-wrap');
    var resetMsg   = document.getElementById('tnl-reset-msg');
    if (tnlAuthMode === 'register') {
      tnlAuthMode = 'login';
      document.getElementById('tnl-mode-text').textContent  = '¿No tienes cuenta?';
      this.textContent = 'Crear cuenta';
      document.getElementById('tnl-pass-hint').textContent  = '';
      document.getElementById('tnl-submit-txt').textContent = 'Iniciar sesión y confirmar ✓';
      document.getElementById('tnl-pass').setAttribute('autocomplete','current-password');
      if (forgotWrap) forgotWrap.style.display = 'block';
    } else {
      tnlAuthMode = 'register';
      document.getElementById('tnl-mode-text').textContent  = '¿Ya tienes cuenta?';
      this.textContent = 'Iniciar sesión';
      document.getElementById('tnl-pass-hint').textContent  = ' — mínimo 6 caracteres';
      document.getElementById('tnl-submit-txt').textContent = 'Crear cuenta y confirmar ✓';
      document.getElementById('tnl-pass').setAttribute('autocomplete','new-password');
      if (forgotWrap) forgotWrap.style.display = 'none';
      if (resetMsg) { resetMsg.className = 'tnl-reset-msg'; resetMsg.textContent = ''; }
    }
  });

  /* ------- Olvidaste contrasena ------- */
  document.getElementById('tnl-forgot-btn').addEventListener('click', function() {
    var emailEl  = document.getElementById('tnl-email');
    var resetMsg = document.getElementById('tnl-reset-msg');
    var email    = emailEl ? emailEl.value.trim() : '';
    resetMsg.className = 'tnl-reset-msg'; resetMsg.textContent = '';
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      resetMsg.textContent = 'Ingresa tu correo arriba primero.';
      resetMsg.className = 'tnl-reset-msg err';
      if (emailEl) emailEl.focus();
      return;
    }
    var btn = this; btn.disabled = true; btn.textContent = 'Enviando...';
    if (window.auth && window.fbSendPasswordReset) {
      window.fbSendPasswordReset(window.auth, email)
        .then(function() {
          resetMsg.textContent = '✅ Correo enviado a ' + email + '. Revisa tu bandeja (y spam).';
          resetMsg.className = 'tnl-reset-msg ok';
        })
        .catch(function(err) {
          var msg = err.code === 'auth/user-not-found'
            ? 'No encontramos una cuenta con ese correo.'
            : 'Error al enviar: ' + err.message;
          resetMsg.textContent = msg;
          resetMsg.className = 'tnl-reset-msg err';
        })
        .finally(function() { btn.disabled = false; btn.textContent = '¿Olvidaste tu contraseña?'; });
    } else {
      resetMsg.textContent = 'Firebase no está listo. Recarga la página.';
      resetMsg.className = 'tnl-reset-msg err';
      btn.disabled = false; btn.textContent = '¿Olvidaste tu contraseña?';
    }
  });

  document.getElementById('tnl-google-btn').addEventListener('click', function() {
    var errEl = document.getElementById('tnl-auth-error');
    errEl.classList.remove('visible');
    if (!window.fbSignInWithPopup || !window.auth || !window.fbGoogleProvider) {
      errEl.textContent = 'Firebase no est\u00E1 listo. Recarga la p\u00E1gina.';
      errEl.classList.add('visible'); return;
    }
    var btn = this; btn.disabled = true; btn.textContent = 'Conectando con Google...';
    window.fbSignInWithPopup(window.auth, window.fbGoogleProvider)
      .then(function(r){ console.log('[Thruver] Google OK:', r.user.uid); })
      .catch(function(err){ errEl.textContent = 'Error con Google: ' + err.message; errEl.classList.add('visible'); })
      .finally(function(){
        btn.disabled = false;
        btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z"/></svg> Continuar con Google';
      });
  });

  /* ------- PASO 3: envio final con Firebase Auth ------- */
  document.getElementById('tnl-submit').addEventListener('click', function () {
    clearErrors();
    var errEl = document.getElementById('tnl-auth-error');
    errEl.classList.remove('visible');
    var nombre = document.getElementById('tnl-nombre').value.trim();
    var emailEl = document.getElementById('tnl-email');
    var email   = emailEl ? emailEl.value.trim() : '';
    var passEl  = document.getElementById('tnl-pass');
    var pass    = passEl ? passEl.value : '';
    var valid   = true;
    var haySession   = window.currentUser != null;
    var contactWrap  = document.getElementById('tnl-contact-wrap');
    var datosGuardados = contactWrap && contactWrap.style.display === 'none';
    /* Leer valores de campos (pre-llenados aunque estén ocultos) */
    var tel     = document.getElementById('tnl-tel').value.trim();
    var calle   = document.getElementById('tnl-calle') ? document.getElementById('tnl-calle').value.trim() : '';
    var numero  = document.getElementById('tnl-numero') ? document.getElementById('tnl-numero').value.trim() : '';
    var colonia = document.getElementById('tnl-colonia') ? document.getElementById('tnl-colonia').value.trim() : '';
    var dir     = [calle, numero ? 'No.' + numero : '', colonia].filter(Boolean).join(', ');
    /* Solo validar campos visibles */
    if (!datosGuardados) {
      if (!nombre) { markError('tnl-nombre'); valid = false; }
      if (!tel)    { markError('tnl-tel');    valid = false; }
      if (!calle)   { markError('tnl-calle');   valid = false; }
      if (!colonia) { markError('tnl-colonia');  valid = false; }
    }
    if (!haySession) {
      if (!isValidEmail(email)) { markError('tnl-email'); valid = false; }
      if (!pass || pass.length < 6) { if(passEl) passEl.classList.add('tnl-error'); valid = false; }
    }
    if (!valid) { var fe = document.querySelector('.tnl-error'); if(fe) fe.scrollIntoView({behavior:'smooth',block:'center'}); return; }
    T.nombre = nombre || (window.currentUser ? window.currentUser.displayName : '') || localStorage.getItem('thruver_nombre') || '';
    T.email  = email || (window.currentUser ? window.currentUser.email : '');
    T.tel = tel; T.dir = dir; T.calle = calle; T.numero = numero; T.colonia = colonia;
    var btn = document.getElementById('tnl-submit');
    btn.disabled = true;
    document.getElementById('tnl-spinner').style.display = 'block';
    document.getElementById('tnl-submit-txt').textContent = 'Procesando...';

    function enviarSolicitud(uid, userEmail, userName) {
      var payload = {
        tipo:'CLIENTE', uid:uid, servicio:T.servicio, espacio:T.espacio,
        descripcion:T.desc, urgencia:T.urgencia,
        fecha_programada: T.urgencia==='Agendar fecha' ? formatFecha(T.fecha,T.hora) : '',
        nombre:userName||T.nombre, email:userEmail||T.email,
        telefono:T.tel, direccion:T.dir, calle:T.calle, numero:T.numero, colonia:T.colonia, estado:'nueva',
        timestamp:new Date().toISOString()
      };
      window._lastPayload = payload;
      fetch(SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).catch(function(){});
      saveToFirebase('solicitudes', payload).finally(function(){
        var h2 = document.querySelector('#tnl-success h2');
        if (h2) h2.textContent = '\u00A1Listo, ' + (userName||T.nombre).split(' ')[0] + '!';
        document.querySelectorAll('.tnl-view').forEach(function(v){ v.classList.remove('tnl-active','tnl-back'); });
        fill.style.width = '100%';
        dots.forEach(function(d){ d.classList.add('done'); d.classList.remove('active'); });
        success.classList.add('tnl-show');
        overlay.scrollTop = 0;
      });
    }

    if (haySession) { var u = window.currentUser; enviarSolicitud(u.uid, u.email, u.displayName||T.nombre); return; }
    if (!window.fbCreateUser || !window.auth) {
      errEl.textContent = 'Firebase no est\u00E1 listo. Recarga la p\u00E1gina.';
      errEl.classList.add('visible');
      btn.disabled=false; document.getElementById('tnl-spinner').style.display='none';
      document.getElementById('tnl-submit-txt').textContent='Confirmar solicitud \u2713'; return;
    }
    var authPromise = tnlAuthMode==='register'
      ? window.fbCreateUser(window.auth, email, pass)
      : window.fbSignIn(window.auth, email, pass);
    authPromise
      .then(function(result) {
        window.currentUser = result.user;
        actualizarNavConUsuario(result.user);
        enviarSolicitud(result.user.uid, result.user.email, T.nombre);
      })
      .catch(function(err) {
        var msgs = {
          'auth/email-already-in-use':'Este correo ya tiene cuenta. Usa \"Iniciar sesi\u00F3n\".',
          'auth/wrong-password':'Contrase\u00F1a incorrecta.',
          'auth/invalid-credential':'Correo o contrase\u00F1a incorrectos.',
          'auth/user-not-found':'No encontramos esta cuenta.',
          'auth/weak-password':'La contrase\u00F1a debe tener al menos 6 caracteres.'
        };
        errEl.textContent = msgs[err.code] || ('Error: ' + err.message);
        errEl.classList.add('visible');
        errEl.scrollIntoView({behavior:'smooth',block:'center'});
        btn.disabled=false; document.getElementById('tnl-spinner').style.display='none';
        document.getElementById('tnl-submit-txt').textContent = tnlAuthMode==='register' ? 'Crear cuenta y confirmar \u2713' : 'Iniciar sesi\u00F3n y confirmar \u2713';
      });
  });

  /* ------- Exito: ir al dashboard ------- */
  document.getElementById('tnl-ok').addEventListener('click', function() {
    closeTunnel();
    if (window.currentUser) cargarHistorialYMostrarDashboard(window.currentUser);
  });

  /* ------- Actualizar nav con usuario ------- */
  function actualizarNavConUsuario(user) {
    var dn      = user.displayName || user.email || 'Usuario';
    var inicial = dn.charAt(0).toUpperCase();
    var nombre  = dn.split(' ')[0];
    /* Top nav pill */
    var tav = document.getElementById('dash-topnav-avatar'); if(tav) tav.textContent = inicial;
    var tnm = document.getElementById('dash-topnav-name');   if(tnm) tnm.textContent = nombre;
    /* Greeting */
    var gr = document.getElementById('dash-greeting-name');  if(gr) gr.textContent = 'Bienvenido a Thruver, ' + nombre + '.';
    /* Profile view */
    var pa = document.getElementById('dash-profile-avatar'); if(pa) pa.textContent = inicial;
    var pn = document.getElementById('dash-profile-name');   if(pn) pn.textContent = dn;
    var pe = document.getElementById('dash-profile-email');  if(pe) pe.textContent = user.email || '';
    var pt = document.getElementById('dash-profile-total');  if(pt) pt.textContent = '0';
    /* Fecha de registro */
    var ps = document.getElementById('dash-profile-since');
    if (ps) {
      var creado = user.metadata && user.metadata.creationTime ? new Date(user.metadata.creationTime) : new Date();
      ps.textContent = creado.toLocaleDateString('es-MX', { month:'long', year:'numeric' });
    }
    /* Landing nav button */
    var btnLogin = document.getElementById('btn-open-login');
    if (btnLogin) btnLogin.textContent = nombre;
  }

  /* ------- Cargar historial y mostrar dashboard ------- */
  function cargarHistorialYMostrarDashboard(user) {
    var savedRole = localStorage.getItem('thruver_role');
    if (!savedRole) { showRolePicker(user); return; }
    if (savedRole === 'tech') { showTechDashboard(user); return; }
    actualizarNavConUsuario(user);
    showDashboard();
    if (!window.fbGetDocs || !window.fbQuery || !window.fbWhere || !window.db) return;
    window.fbGetDocs(window.fbQuery(window.fbCollection(window.db, 'solicitudes'), window.fbWhere('uid', '==', user.uid)))
      .then(function(snap) {
        var svcs = [];
        snap.forEach(function(d){ svcs.push(d.data()); });
        svcs.sort(function(a, b){ return b.timestamp > a.timestamp ? -1 : 1; });
        /* Update profile total */
        var pt = document.getElementById('dash-profile-total');
        if (pt) pt.textContent = svcs.length;
        /* Update stat cards */
        var stTotal  = document.getElementById('stat-total');
        var stActive = document.getElementById('stat-active');
        var stDone   = document.getElementById('stat-done');
        if (stTotal)  stTotal.textContent  = svcs.length;
        if (stActive) stActive.textContent = svcs.filter(function(s){ return s.estado === 'activo'; }).length;
        if (stDone)   stDone.textContent   = svcs.filter(function(s){ return s.estado === 'completado'; }).length;
        /* Badge notificación: servicios pendientes */
        var pendientes = svcs.filter(function(s){ return !s.estado || s.estado === 'nueva' || s.estado === 'enviada'; }).length;
        var badge = document.getElementById('svc-badge');
        if (badge) badge.classList.toggle('visible', pendientes > 0);
        /* Ocultar skeletons */
        var skelH = document.getElementById('dash-historial-skel');
        var skelS = document.getElementById('dash-services-skel');
        if (skelH) skelH.style.display = 'none';
        if (skelS) skelS.style.display = 'none';
        /* Mostrar empty si vacío */
        var emptyH = document.getElementById('dash-historial-empty');
        var emptyS = document.getElementById('dash-services-empty');
        if (emptyH) emptyH.style.display = svcs.length === 0 ? '' : 'none';
        if (emptyS) emptyS.style.display = svcs.length === 0 ? '' : 'none';
        renderizarHistorial(svcs);
      }).catch(function(e){
        console.warn('[Thruver] Historial error:', e);
        /* Si falla, ocultar skeleton y mostrar estado vacío */
        ['dash-historial-skel','dash-services-skel'].forEach(function(id){ var el=document.getElementById(id); if(el) el.style.display='none'; });
        ['dash-historial-empty','dash-services-empty'].forEach(function(id){ var el=document.getElementById(id); if(el) el.style.display=''; });
      });
  }

  /* ------- Renderizar historial ------- */
  function renderizarHistorial(svcs) {
    var SVC_INFO = {
      'Plomer\u00EDa':    { cls:'ic-blue',   svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>' },
      'Electricidad':     { cls:'ic-yellow', svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>' },
      'Limpieza':         { cls:'ic-green',  svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>' },
      'Pintura':          { cls:'ic-purple', svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.37 2.63 14 7l-1.59-1.59-2.83 2.83 1.59 1.59L7 14l-1-4-4 4 4 4h16V8z"/></svg>' },
      'Carpinter\u00EDa': { cls:'ic-orange', svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"/></svg>' },
      'Jardiner\u00EDa':  { cls:'ic-teal',   svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>' },
      'Aire / Clima':     { cls:'ic-sky',    svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>' },
      'Remodelaci\u00F3n':{ cls:'ic-gray',   svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>' }
    };
    var defaultInfo = { cls:'ic-gray', svg:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>' };
    var reportSvg = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>';

    function buildTable(rows) {
      var wrap = document.createElement('div');
      wrap.className = 'dash-tbl-scroll';
      var tbl = document.createElement('table');
      tbl.className = 'dash-table';
      tbl.innerHTML = '<thead><tr><th></th><th>Servicio</th><th>Fecha</th><th>Costo</th><th>Estado</th><th>Reporte</th></tr></thead>';
      var tbody = document.createElement('tbody');
      rows.forEach(function(s){ tbody.appendChild(buildTr(s)); });
      tbl.appendChild(tbody);
      wrap.appendChild(tbl);
      return wrap;
    }

    function buildTr(s) {
      var info  = SVC_INFO[s.servicio] || defaultInfo;
      var fecha = s.timestamp ? new Date(s.timestamp).toLocaleDateString('es-MX', {day:'2-digit',month:'short',year:'numeric'}) : '\u2014';
      var estadoMap = { 'nueva':'Pendiente', 'enviada':'Pendiente', 'activo':'En progreso', 'en progreso':'En progreso', 'completado':'Completado', 'cancelado':'Cancelado' };
      var estadoCls = { 'Pendiente':'badge-pending', 'En progreso':'badge-progress', 'Completado':'badge-done', 'Cancelado':'dash-tbl-badge' };
      var estadoLabel = estadoMap[(s.estado||'').toLowerCase()] || 'Pendiente';
      var estadoCl    = estadoCls[estadoLabel] || 'badge-pending';
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td><div class="dash-tbl-svc-ico ' + info.cls + '">' + info.svg + '</div></td>' +
        '<td><span style="font-weight:700;font-size:0.82rem;color:#111;">' + (s.servicio || '\u2014') + '</span>' + (s.espacio ? '<div style="font-size:0.71rem;color:#9ca3af;margin-top:1px;">' + s.espacio + '</div>' : '') + '</td>' +
        '<td style="color:#6b7280;font-size:0.8rem;">' + fecha + '</td>' +
        '<td style="color:#9ca3af;font-size:0.8rem;">\u2014</td>' +
        '<td><span class="dash-tbl-badge ' + estadoCl + '">' + estadoLabel + '</span></td>' +
        '<td><button class="dash-tbl-report" title="Ver reporte t\u00E9cnico">' + reportSvg + '</button></td>';
      return tr;
    }

    /* ── Home card: recent (max 5) ── */
    var histEl  = document.getElementById('dash-card-historial');
    var emptyEl = document.getElementById('dash-historial-empty');
    if (histEl) {
      histEl.querySelectorAll('.dash-tbl-scroll').forEach(function(t){ t.remove(); });
      if (svcs.length === 0) {
        if (emptyEl) emptyEl.style.display = '';
      } else {
        if (emptyEl) emptyEl.style.display = 'none';
        histEl.appendChild(buildTable(svcs.slice(0, 5)));
      }
    }

    /* ── Services view: full list ── */
    var listEl    = document.getElementById('dash-services-list');
    var listEmpty = document.getElementById('dash-services-empty');
    if (listEl) {
      listEl.querySelectorAll('.dash-tbl-scroll').forEach(function(t){ t.remove(); });
      if (svcs.length === 0) {
        if (listEmpty) listEmpty.style.display = '';
      } else {
        if (listEmpty) listEmpty.style.display = 'none';
        listEl.appendChild(buildTable(svcs));
      }
    }
  }


  /* ═══════════════════════════════════════════
     LOGIN MODAL — con Firebase Auth
  ═══════════════════════════════════════════ */
  /* ═══════════════════════════════════════════
     MODAL: LOGIN / FORGOT / REGISTER
  ═══════════════════════════════════════════ */
  var loginModal = document.getElementById('loginModal');

  /* SVG icons for eye toggle */
  var svgEyeOpen  = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
  var svgEyeSlash = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';

  /* Helper: switch between panels */
  function showModalPanel(panelId) {
    document.querySelectorAll('.modal-panel').forEach(function(p){ p.classList.remove('active'); });
    document.getElementById(panelId).classList.add('active');
    loginModal.querySelector('.modal-box').scrollTop = 0;
  }

  /* Helper: show/hide error or success message in modal */
  function modalMsg(elId, text, type) {
    var el = document.getElementById(elId);
    if (!el) return;
    el.textContent = text;
    el.className = type === 'ok' ? 'modal-success visible' : 'modal-error visible';
  }
  function clearModalMsg(elId) {
    var el = document.getElementById(elId); if(el) { el.textContent=''; el.className = el.className.replace(' visible',''); }
  }

  /* Open / Close */
  function openLogin() {
    showModalPanel('modal-panel-login');
    loginModal.classList.add('open');
    setTimeout(function(){ var e=document.getElementById('login-email'); if(e) e.focus(); }, 120);
  }
  function closeLogin() {
    loginModal.classList.remove('open');
    /* reset all fields */
    ['login-email','login-pass','forgot-email','reg-nombre','reg-email','reg-pass','reg-tel','reg-calle','reg-numero','reg-colonia'].forEach(function(id){
      var el = document.getElementById(id); if(el) el.value = '';
    });
    ['login-error','forgot-error','forgot-success','register-error'].forEach(clearModalMsg);
    /* reset buttons */
    [['btn-do-login','btn-login-text','Entrar →'],['btn-do-forgot','btn-forgot-text','Enviar enlace'],['btn-do-register','btn-register-text','Crear cuenta']].forEach(function(t){
      var btn=document.getElementById(t[0]); if(btn) btn.disabled=false;
      var txt=document.getElementById(t[1]); if(txt) txt.textContent=t[2];
      var sp=document.getElementById('spinner-'+t[0].replace('btn-do-','')); if(sp) sp.style.display='none';
    });
  }

  /* ── LOGIN ── */
  function doLogin() {
    clearModalMsg('login-error');
    var email = document.getElementById('login-email').value.trim();
    var pass  = document.getElementById('login-pass').value;
    if (!email || !pass) { modalMsg('login-error','Por favor ingresa tu correo y contraseña.'); return; }
    var btn=document.getElementById('btn-do-login'), txt=document.getElementById('btn-login-text'), sp=document.getElementById('spinner-login');
    btn.disabled=true; sp.style.display='block'; txt.textContent='Verificando...';
    if (window.fbSignIn && window.auth) {
      window.fbSignIn(window.auth, email, pass)
        .then(function(r){ window.currentUser=r.user; closeLogin(); cargarHistorialYMostrarDashboard(r.user); })
        .catch(function(err){
          var msg = {'auth/invalid-credential':'Correo o contraseña incorrectos.','auth/wrong-password':'Correo o contraseña incorrectos.','auth/user-not-found':'No encontramos esta cuenta.'}[err.code] || ('Error: '+err.message);
          modalMsg('login-error', msg);
          btn.disabled=false; sp.style.display='none'; txt.textContent='Entrar →';
        });
    } else { setTimeout(function(){ closeLogin(); showDashboard(); }, 900); }
  }

  /* ── FORGOT PASSWORD ── */
  function doForgot() {
    clearModalMsg('forgot-error'); clearModalMsg('forgot-success');
    var email = document.getElementById('forgot-email').value.trim();
    if (!email) { modalMsg('forgot-error','Ingresa tu correo electrónico.'); return; }
    var btn=document.getElementById('btn-do-forgot'), txt=document.getElementById('btn-forgot-text'), sp=document.getElementById('spinner-forgot');
    btn.disabled=true; sp.style.display='block'; txt.textContent='Enviando...';
    if (window.fbSendPasswordReset && window.auth) {
      window.fbSendPasswordReset(window.auth, email)
        .then(function(){ modalMsg('forgot-success','✅ Correo enviado a '+email+'. Revisa tu bandeja (y spam).','ok'); })
        .catch(function(err){
          var msg = err.code==='auth/user-not-found' ? 'No encontramos una cuenta con ese correo.' : 'Error: '+err.message;
          modalMsg('forgot-error', msg);
        })
        .finally(function(){ btn.disabled=false; sp.style.display='none'; txt.textContent='Enviar enlace'; });
    } else { modalMsg('forgot-error','Firebase no está listo. Recarga la página.'); btn.disabled=false; sp.style.display='none'; txt.textContent='Enviar enlace'; }
  }

  /* ── REGISTER ── */
  function doRegister() {
    clearModalMsg('register-error');
    var nombre  = document.getElementById('reg-nombre').value.trim();
    var email   = document.getElementById('reg-email').value.trim();
    var pass    = document.getElementById('reg-pass').value;
    var tel     = document.getElementById('reg-tel').value.trim();
    var calle   = document.getElementById('reg-calle').value.trim();
    var numero  = document.getElementById('reg-numero').value.trim();
    var colonia = document.getElementById('reg-colonia').value.trim();
    if (!nombre||!email||!pass||!tel||!calle||!colonia) { modalMsg('register-error','Por favor completa todos los campos obligatorios.'); return; }
    if (pass.length < 6) { modalMsg('register-error','La contraseña debe tener al menos 6 caracteres.'); return; }
    var btn=document.getElementById('btn-do-register'), txt=document.getElementById('btn-register-text'), sp=document.getElementById('spinner-register');
    btn.disabled=true; sp.style.display='block'; txt.textContent='Creando cuenta...';
    if (window.fbCreateUser && window.auth) {
      window.fbCreateUser(window.auth, email, pass)
        .then(function(result) {
          var user = result.user;
          window.currentUser = user;
          /* Save profile to Firestore */
          var direccion = [calle, numero ? 'No.'+numero : '', colonia].filter(Boolean).join(', ');
          var perfil = { uid:user.uid, nombre:nombre, email:email, telefono:tel, calle:calle, numero:numero, colonia:colonia, direccion:direccion, creadoEn:new Date().toISOString() };
          saveToFirebase('usuarios', perfil);
          closeLogin();
          cargarHistorialYMostrarDashboard(user);
        })
        .catch(function(err){
          var msg = {'auth/email-already-in-use':'Este correo ya tiene cuenta. Usa "Iniciar sesión".','auth/weak-password':'La contraseña debe tener al menos 6 caracteres.','auth/invalid-email':'Correo electrónico inválido.'}[err.code] || ('Error: '+err.message);
          modalMsg('register-error', msg);
          btn.disabled=false; sp.style.display='none'; txt.textContent='Crear cuenta';
        });
    } else { modalMsg('register-error','Firebase no está listo. Recarga la página.'); btn.disabled=false; sp.style.display='none'; txt.textContent='Crear cuenta'; }
  }

  /* ── EYE TOGGLES ── */
  function setupEyeToggle(btnId, inputId) {
    var btn = document.getElementById(btnId);
    if (!btn) return;
    btn.addEventListener('click', function() {
      var inp = document.getElementById(inputId);
      if (inp.type === 'password') { inp.type = 'text'; btn.innerHTML = svgEyeSlash; }
      else { inp.type = 'password'; btn.innerHTML = svgEyeOpen; }
    });
  }
  setupEyeToggle('login-pass-eye', 'login-pass');
  setupEyeToggle('reg-pass-eye',   'reg-pass');

  /* ── EVENT LISTENERS ── */
  document.getElementById('btn-open-login').addEventListener('click', function() {
    if (window.currentUser) { cargarHistorialYMostrarDashboard(window.currentUser); }
    else { openLogin(); }
  });
  document.getElementById('btn-close-login').addEventListener('click', closeLogin);
  loginModal.addEventListener('click', function(e){ if (e.target === loginModal) closeLogin(); });

  document.getElementById('btn-do-login').addEventListener('click', doLogin);
  document.getElementById('login-pass').addEventListener('keydown', function(e){ if (e.key==='Enter') doLogin(); });

  document.getElementById('btn-to-forgot').addEventListener('click', function(){ showModalPanel('modal-panel-forgot'); });
  document.getElementById('btn-back-to-login').addEventListener('click', function(){ showModalPanel('modal-panel-login'); });

  document.getElementById('btn-to-register').addEventListener('click', function(){ showModalPanel('modal-panel-register'); });
  document.getElementById('btn-back-to-login-2').addEventListener('click', function(){ showModalPanel('modal-panel-login'); });

  document.getElementById('btn-do-forgot').addEventListener('click', doForgot);
  document.getElementById('forgot-email').addEventListener('keydown', function(e){ if (e.key==='Enter') doForgot(); });

  document.getElementById('btn-do-register').addEventListener('click', doRegister);

  /* Mobile menu "Iniciar sesion" also opens the modal */

  /* ═══════════════════════════════════════════
     DASHBOARD
  ═══════════════════════════════════════════ */
  var dashboard = document.getElementById('dashboard');
  var mainNav   = document.getElementById('main-nav');

  var _landingHidden = [];
  function showDashboard() {
    dashboard.classList.add('dash-open');
    _landingHidden = [];
    document.querySelectorAll('body > *:not(#dashboard):not(#tnlOverlay):not(#loginModal)').forEach(function(el) {
      _landingHidden.push({ el: el, prev: el.style.display });
      el.style.display = 'none';
    });
    document.body.style.overflow = 'hidden';
    showDashView('dv-home');
  }
  function closeDashboard() {
    dashboard.classList.remove('dash-open');
    _landingHidden.forEach(function(item) { item.el.style.display = item.prev; });
    _landingHidden = [];
    document.body.style.overflow = '';
  }
  function doLogout() {
    localStorage.removeItem('thruver_role');
    if (window.fbSignOut && window.auth) {
      window.fbSignOut(window.auth).then(function(){ window.currentUser = null; closeDashboard(); }).catch(closeDashboard);
    } else { closeDashboard(); }
  }

  /* ── Switch between dashboard views ── */
  function showDashView(viewId) {
    /* Views */
    document.querySelectorAll('#dashboard .dash-view').forEach(function(v){ v.classList.remove('active'); });
    var target = document.getElementById(viewId);
    if (target) target.classList.add('active');
    /* Sidebar links */
    document.querySelectorAll('#dashboard .dash-nav-link[data-view]').forEach(function(l){
      l.classList.toggle('active', l.dataset.view === viewId);
    });
    /* Bottom nav items */
    document.querySelectorAll('#dashboard .dash-bot-item[data-view]').forEach(function(b){
      b.classList.toggle('active', b.dataset.view === viewId);
    });
    /* Scroll main area to top */
    var ms = document.querySelector('.dash-main-scroll');
    if (ms) ms.scrollTop = 0;
  }

  /* "Ver todo" link in home view */
  var btnSeeAll = document.getElementById('btn-see-all-svcs');
  if (btnSeeAll) btnSeeAll.addEventListener('click', function(){ showDashView('dv-services'); });

  /* Sidebar nav links */
  document.querySelectorAll('#dashboard .dash-nav-link[data-view]').forEach(function(link){
    link.addEventListener('click', function(){ showDashView(link.dataset.view); });
  });

  /* Mobile bottom nav */
  document.querySelectorAll('#dashboard .dash-bot-item[data-view]').forEach(function(item){
    item.addEventListener('click', function(){ showDashView(item.dataset.view); });
  });

  /* Mobile back button → cierra el dashboard y vuelve al landing */
  var btnDashBack = document.getElementById('btn-dash-back');
  if (btnDashBack) btnDashBack.addEventListener('click', closeDashboard);

  /* Logout buttons (sidebar + profile view) */
  document.getElementById('btn-logout').addEventListener('click', doLogout);
  var btnLogoutProfile = document.getElementById('btn-logout-profile');
  if (btnLogoutProfile) btnLogoutProfile.addEventListener('click', doLogout);

  /* ═══════════════════════════════════════════
     CAROUSEL
  ═══════════════════════════════════════════ */
  var slides = document.querySelectorAll('.carousel-slide');
  var dotsEl = document.getElementById('carouselDots');
  var cur = 0, timer;

  slides.forEach(function(_, i) {
    var d = document.createElement('div');
    d.className = 'carousel-dot' + (i === 0 ? ' active' : '');
    d.addEventListener('click', function(){ goTo(i); });
    dotsEl.appendChild(d);
  });

  function goTo(n) {
    slides[cur].classList.remove('active');
    dotsEl.children[cur].classList.remove('active');
    cur = (n + slides.length) % slides.length;
    slides[cur].classList.add('active');
    dotsEl.children[cur].classList.add('active');
    document.getElementById('carouselSlides').style.transform = 'translateX(-' + (cur * 100) + '%)';
    clearInterval(timer);
    timer = setInterval(function(){ goTo(cur + 1); }, 4200);
  }

  var tsX = 0;
  var cf  = document.querySelector('.carousel-frame');
  cf.addEventListener('touchstart', function(e){ tsX = e.touches[0].clientX; }, { passive:true });
  cf.addEventListener('touchend',   function(e){ var d = tsX - e.changedTouches[0].clientX; if (Math.abs(d) > 40) goTo(d > 0 ? cur+1 : cur-1); }, { passive:true });
  timer = setInterval(function(){ goTo(cur + 1); }, 4200);

  /* ═══════════════════════════════════════════
     TABS
  ═══════════════════════════════════════════ */
  document.querySelectorAll('.block-tab[data-tab]').forEach(function(btn){
    btn.addEventListener('click', function(){
      var target = btn.getAttribute('data-target');
      var parent = btn.closest('.how-block,.register-block');
      parent.querySelectorAll('.block-tab').forEach(function(b){ b.classList.remove('active'); });
      parent.querySelectorAll('.tab-panel,.register-form-panel').forEach(function(p){ p.classList.remove('active'); });
      btn.classList.add('active');
      var panel = document.getElementById(target);
      if (panel) panel.classList.add('active');
    });
  });

  /* ═══════════════════════════════════════════
     FORM SIMPLE (registro de la pagina)
  ═══════════════════════════════════════════ */
  document.getElementById('btn-cliente').addEventListener('click', function(){ submitSimpleForm('cliente'); });
  document.getElementById('btn-tecnico').addEventListener('click', function(){ submitSimpleForm('tecnico'); });

  function showSimpleError(tipo, msg) {
    var el = document.getElementById('error-'+tipo);
    if (!el) return;
    el.textContent = msg;
    el.style.display = 'block';
    el.scrollIntoView({ behavior:'smooth', block:'nearest' });
  }
  function hideSimpleError(tipo) {
    var el = document.getElementById('error-'+tipo);
    if (el) el.style.display = 'none';
  }

  function submitSimpleForm(tipo) {
    hideSimpleError(tipo);
    var data = {};
    if (tipo === 'cliente') {
      var nombre=document.getElementById('c-nombre').value.trim(), tel=document.getElementById('c-telefono').value.trim(),
          email=document.getElementById('c-email').value.trim(), esp=document.getElementById('c-espacio').value, svc=document.getElementById('c-servicio').value;
      if (!nombre||!tel||!esp||!svc){ showSimpleError('cliente','Por favor completa todos los campos obligatorios.'); return; }
      data = { tipo:'CLIENTE', nombre:nombre, telefono:tel, email:email, espacio:esp, servicio:svc };
    } else {
      var tn=document.getElementById('t-nombre').value.trim(), tt=document.getElementById('t-telefono').value.trim(),
          te=document.getElementById('t-email').value.trim(), tesp=document.getElementById('t-especialidad').value,
          tz=document.getElementById('t-zona').value.trim(), tx=document.getElementById('t-experiencia').value;
      if (!tn||!tt||!tesp||!tz){ showSimpleError('tecnico','Por favor completa todos los campos obligatorios.'); return; }
      data = { tipo:'TECNICO', nombre:tn, telefono:tt, email:te, especialidad:tesp, zona:tz, experiencia:tx };
    }
    var btn=document.getElementById('btn-'+tipo), sp=document.getElementById('spinner-'+tipo), bt=document.getElementById('btn-'+tipo+'-text');
    btn.disabled=true; sp.style.display='block'; bt.textContent='Enviando...';
    var coleccion = (tipo === 'tecnico') ? 'tecnicos' : 'clientes';
    fetch(SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)}).catch(function(){});
    saveToFirebase(coleccion, data).finally(function(){
      document.getElementById('rform-'+tipo).style.display='none';
      document.getElementById('success-'+tipo).style.display='block';
    });
  }

  /* ═══════════════════════════════════════════
     SCROLL REVEAL
  ═══════════════════════════════════════════ */
  var obs = new IntersectionObserver(function(entries){
    entries.forEach(function(e){ if (e.isIntersecting){ e.target.style.opacity='1'; e.target.style.transform='translateY(0)'; }});
  }, { threshold: 0.06 });

  document.querySelectorAll('.problem-card,.how-step,.why-card,.service-pill,.why-strip-item').forEach(function(el){
    el.style.opacity='0'; el.style.transform='translateY(10px)';
    el.style.transition='opacity 0.4s ease, transform 0.4s ease';
    obs.observe(el);
  });

  /* ═══════════════════════════════════════════
     ONBOARDING
  ═══════════════════════════════════════════ */
  var onbOverlay = document.getElementById('onboarding');

  function showOnboarding(user) {
    /* Pre-llenar nombre si Firebase lo tiene */
    var nombreEl = document.getElementById('onb-nombre');
    if (nombreEl && user && user.displayName) nombreEl.value = user.displayName;
    onbOverlay.classList.add('onb-open');
  }

  function closeOnboarding() {
    onbOverlay.classList.remove('onb-open');
  }

  function onbGoStep(n) {
    document.querySelectorAll('.onb-step').forEach(function(s){ s.classList.remove('onb-active'); });
    document.getElementById('onb-step-' + n).classList.add('onb-active');
    document.getElementById('onb-dot-1').classList.toggle('done', n >= 1);
    document.getElementById('onb-dot-2').classList.toggle('done', n >= 2);
  }

  document.getElementById('onb-next-1').addEventListener('click', function() {
    var nombre = document.getElementById('onb-nombre').value.trim();
    var tel    = document.getElementById('onb-tel').value.trim();
    if (nombre) { localStorage.setItem('thruver_nombre', nombre); }
    if (tel)    { localStorage.setItem('thruver_tel', tel); }
    onbGoStep(2);
  });

  function finishOnboarding() {
    var calle   = (document.getElementById('onb-calle')   || {}).value || '';
    var colonia = (document.getElementById('onb-colonia') || {}).value || '';
    if (calle.trim())   localStorage.setItem('thruver_calle',   calle.trim());
    if (colonia.trim()) localStorage.setItem('thruver_colonia', colonia.trim());
    localStorage.setItem('thruver_onboarded', '1');
    closeOnboarding();
    actualizarPerfilExtra();
  }

  document.getElementById('onb-finish').addEventListener('click', finishOnboarding);
  document.getElementById('onb-skip-1').addEventListener('click', function(){ localStorage.setItem('thruver_onboarded','1'); closeOnboarding(); });
  document.getElementById('onb-skip-2').addEventListener('click', function(){ localStorage.setItem('thruver_onboarded','1'); closeOnboarding(); });

  /* ═══════════════════════════════════════════
     PERFIL AMPLIADO — localStorage
  ═══════════════════════════════════════════ */
  function actualizarPerfilExtra() {
    var tel     = localStorage.getItem('thruver_tel') || '';
    var calle   = localStorage.getItem('thruver_calle') || '';
    var colonia = localStorage.getItem('thruver_colonia') || '';
    var dir     = [calle, colonia].filter(Boolean).join(', ');
    var telEl   = document.getElementById('dash-profile-tel');
    var dirEl   = document.getElementById('dash-profile-dir');
    if (telEl) { telEl.textContent = tel || '—'; telEl.style.color = tel ? '#111' : '#9ca3af'; }
    if (dirEl) { dirEl.textContent = dir || '—'; dirEl.style.color = dir ? '#111' : '#9ca3af'; }
    /* Pre-llenar inputs del form edit */
    var inpTel = document.getElementById('prof-input-tel');
    var inpDir = document.getElementById('prof-input-dir');
    if (inpTel) inpTel.value = tel;
    if (inpDir) inpDir.value = dir;
  }
  actualizarPerfilExtra();

  document.getElementById('prof-edit-toggle').addEventListener('click', function() {
    var form = document.getElementById('prof-edit-form');
    var open = form.classList.toggle('open');
    this.textContent = open ? 'Cancelar' : 'Editar información';
  });

  document.getElementById('prof-save-btn').addEventListener('click', function() {
    var tel = document.getElementById('prof-input-tel').value.trim();
    var dir = document.getElementById('prof-input-dir').value.trim();
    /* Guardar tel directo; dir en calle field por simplicidad */
    if (tel) localStorage.setItem('thruver_tel',    tel);
    if (dir) localStorage.setItem('thruver_calle',  dir);
    localStorage.removeItem('thruver_colonia');
    actualizarPerfilExtra();
    document.getElementById('prof-edit-form').classList.remove('open');
    document.getElementById('prof-edit-toggle').textContent = 'Editar información';
  });

  /* Pre-llenar tunnel con datos de perfil guardados */
  var _origOpenTunnel = openTunnel;
  openTunnel = function(presetSvc) {
    _origOpenTunnel(presetSvc);
    /* Mostrar/ocultar campos según datos guardados + sesión activa */
    actualizarContactWrap(window.currentUser || null);
  };

  /* ═══════════════════════════════════════════
     CONFIRMACIÓN POR EMAIL (via Google Apps Script)
  ═══════════════════════════════════════════ */
  function enviarEmailConfirmacion(datos) {
    var payload = Object.assign({}, datos, { tipo: 'EMAIL_CONFIRMACION' });
    fetch(SCRIPT_URL, { method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) }).catch(function(){});
  }
  /* Inyectar hook en enviarSolicitud al finalizar con éxito */
  var _origOkBtn = document.getElementById('tnl-ok');
  if (_origOkBtn) {
    _origOkBtn.addEventListener('click', function() {
      if (window._lastPayload) enviarEmailConfirmacion(window._lastPayload);
    });
  }

  /* ═══════════════════════════════════════════
     HOOK ONBOARDING en login
  ═══════════════════════════════════════════ */
  var _origOnUserLoggedIn = window.onUserLoggedIn;
  window.onUserLoggedIn = function(user) {
    if (_origOnUserLoggedIn) _origOnUserLoggedIn(user);
    if (!localStorage.getItem('thruver_onboarded') && localStorage.getItem('thruver_role') !== 'tech') {
      setTimeout(function(){ showOnboarding(user); }, 600);
    }
    actualizarPerfilExtra();
  };

  /* ═══════════════════════════════════════════
     ROLE PICKER
  ═══════════════════════════════════════════ */
  function showRolePicker(user) {
    var picker = document.getElementById('rolePicker');
    picker.classList.add('rp-open');
    document.getElementById('rp-client').onclick = function() {
      localStorage.setItem('thruver_role', 'client');
      picker.classList.remove('rp-open');
      cargarHistorialYMostrarDashboard(user);
    };
    document.getElementById('rp-tech').onclick = function() {
      localStorage.setItem('thruver_role', 'tech');
      picker.classList.remove('rp-open');
      cargarHistorialYMostrarDashboard(user);
    };
  }

  /* ═══════════════════════════════════════════
     TECH DASHBOARD
  ═══════════════════════════════════════════ */
  var techDash = document.getElementById('techDashboard');

  function actualizarTechNav(user) {
    var dn      = user.displayName || user.email || 'Técnico';
    var inicial = dn.charAt(0).toUpperCase();
    var nombre  = dn.split(' ')[0];
    var els = {
      'tech-sidebar-av': inicial, 'tech-sidebar-name': dn,
      'tech-sidebar-email': user.email || '',
      'tech-prof-av': inicial, 'tech-prof-name': dn,
      'tech-prof-email': user.email || '',
      'tech-greeting': 'Hola, ' + nombre + '.'
    };
    Object.keys(els).forEach(function(id){ var el=document.getElementById(id); if(el) el.textContent=els[id]; });
    var gs = document.getElementById('tech-greeting-sub');
    if (gs) {
      var hoy = new Date();
      gs.textContent = hoy.toLocaleDateString('es-MX',{weekday:'long',day:'numeric',month:'long'}) + ' · Tu panel de control';
    }
    var ps = document.getElementById('tech-prof-since');
    if (ps) {
      var creado = user.metadata && user.metadata.creationTime ? new Date(user.metadata.creationTime) : new Date();
      ps.textContent = creado.toLocaleDateString('es-MX',{month:'long',year:'numeric'});
    }
  }

  function showTechDashboard(user) {
    actualizarTechNav(user);
    techDash.classList.add('tech-open');
    _landingHidden = [];
    document.querySelectorAll('body > *:not(#techDashboard):not(#tnlOverlay):not(#loginModal):not(#rolePicker)').forEach(function(el){
      _landingHidden.push({ el: el, prev: el.style.display });
      el.style.display = 'none';
    });
    document.body.style.overflow = 'hidden';
    showTechView('tdv-home');
  }

  function closeTechDashboard() {
    techDash.classList.remove('tech-open');
    _landingHidden.forEach(function(item){ item.el.style.display = item.prev; });
    _landingHidden = [];
    document.body.style.overflow = '';
  }

  function showTechView(viewId) {
    document.querySelectorAll('#techDashboard .tech-view').forEach(function(v){ v.classList.remove('active'); });
    var target = document.getElementById(viewId);
    if (target) target.classList.add('active');
    document.querySelectorAll('#techDashboard .tech-nav-link[data-tview]').forEach(function(l){
      l.classList.toggle('active', l.dataset.tview === viewId);
    });
    document.querySelectorAll('#techDashboard .tech-bot-item[data-tview]').forEach(function(b){
      b.classList.toggle('active', b.dataset.tview === viewId);
    });
    var tm = document.querySelector('.tech-main');
    if (tm) tm.scrollTop = 0;
    closeTechDrawer();
  }

  /* Status toggle */
  var _techAvailable = false;
  function toggleTechStatus() {
    _techAvailable = !_techAvailable;
    var txt = _techAvailable ? 'Disponible' : 'No disponible';
    ['tech-status-toggle','tech-drawer-status'].forEach(function(id){
      var el = document.getElementById(id);
      if (el) el.classList.toggle('ts-on', _techAvailable);
    });
    ['tech-status-lbl','tech-drawer-status-lbl'].forEach(function(id){
      var el = document.getElementById(id);
      if (el) el.textContent = txt;
    });
    var mobSt  = document.getElementById('tech-mob-status');
    var mobLbl = document.getElementById('tech-mob-status-lbl');
    if (mobSt)  mobSt.classList.toggle('ts-on', _techAvailable);
    if (mobLbl) mobLbl.textContent = txt;
  }
  document.getElementById('tech-status-toggle').addEventListener('click', toggleTechStatus);
  document.getElementById('tech-mob-status').addEventListener('click', toggleTechStatus);
  var drawerStatusEl = document.getElementById('tech-drawer-status');
  if (drawerStatusEl) drawerStatusEl.addEventListener('click', toggleTechStatus);

  /* Hamburger / drawer */
  function openTechDrawer() {
    var overlay = document.getElementById('tech-sidebar-overlay');
    var btn     = document.getElementById('tech-mob-hamburger');
    if (overlay) overlay.classList.add('open');
    if (btn) btn.classList.add('open');
    document.body.style.overflow = 'hidden';
    syncDrawerUser();
  }
  function closeTechDrawer() {
    var overlay = document.getElementById('tech-sidebar-overlay');
    var btn     = document.getElementById('tech-mob-hamburger');
    if (overlay) overlay.classList.remove('open');
    if (btn) btn.classList.remove('open');
    document.body.style.overflow = '';
  }
  function syncDrawerUser() {
    var av = document.getElementById('tech-sidebar-av');
    var nm = document.getElementById('tech-sidebar-name');
    var em = document.getElementById('tech-sidebar-email');
    var dav = document.getElementById('tech-drawer-av');
    var dnm = document.getElementById('tech-drawer-name');
    var dem = document.getElementById('tech-drawer-email');
    if (dav && av) dav.textContent = av.textContent;
    if (dnm && nm) dnm.textContent = nm.textContent;
    if (dem && em) dem.textContent = em.textContent;
  }
  var hamBtn = document.getElementById('tech-mob-hamburger');
  if (hamBtn) hamBtn.addEventListener('click', function(){
    var overlay = document.getElementById('tech-sidebar-overlay');
    if (overlay && overlay.classList.contains('open')) closeTechDrawer();
    else openTechDrawer();
  });
  var overlay = document.getElementById('tech-sidebar-overlay');
  if (overlay) overlay.addEventListener('click', function(e){
    if (e.target === overlay) closeTechDrawer();
  });

  /* Nav links (sidebar + drawer) */
  document.querySelectorAll('#techDashboard .tech-nav-link[data-tview]').forEach(function(link){
    link.addEventListener('click', function(){ showTechView(link.dataset.tview); });
  });
  document.querySelectorAll('#techDashboard .tech-bot-item[data-tview]').forEach(function(item){
    item.addEventListener('click', function(){ showTechView(item.dataset.tview); });
  });

  /* Shortcut */
  var techSeeReq = document.getElementById('tech-see-requests');
  if (techSeeReq) techSeeReq.addEventListener('click', function(){ showTechView('tdv-requests'); });

  /* Logout tech */
  function doTechLogout() {
    localStorage.removeItem('thruver_role');
    if (window.fbSignOut && window.auth) {
      window.fbSignOut(window.auth).then(function(){ window.currentUser=null; closeTechDashboard(); }).catch(closeTechDashboard);
    } else { closeTechDashboard(); }
  }
  document.getElementById('tech-logout').addEventListener('click', doTechLogout);
  document.getElementById('tech-logout-prof').addEventListener('click', doTechLogout);
  var drawerLogout = document.getElementById('tech-drawer-logout');
  if (drawerLogout) drawerLogout.addEventListener('click', doTechLogout);

  /* Countdown timers */
  function initCountdowns() {
    document.querySelectorAll('.tech-countdown').forEach(function(el){
      var secs  = parseInt(el.getAttribute('data-secs')) || 0;
      var total = secs;
      var body  = el.closest('.tech-job-body');
      var bar   = body ? body.querySelector('.tech-timer-fill') : null;
      var iv = setInterval(function(){
        secs--;
        if (secs <= 0) { clearInterval(iv); el.textContent = '0:00'; if(bar) bar.style.width='0%'; return; }
        var m = Math.floor(secs/60), s = secs%60;
        el.textContent = m + ':' + (s<10?'0':'') + s;
        if (bar && total > 0) bar.style.width = Math.round(secs/total*100) + '%';
      }, 1000);
    });
  }
  initCountdowns();

  /* ═══════════════════════════════════════════
     SERVICE WORKER (PWA)
  ═══════════════════════════════════════════ */
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(function(){});
  }

});
</script>

<!-- ═══════════════════════════════════════════
     FIREBASE — Auth + Firestore + Analytics
═══════════════════════════════════════════ -->
<script type="module">
  import { initializeApp }                                          from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getAnalytics }                                           from "https://www.gstatic.com/firebasejs/10.8.1/firebase-analytics.js";
  import { getFirestore, collection, addDoc, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    signOut,
    sendPasswordResetEmail
  } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey:            "AIzaSyCJlo2i_MsotnrCJ9VnnXsZidGKospvw2k",
    authDomain:        "thruver-3de75.firebaseapp.com",
    projectId:         "thruver-3de75",
    storageBucket:     "thruver-3de75.firebasestorage.app",
    messagingSenderId: "31613785682",
    appId:             "1:31613785682:web:10158e532742050689318b",
    measurementId:     "G-NPFGT5G82D"
  };

  const app            = initializeApp(firebaseConfig);
  const analytics      = getAnalytics(app);
  const db             = getFirestore(app);
  const auth           = getAuth(app);
  const googleProvider = new GoogleAuthProvider();

  window.db                   = db;
  window.auth                 = auth;
  window.fbCollection         = collection;
  window.fbAddDoc             = addDoc;
  window.fbQuery              = query;
  window.fbWhere              = where;
  window.fbGetDocs            = getDocs;
  window.fbOrderBy            = orderBy;
  window.fbCreateUser         = createUserWithEmailAndPassword;
  window.fbSignIn             = signInWithEmailAndPassword;
  window.fbSignInWithPopup    = signInWithPopup;
  window.fbGoogleProvider     = googleProvider;
  window.fbSignOut            = signOut;
  window.fbOnAuthStateChanged    = onAuthStateChanged;
  window.fbSendPasswordReset     = sendPasswordResetEmail;

  onAuthStateChanged(auth, function(user) {
    if (user) {
      window.currentUser = user;
      if (typeof window.onUserLoggedIn === 'function') window.onUserLoggedIn(user);
    } else {
      window.currentUser = null;
      if (typeof window.onUserLoggedOut === 'function') window.onUserLoggedOut();
    }
  });

  console.log("🔥 Firebase Auth + Firestore conectado a Thruver!");
</script>
</body>
</html>
